<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Non-overlapping Layout</title>
    <style>

.node {
  stroke: #333;
  stroke-width: 1.5px;
    cursor: move;
}

.link {
  stroke: #999;
  stroke-width: 3px;
  stroke-opacity: 1;
}

.label {
    fill: white;
    font-family: Verdana;
    font-size: 25px;
    text-anchor: middle;
    cursor: move;
}

</style>
</head>
<body>
    <h1>Testing D3 and Cola</h1>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.3.0/d3.js" charset="utf-8" type="text/javascript"></script>
<script src="http://marvl.infotech.monash.edu/webcola/cola.js"></script>
<script>
var width = 960,
    height = 500;

var color = d3.scaleOrdinal()
      .range(["red", "green", "blue", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

var cola = cola.d3adaptor(d3)
    .linkDistance(120)
    .avoidOverlaps(true)
    .size([width, height]);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

const nodes = [
  {name:"a", width:60, height:40},
  {name:"b", width:60, height:40},
  {name:"c", width:60, height:40},
  {name:"d", width:60, height:40},
  {name:"e", width:60, height:40}
]
const links = [
  {source:0, target:1},
  {source:1, target:2},
  {source:2, target:0},
  {source:2, target:3}
]

cola.nodes(nodes).links(links).start();

var link = svg.selectAll(".link")
    .data(links)
  .enter().append("line")
    .attr("class", "link");

var node = svg.selectAll(".node")
    .data(nodes)
  .enter().append("rect")
    .attr("class", "node")
    .attr("width", function (d) { return d.width; })
    .attr("height", function (d) { return d.height; })
    .attr("rx", 4).attr("ry", 4)
    .style("fill", function (d,i) { return color(i); })
    .call(cola.drag);

var label = svg.selectAll(".label")
    .data(nodes)
   .enter().append("text")
    .attr("class", "label")
    .text(function (d) { return d.name; })
    .call(cola.drag);

node.append("title")
    .text(function (d) { return d.name; });

cola.on("tick", function () {
    link.attr("x1", function (d) { return d.source.x; })
        .attr("y1", function (d) { return d.source.y; })
        .attr("x2", function (d) { return d.target.x; })
        .attr("y2", function (d) { return d.target.y; });
    node.attr("x", function (d) { return d.x - d.width / 2; })
        .attr("y", function (d) { return d.y - d.height / 2; });
    label.attr("x", function (d) { return d.x; })
        .attr("y", function (d) {
            var h = this.getBBox().height;
            return d.y + h/4;
        });
});

</script>
</body>
</html>
