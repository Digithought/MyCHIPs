<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="780px" preserveAspectRatio="none" style="width:953px;height:780px;background:#FFFFFF;" version="1.1" viewBox="0 0 953 780" width="953px" zoomAndPan="magnify"><defs><filter height="300%" id="f8i7ygy8ca82z" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="197" x="371.86" y="17.4023">Route Discovery States</text><!--MD5=[f24f9fa66be6021b4811721219a247f0]
cluster tryable--><rect fill="#E8E8EA" filter="url(#f8i7ygy8ca82z)" height="145" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="409" x="342.72" y="606.5592"/><rect fill="#FFFFFF" height="84.7344" rx="12.5" ry="12.5" style="stroke:#FFFFFF;stroke-width:1.0;" width="403" x="345.72" y="663.8248"/><line style="stroke:#202024;stroke-width:1.5;" x1="342.72" x2="751.72" y1="660.8248" y2="660.8248"/><line style="stroke:#202024;stroke-width:1.5;" x1="342.72" x2="751.72" y1="627.5592" y2="627.5592"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="33" x="358.72" y="619.0294">tryable</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="363" x="347.72" y="641.6608">My retry upstream query for new information from time to time</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="377" x="347.72" y="655.7936">Routes also subject to optional deletion after long expiration time</text><!--MD5=[183bf34a3becb4c0cee7f12d3db1c1d0]
cluster liftUpdate--><rect fill="#E8E8EA" filter="url(#f8i7ygy8ca82z)" height="376.36" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="385" x="404.72" y="147.1992"/><rect fill="#FFFFFF" height="330.2272" rx="12.5" ry="12.5" style="stroke:#FFFFFF;stroke-width:1.0;" width="379" x="407.72" y="190.332"/><line style="stroke:#202024;stroke-width:1.5;" x1="404.72" x2="789.72" y1="187.332" y2="187.332"/><line style="stroke:#202024;stroke-width:1.5;" x1="404.72" x2="789.72" y1="168.1992" y2="168.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="45" x="437.72" y="159.6694">liftUpdate</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="319" x="409.72" y="182.3008">Lift success/failure will provide more up-to-date status</text><g id="tryable.none"><rect fill="#E8E8EA" filter="url(#f8i7ygy8ca82z)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="141" x="586.22" y="677.5592"/><line style="stroke:#202024;stroke-width:1.5;" x1="586.22" x2="727.22" y1="698.5592" y2="698.5592"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="644.72" y="691.0294">none</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121" x="591.22" y="715.1608">Stat: none, time: N/A</text></g><g id="tryable.timeout"><rect fill="#E8E8EA" filter="url(#f8i7ygy8ca82z)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="165" x="386.22" y="677.5592"/><line style="stroke:#202024;stroke-width:1.5;" x1="386.22" x2="551.22" y1="698.5592" y2="698.5592"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="34" x="451.72" y="691.0294">pend.X</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="145" x="391.22" y="715.1608">Stat: pend, time: expired</text></g><g id="liftUpdate.good"><rect fill="#E8E8EA" filter="url(#f8i7ygy8ca82z)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="136" x="569.72" y="304.5592"/><line style="stroke:#202024;stroke-width:1.5;" x1="569.72" x2="705.72" y1="325.5592" y2="325.5592"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="625.72" y="318.0294">good</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="116" x="574.72" y="342.1608">Stat: good, time: OK</text></g><g id="liftUpdate.pend"><rect fill="#E8E8EA" filter="url(#f8i7ygy8ca82z)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="137" x="429.22" y="449.5592"/><line style="stroke:#202024;stroke-width:1.5;" x1="429.22" x2="566.22" y1="470.5592" y2="470.5592"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="485.72" y="463.0294">pend</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="117" x="434.22" y="487.1608">Stat: pend, time: OK</text></g><g id="liftUpdate.stale"><rect fill="#E8E8EA" filter="url(#f8i7ygy8ca82z)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="164" x="601.72" y="449.5592"/><line style="stroke:#202024;stroke-width:1.5;" x1="601.72" x2="765.72" y1="470.5592" y2="470.5592"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="34" x="666.72" y="463.0294">good.X</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="144" x="606.72" y="487.1608">Stat: good, time: expired</text></g><g id="draft"><rect fill="#E8E8EA" filter="url(#f8i7ygy8ca82z)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="141" x="182.22" y="304.5592"/><line style="stroke:#202024;stroke-width:1.5;" x1="182.22" x2="323.22" y1="325.5592" y2="325.5592"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="22" x="241.72" y="318.0294">draft</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121" x="187.22" y="342.1608">Stat: draft, time: N/A</text></g><ellipse cx="135.72" cy="188.5592" fill="#44AAFF" filter="url(#f8i7ygy8ca82z)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><ellipse cx="135.72" cy="37.1992" fill="none" filter="url(#f8i7ygy8ca82z)" rx="10" ry="10" style="stroke:#2277DD;stroke-width:1.0;"/><ellipse cx="136.22" cy="37.6992" fill="#2277DD" rx="6" ry="6" style="stroke:none;stroke-width:1.0;"/><!--MD5=[1953f02a86cae1c1ee80a502bf9109fd]
reverse link *end to *start--><path d="M121,41.7792 C104.45,46.6792 78.37,57.2292 66.72,77.1992 C56.42,94.8592 58.57,104.4492 66.72,123.1992 C79.26,152.0392 111.81,173.8192 127.29,182.9092 " fill="none" id="*end-backto-*start" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="126.21,40.3292,116.4662,38.8944,121.3938,41.6726,118.6156,46.6002,126.21,40.3292" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="99.72" y="86.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="67.72" y="97.6694">Receive Act:query</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="89" x="68.22" y="108.6694">[Route impossible]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="69" x="78.22" y="119.6694">/Reply Act: fail</text><!--MD5=[1953f02a86cae1c1ee80a502bf9109fd]
reverse link *end to *start--><path d="M146.01,49.1292 C152.17,56.4492 159.43,66.6492 162.72,77.1992 C174.55,115.0392 151.16,161.4892 140.56,179.7092 " fill="none" id="*end-backto-*start-1" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="142.36,44.9592,145.2939,54.3609,145.6596,48.7159,151.3046,49.0816,142.36,44.9592" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="199.72" y="86.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="167.72" y="97.6694">Receive Act:query</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="92" x="166.72" y="108.6694">[Peer found locally]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="83" x="171.22" y="119.6694">/Reply Act: affirm</text><!--MD5=[98967d72ce6cf1fee1a27daeddde0c85]
link *start to draft--><path d="M132.37,198.3792 C126.71,214.8392 117.33,250.7492 132.72,274.5592 C143.16,290.6892 159.68,302.0492 177.17,310.0392 " fill="none" id="*start-to-draft" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="182.13,312.1992,175.4879,304.9272,177.5492,310.1951,172.2813,312.2565,182.13,312.1992" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="165.72" y="243.5294">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="91" x="133.72" y="254.5294">User initiates route</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="87" x="135.72" y="265.5294">/Create new route</text><!--MD5=[98967d72ce6cf1fee1a27daeddde0c85]
link *start to draft--><path d="M145.7,190.7092 C165.02,193.4792 207.6,202.3792 229.72,228.5592 C246.33,248.2092 251.52,277.5092 252.89,299.3292 " fill="none" id="*start-to-draft-1" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="253.15,304.4192,256.6811,295.2251,252.8925,299.4259,248.6917,295.6372,253.15,304.4192" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="291.72" y="238.0294">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="259.72" y="249.0294">Receive Act:query</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="110" x="249.72" y="260.0294">[Peer not found locally]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="89" x="260.22" y="271.0294">/Create draft route</text><!--MD5=[98967d72ce6cf1fee1a27daeddde0c85]
link *start to draft--><path d="M125.68,189.3492 C102.24,189.4792 44.01,193.4692 18.72,228.5592 C6.77,245.1492 6,258.5592 18.72,274.5592 C38.35,299.2292 116.47,313.5992 177.11,321.2292 " fill="none" id="*start-to-draft-2" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="182.18,321.8592,173.7402,316.7828,177.218,321.2443,172.7564,324.722,182.18,321.8592" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="25" x="54.72" y="243.5294">cron:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="95" x="19.72" y="254.5294">Agent initiates route</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="87" x="23.72" y="265.5294">/Create new route</text><!--MD5=[a8c2edeeff30ae98fd98238d601eb68c]
link draft to pend--><path d="M269.36,354.9292 C284.14,374.8792 307.43,402.5092 333.72,419.5592 C360.95,437.2092 394.47,449.5892 424.09,457.9992 " fill="none" id="draft-to-pend" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="429.19,459.4192,421.5956,453.1482,424.3738,458.0758,419.4462,460.8541,429.19,459.4192" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="379.22" y="394.0294">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="67" x="373.72" y="405.0294">draft detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="145" x="334.72" y="416.0294">/Forward Upstream Act:query</text><!--MD5=[23ad43212dbe64da09229317cbcad017]
reverse link good to pend--><path d="M564.45,342.2792 C539.81,350.0592 514.79,363.0092 499.72,384.5592 C486.62,403.3092 488,430.1192 491.49,449.4092 " fill="none" id="good-backto-pend" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="569.37,340.7892,559.5985,339.5574,564.5828,342.2325,561.9077,347.2169,569.37,340.7892" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="560.22" y="394.0294">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="89" x="528.72" y="405.0294">Receive Act:affirm</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="145" x="500.72" y="416.0294">/Relay Downstream Act:affirm</text><!--MD5=[86606c81ed92e4b14743f0e3adcd21ae]
link pend to timeout--><path d="M494.62,499.7492 C489.25,541.6292 478.23,627.4892 472.45,672.5292 " fill="none" id="pend-to-timeout" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="471.81,677.5492,476.9104,669.1239,472.439,672.5889,468.9739,668.1175,471.81,677.5492" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="519.22" y="562.5294">timer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="88" x="488.72" y="573.5294">Request times out</text><!--MD5=[dca2950e12c9d6adf6537943454f4927]
link pend to none--><path d="M534.44,499.7092 C551.66,512.3992 571.47,529.1392 585.72,547.5592 C615.65,586.2392 636.63,639.5592 647.68,672.2392 " fill="none" id="pend-to-none" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="649.37,677.2992,650.3364,667.4979,647.7974,672.553,642.7424,670.014,649.37,677.2992" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="662.72" y="557.0294">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="75" x="638.22" y="568.0294">Receive Act:fail</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="134" x="608.72" y="579.0294">[Relay Downstream Act:fail]</text><!--MD5=[a45697425f1a3f310029e501b22b8ce0]
link good to stale--><path d="M645.53,354.8192 C653.49,379.5692 665.85,417.9992 674.34,444.3992 " fill="none" id="good-to-stale" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="675.88,449.1792,676.935,439.387,674.3504,444.4189,669.3185,441.8344,675.88,449.1792" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="686.72" y="399.5294">timer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="67" x="666.72" y="410.5294">Time runs out</text><!--MD5=[4d457d719b4e7c41c3ed4d632fa5b48a]
link liftUpdate to good--><path d="M709.61,189.5992 C707.31,190.4192 670.17,203.9792 654.72,228.5592 C641.42,249.7292 637.64,278.1692 636.92,299.3092 " fill="none" id="liftUpdate-to-good" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="636.8,304.5192,641.0046,295.613,636.9143,299.5205,633.0067,295.4302,636.8,304.5192" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="15" x="719.22" y="243.5294">db:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="142" x="655.72" y="254.5294">Lift succeeds using this route</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="98" x="677.72" y="265.5294">[Refresh timestamp]</text><!--MD5=[c41c88f526d6d39a9332f3a09077a899]
link liftUpdate to none--><path d="M789.8152,214.6957 C789.9494,214.8029 790.0832,214.9105 790.2166,215.0186 C790.7501,215.4508 791.277,215.8904 791.7969,216.3375 C795.9559,219.9139 799.6662,223.9667 802.72,228.5592 C832.79,273.7692 925.87,137.3492 781.72,539.5592 C762.32,593.7092 717.45,644.1692 687.1,673.9392 " fill="none" id="liftUpdate-to-none" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="683.47,677.4692,692.7115,674.064,687.0552,673.984,687.1352,668.3277,683.47,677.4692" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="15" x="881.72" y="399.5294">db:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="113" x="832.72" y="410.5294">Lift fails using this route</text><!--MD5=[34f7aa07fc5ab375154f91d17cd7f7c2]
link tryable to draft--><path d="M342.5796,677.162 C341.6345,674.2922 340.6248,671.214 339.56,667.9519 C337.4305,661.4277 335.0806,654.1683 332.5875,646.3705 C322.615,615.1792 310.35,575.3742 300.72,539.5592 C283.66,476.0792 267.3,400.7392 258.79,360.0992 " fill="none" id="tryable-to-draft" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="257.69,354.8392,255.5973,364.4632,258.7035,359.7354,263.4313,362.8416,257.69,354.8392" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="343.72" y="461.0294">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="93" x="310.22" y="472.0294">Receive Act: query</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="110" x="301.72" y="483.0294">[Peer not found locally]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="89" x="312.22" y="494.0294">/Create draft route</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="151" x="394.86" y="772.2272">Mon Feb 21 14:48:33 MST 2022</text><!--MD5=[19741927591324e040fd1983f2c9c6bf]
@startuml
!include common.puml

$title(Route Discovery States)
'[*] - -> void

'States are determined by a combination of values, as defined here:
state tryable {
  state none
  state "pend.X" as timeout
'  state "pend.Z" as unknown
}
state liftUpdate {
  state good
  state pend
  state "good.X" as stale
}

'State details:
draft: Stat: draft, time: N/A
pend: Stat: pend, time: OK
good: Stat: good, time: OK
stale: Stat: good, time: expired
none: Stat: none, time: N/A
timeout: Stat: pend, time: expired
'unknown: Stat: pend, time: expired, tries: max
liftUpdate: Lift success/failure will provide more up-to-date status
tryable: My retry upstream query for new information from time to time
tryable: Routes also subject to optional deletion after long expiration time

'State transition rules:
[*] -up[$peer]-> [*]: $trans($peer,Receive Act:query,'Route impossible',Reply Act: fail)
[*] -up[$peer]-> [*]: $trans($peer,Receive Act:query,'Peer found locally',Reply Act: affirm)

[*] -[$user]-> draft: $trans($user,User initiates route,'',Create new route)
[*] -[$peer]-> draft: $trans($peer,Receive Act:query,'Peer not found locally',Create draft route)
[*] - -> draft: $trans(cron,Agent initiates route,'',Create new route)

draft -[$db]-> pend: $trans($db,draft detected,'',Forward Upstream Act:query)

pend -up[$peer]-> good: $trans($peer,Receive Act:affirm,'',Relay Downstream Act:affirm)
pend - -> timeout: $trans(timer,Request times out,'')
pend -[$peer]-> none: $trans($peer,Receive Act:fail,Relay Downstream Act:fail)

good - -> stale: $trans(timer,Time runs out,'')
liftUpdate - -> good: $trans(db,Lift succeeds using this route,Refresh timestamp)
liftUpdate - -> none: $trans(db,Lift fails using this route)

tryable -[$peer]-> draft: $trans($peer,Receive Act: query,Peer not found locally,Create draft route)
'timeout - -> unknown: $trans(Tries,Max retries reached)
'tryable -[$db]-> [*]: $trans($db,Delete obsolete record,Very long time)

@enduml

@startuml



skinparam backgroundColor fff
skinparam stereotypeCBackgroundColor 27d






skinparam circledCharacter {
  radius 8
  fontSize 11
  fontName Helvetica
}

skinparam class {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  attributeFontColor 333
  attributeFontSize 11
  attributeIconSize 11
}

skinparam actor {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam participant {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam collections {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam SequenceBox{
    backgroundColor e0e0e0
  borderColor cccccc
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam interface {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam component {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}



skinparam queue {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}


skinparam usecase {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam activity {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam sequence {
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  lifeLineBorderColor 4af
  lifeLineBackgroundColor e0e0e0
}




skinparam state {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
  startColor 4af
  endColor 27d
}

skinparam note {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}








  title Route Discovery States
  footer Mon Feb 21 14:48:33 MST 2022

state tryable {
  state none
  state "pend.X" as timeout
}
state liftUpdate {
  state good
  state pend
  state "good.X" as stale
}

draft: Stat: draft, time: N/A
pend: Stat: pend, time: OK
good: Stat: good, time: OK
stale: Stat: good, time: expired
none: Stat: none, time: N/A
timeout: Stat: pend, time: expired
liftUpdate: Lift success/failure will provide more up-to-date status
tryable: My retry upstream query for new information from time to time
tryable: Routes also subject to optional deletion after long expiration time

[*] -up[#blue]-> [*]: <font color=blue>Peer:\nReceive Act:query\n[Route impossible]\n/Reply Act: fail
[*] -up[#blue]-> [*]: <font color=blue>Peer:\nReceive Act:query\n[Peer found locally]\n/Reply Act: affirm

[*] -[#green]-> draft: <font color=green>User:\nUser initiates route\n/Create new route
[*] -[#blue]-> draft: <font color=blue>Peer:\nReceive Act:query\n[Peer not found locally]\n/Create draft route
[*] - -> draft: <font color=black>cron:\nAgent initiates route\n/Create new route

draft -[#red]-> pend: <font color=red>DB Trigger:\ndraft detected\n/Forward Upstream Act:query

pend -up[#blue]-> good: <font color=blue>Peer:\nReceive Act:affirm\n/Relay Downstream Act:affirm
pend - -> timeout: <font color=black>timer:\nRequest times out
pend -[#blue]-> none: <font color=blue>Peer:\nReceive Act:fail\n[Relay Downstream Act:fail]

good - -> stale: <font color=black>timer:\nTime runs out
liftUpdate - -> good: <font color=black>db:\nLift succeeds using this route\n[Refresh timestamp]
liftUpdate - -> none: <font color=black>db:\nLift fails using this route

tryable -[#blue]-> draft: <font color=blue>Peer:\nReceive Act: query\n[Peer not found locally]\n/Create draft route

@enduml

PlantUML version 1.2022.1(Tue Feb 01 11:19:58 MST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>