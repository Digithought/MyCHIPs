<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="791px" preserveAspectRatio="none" style="width:1099px;height:791px;background:#FFFFFF;" version="1.1" viewBox="0 0 1099 791" width="1099px" zoomAndPan="magnify"><defs><filter height="300%" id="fxqdjkhrggnh8" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="197" x="444.775" y="17.4023">Route Discovery States</text><!--MD5=[f24f9fa66be6021b4811721219a247f0]
cluster tryable--><rect fill="#E8E8EA" filter="url(#fxqdjkhrggnh8)" height="145" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="409" x="223.42" y="617.5592"/><rect fill="#FFFFFF" height="84.7344" rx="12.5" ry="12.5" style="stroke:#FFFFFF;stroke-width:1.0;" width="403" x="226.42" y="674.8248"/><line style="stroke:#202024;stroke-width:1.5;" x1="223.42" x2="632.42" y1="671.8248" y2="671.8248"/><line style="stroke:#202024;stroke-width:1.5;" x1="223.42" x2="632.42" y1="638.5592" y2="638.5592"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="33" x="239.42" y="630.0294">tryable</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="370" x="228.42" y="652.6608">May retry upstream query for new information from time to time</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="377" x="228.42" y="666.7936">Routes also subject to optional deletion after long expiration time</text><!--MD5=[183bf34a3becb4c0cee7f12d3db1c1d0]
cluster liftUpdate--><rect fill="#E8E8EA" filter="url(#fxqdjkhrggnh8)" height="387.36" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="464" x="403.42" y="147.1992"/><rect fill="#FFFFFF" height="341.2272" rx="12.5" ry="12.5" style="stroke:#FFFFFF;stroke-width:1.0;" width="458" x="406.42" y="190.332"/><line style="stroke:#202024;stroke-width:1.5;" x1="403.42" x2="867.42" y1="187.332" y2="187.332"/><line style="stroke:#202024;stroke-width:1.5;" x1="403.42" x2="867.42" y1="168.1992" y2="168.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="45" x="475.92" y="159.6694">liftUpdate</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="319" x="408.42" y="182.3008">Lift success/failure will provide more up-to-date status</text><g id="tryable.none"><rect fill="#E8E8EA" filter="url(#fxqdjkhrggnh8)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="141" x="466.92" y="688.5592"/><line style="stroke:#202024;stroke-width:1.5;" x1="466.92" x2="607.92" y1="709.5592" y2="709.5592"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="525.42" y="702.0294">none</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121" x="471.92" y="726.1608">Stat: none, time: N/A</text></g><g id="tryable.timeout"><rect fill="#E8E8EA" filter="url(#fxqdjkhrggnh8)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="165" x="266.92" y="688.5592"/><line style="stroke:#202024;stroke-width:1.5;" x1="266.92" x2="431.92" y1="709.5592" y2="709.5592"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="34" x="332.42" y="702.0294">pend.X</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="145" x="271.92" y="726.1608">Stat: pend, time: expired</text></g><g id="liftUpdate.good"><rect fill="#E8E8EA" filter="url(#fxqdjkhrggnh8)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="136" x="584.42" y="304.5592"/><line style="stroke:#202024;stroke-width:1.5;" x1="584.42" x2="720.42" y1="325.5592" y2="325.5592"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="640.42" y="318.0294">good</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="116" x="589.42" y="342.1608">Stat: good, time: OK</text></g><g id="liftUpdate.pend"><rect fill="#E8E8EA" filter="url(#fxqdjkhrggnh8)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="137" x="427.92" y="460.5592"/><line style="stroke:#202024;stroke-width:1.5;" x1="427.92" x2="564.92" y1="481.5592" y2="481.5592"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="484.42" y="474.0294">pend</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="117" x="432.92" y="498.1608">Stat: pend, time: OK</text></g><g id="liftUpdate.stale"><rect fill="#E8E8EA" filter="url(#fxqdjkhrggnh8)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="164" x="679.42" y="460.5592"/><line style="stroke:#202024;stroke-width:1.5;" x1="679.42" x2="843.42" y1="481.5592" y2="481.5592"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="34" x="744.42" y="474.0294">good.X</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="144" x="684.42" y="498.1608">Stat: good, time: expired</text></g><g id="draft"><rect fill="#E8E8EA" filter="url(#fxqdjkhrggnh8)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="141" x="146.92" y="304.5592"/><line style="stroke:#202024;stroke-width:1.5;" x1="146.92" x2="287.92" y1="325.5592" y2="325.5592"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="22" x="206.42" y="318.0294">draft</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121" x="151.92" y="342.1608">Stat: draft, time: N/A</text></g><ellipse cx="134.42" cy="188.5592" fill="#44AAFF" filter="url(#fxqdjkhrggnh8)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><ellipse cx="134.42" cy="37.1992" fill="none" filter="url(#fxqdjkhrggnh8)" rx="10" ry="10" style="stroke:#2277DD;stroke-width:1.0;"/><ellipse cx="134.92" cy="37.6992" fill="#2277DD" rx="6" ry="6" style="stroke:none;stroke-width:1.0;"/><!--MD5=[1953f02a86cae1c1ee80a502bf9109fd]
reverse link *end to *start--><path d="M119.7,41.7792 C103.15,46.6792 77.07,57.2292 65.42,77.1992 C55.12,94.8592 57.27,104.4492 65.42,123.1992 C77.96,152.0392 110.51,173.8192 125.99,182.9092 " fill="none" id="*end-backto-*start" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="124.91,40.3292,115.1702,38.8675,120.0902,41.6593,117.2984,46.5793,124.91,40.3292" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="98.42" y="86.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="66.42" y="97.6694">Receive Act:query</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="89" x="66.92" y="108.6694">[Route impossible]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="80" x="71.42" y="119.6694">/Reply Act: none</text><!--MD5=[1953f02a86cae1c1ee80a502bf9109fd]
reverse link *end to *start--><path d="M144.71,49.1292 C150.87,56.4492 158.13,66.6492 161.42,77.1992 C173.24,115.0392 149.86,161.4892 139.26,179.7092 " fill="none" id="*end-backto-*start-1" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="141.06,44.9592,143.9939,54.3609,144.3596,48.7159,150.0046,49.0816,141.06,44.9592" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="198.42" y="86.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="166.42" y="97.6694">Receive Act:query</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="92" x="165.42" y="108.6694">[Peer found locally]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="80" x="171.42" y="119.6694">/Reply Act: good</text><!--MD5=[98967d72ce6cf1fee1a27daeddde0c85]
link *start to draft--><path d="M131.38,198.1892 C126.25,214.3392 117.7,249.7492 131.42,274.5592 C137.32,285.2292 146.3,294.0692 156.27,301.2892 " fill="none" id="*start-to-draft" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="160.6,304.2892,155.4832,295.8739,156.4911,301.4402,150.9248,302.4481,160.6,304.2892" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="164.42" y="243.5294">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="91" x="132.42" y="254.5294">User initiates route</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="87" x="134.42" y="265.5294">/Create new route</text><!--MD5=[98967d72ce6cf1fee1a27daeddde0c85]
link *start to draft--><path d="M144.32,190.2392 C164.31,192.1992 209.19,199.7592 228.42,228.5592 C242.25,249.2692 237.27,277.9292 230.13,299.2592 " fill="none" id="*start-to-draft-1" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="228.38,304.2392,235.1383,297.075,230.0381,299.5222,227.591,294.422,228.38,304.2392" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="279.42" y="238.0294">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="247.42" y="249.0294">Receive Act:query</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="110" x="237.42" y="260.0294">[Peer not found locally]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="89" x="247.92" y="271.0294">/Create draft route</text><!--MD5=[98967d72ce6cf1fee1a27daeddde0c85]
link *start to draft--><path d="M124.11,189.3892 C100.64,189.6192 43.35,193.8792 18.42,228.5592 C6.49,245.1592 6,258.3192 18.42,274.5592 C33.69,294.5292 92.09,308.8392 141.7,317.6892 " fill="none" id="*start-to-draft-2" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="146.78,318.5792,138.5985,313.0963,141.8539,317.7225,137.2277,320.978,146.78,318.5792" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="25" x="54.42" y="243.5294">cron:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="95" x="19.42" y="254.5294">Agent initiates route</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="87" x="23.42" y="265.5294">/Create new route</text><!--MD5=[a8c2edeeff30ae98fd98238d601eb68c]
link draft to pend--><path d="M230.46,354.8392 C243.99,377.7292 267.24,411.3192 296.42,430.5592 C333.92,455.2892 382.43,468.7392 422.29,476.0292 " fill="none" id="draft-to-pend" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="427.6,476.9792,419.4494,471.4504,422.6788,476.0948,418.0344,479.3243,427.6,476.9792" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="341.92" y="399.5294">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="67" x="336.42" y="410.5294">draft detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="145" x="297.42" y="421.5294">/Forward Upstream Act:query</text><!--MD5=[23ad43212dbe64da09229317cbcad017]
reverse link good to pend--><path d="M579.46,341.6492 C531.22,350.6392 474.24,365.0292 459.42,384.5592 C442.19,407.2692 459.08,438.8492 475.28,460.3992 " fill="none" id="good-backto-pend" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="584.39,340.7392,574.8167,338.4259,579.4718,341.6399,576.2578,346.2951,584.39,340.7392" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="490.42" y="394.0294">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="86" x="460.42" y="405.0294">Receive Act:good</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="72" x="467.42" y="416.0294">[Local request]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="475.42" y="427.0294">/Notify user</text><!--MD5=[23ad43212dbe64da09229317cbcad017]
reverse link good to pend--><path d="M613.31,357.8992 C603.05,365.9192 592.37,375.0892 583.42,384.5592 C566.31,402.6592 567.49,411.5292 551.42,430.5592 C542.7,440.8892 532.3,451.4692 522.91,460.4992 " fill="none" id="good-backto-pend-1" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="617.36,354.7692,607.7924,357.1061,613.4033,357.826,612.6833,363.4369,617.36,354.7692" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="642.42" y="394.0294">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="86" x="612.42" y="405.0294">Receive Act:good</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="610.42" y="416.0294">[External Request]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="142" x="584.42" y="427.0294">/Relay Downstream Act:good</text><!--MD5=[86606c81ed92e4b14743f0e3adcd21ae]
link pend to timeout--><path d="M460.6,510.6392 C443.89,523.3192 424.78,540.0592 411.42,558.5592 C383.4,597.3792 365.64,650.6592 356.62,683.2892 " fill="none" id="pend-to-timeout" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="355.25,688.3492,361.4733,680.7157,356.5632,683.5247,353.7541,678.6146,355.25,688.3492" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="442.92" y="573.5294">timer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="88" x="412.42" y="584.5294">Request times out</text><!--MD5=[dca2950e12c9d6adf6537943454f4927]
link pend to none--><path d="M500.81,510.7492 C508.41,552.6292 523.99,638.4892 532.16,683.5292 " fill="none" id="pend-to-none" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="533.07,688.5492,535.415,678.9836,532.1856,683.6281,527.5412,680.3986,533.07,688.5492" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="546.42" y="568.0294">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="86" x="516.42" y="579.0294">Receive Act:none</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="82" x="518.42" y="590.0294">[No further relay]</text><!--MD5=[a45697425f1a3f310029e501b22b8ce0]
link good to stale--><path d="M702.62,354.7792 C714.86,362.7692 726.88,372.6992 735.42,384.5592 C750.37,405.3092 756.73,433.9692 759.44,455.2792 " fill="none" id="good-to-stale" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="760.02,460.2592,762.9395,450.853,759.435,455.2936,754.9944,451.7891,760.02,460.2592" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="774.42" y="405.0294">timer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="67" x="754.42" y="416.0294">Time runs out</text><!--MD5=[4d457d719b4e7c41c3ed4d632fa5b48a]
link liftUpdate to good--><path d="M771.36,189.6192 C770.01,190.8492 748.26,210.8692 732.42,228.5592 C711.43,252.0092 689.19,280.1092 673.51,300.5392 " fill="none" id="liftUpdate-to-good" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="670.46,304.5192,679.1089,299.8079,673.501,300.5503,672.7586,294.9423,670.46,304.5192" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="15" x="796.92" y="243.5294">db:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="142" x="733.42" y="254.5294">Lift succeeds using this route</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="98" x="755.42" y="265.5294">[Refresh timestamp]</text><!--MD5=[c41c88f526d6d39a9332f3a09077a899]
link liftUpdate to none--><path d="M867.4657,214.991 C872.3767,218.8902 876.775,223.383 880.42,228.5592 C924.08,290.5392 1092.55,202.5992 859.42,550.5592 C803.01,634.7492 689.12,677.2492 613.04,697.1192 " fill="none" id="liftUpdate-to-none" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="608.08,698.3992,617.7918,700.0364,612.9231,697.1563,615.8032,692.2875,608.08,698.3992" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="15" x="1007.42" y="405.0294">db:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="113" x="958.42" y="416.0294">Lift fails using this route</text><!--MD5=[34f7aa07fc5ab375154f91d17cd7f7c2]
link tryable to draft--><path d="M227.8872,616.0513 C227.8078,613.8829 227.7275,611.6928 227.6466,609.4825 C227.4846,605.0621 227.3197,600.5613 227.1524,595.9932 C226.8177,586.8569 226.4731,577.4513 226.1225,567.8805 C223.3175,491.3142 220.125,404.1792 218.5,359.8392 " fill="none" id="tryable-to-draft" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="218.31,354.7492,214.6468,363.8915,218.4956,359.7458,222.6413,363.5945,218.31,354.7492" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="267.42" y="472.0294">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="93" x="233.92" y="483.0294">Receive Act: query</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="110" x="225.42" y="494.0294">[Peer not found locally]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="89" x="235.92" y="505.0294">/Create draft route</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="155" x="465.775" y="783.2272">Mon Mar 14 09:39:38 MDT 2022</text><!--MD5=[198d99b70e7553a4359d5ca938122a67]
@startuml
!include common.puml

$title(Route Discovery States)
'[*] - -> void

'States are determined by a combination of values, as defined here:
state tryable {
  state none
  state "pend.X" as timeout
'  state "pend.Z" as unknown
}
state liftUpdate {
  state good
  state pend
  state "good.X" as stale
}

'State details:
draft: Stat: draft, time: N/A
pend: Stat: pend, time: OK
good: Stat: good, time: OK
stale: Stat: good, time: expired
none: Stat: none, time: N/A
timeout: Stat: pend, time: expired
'unknown: Stat: pend, time: expired, tries: max
liftUpdate: Lift success/failure will provide more up-to-date status
tryable: May retry upstream query for new information from time to time
tryable: Routes also subject to optional deletion after long expiration time

'State transition rules:
[*] -up[$peer]-> [*]: $trans($peer,Receive Act:query,'Route impossible',Reply Act: none)
[*] -up[$peer]-> [*]: $trans($peer,Receive Act:query,'Peer found locally',Reply Act: good)

[*] -[$user]-> draft: $trans($user,User initiates route,'',Create new route)
[*] -[$peer]-> draft: $trans($peer,Receive Act:query,'Peer not found locally',Create draft route)
[*] - -> draft: $trans(cron,Agent initiates route,'',Create new route)

draft -[$db]-> pend: $trans($db,draft detected,'',Forward Upstream Act:query)

pend -up[$peer]-> good: $trans($peer,Receive Act:good,Local request,Notify user)
pend -up[$peer]-> good: $trans($peer,Receive Act:good,External Request,Relay Downstream Act:good)
pend - -> timeout: $trans(timer,Request times out,'')

'pend -[$peer]-> none: $trans($peer,Receive Act:none,Relay Downstream Act:none)
pend -[$peer]-> none: $trans($peer,Receive Act:none,No further relay)

good - -> stale: $trans(timer,Time runs out,'')
liftUpdate - -> good: $trans(db,Lift succeeds using this route,Refresh timestamp)
liftUpdate - -> none: $trans(db,Lift fails using this route)

tryable -[$peer]-> draft: $trans($peer,Receive Act: query,Peer not found locally,Create draft route)
'timeout - -> unknown: $trans(Tries,Max retries reached)
'tryable -[$db]-> [*]: $trans($db,Delete obsolete record,Very long time)

@enduml

@startuml



skinparam backgroundColor fff
skinparam stereotypeCBackgroundColor 27d






skinparam circledCharacter {
  radius 8
  fontSize 11
  fontName Helvetica
}

skinparam class {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  attributeFontColor 333
  attributeFontSize 11
  attributeIconSize 11
}

skinparam actor {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam participant {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam collections {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam SequenceBox{
    backgroundColor e0e0e0
  borderColor cccccc
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam interface {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam component {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}



skinparam queue {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}


skinparam usecase {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam activity {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam sequence {
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  lifeLineBorderColor 4af
  lifeLineBackgroundColor e0e0e0
}




skinparam state {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
  startColor 4af
  endColor 27d
}

skinparam note {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}








  title Route Discovery States
  footer Mon Mar 14 09:39:38 MDT 2022

state tryable {
  state none
  state "pend.X" as timeout
}
state liftUpdate {
  state good
  state pend
  state "good.X" as stale
}

draft: Stat: draft, time: N/A
pend: Stat: pend, time: OK
good: Stat: good, time: OK
stale: Stat: good, time: expired
none: Stat: none, time: N/A
timeout: Stat: pend, time: expired
liftUpdate: Lift success/failure will provide more up-to-date status
tryable: May retry upstream query for new information from time to time
tryable: Routes also subject to optional deletion after long expiration time

[*] -up[#blue]-> [*]: <font color=blue>Peer:\nReceive Act:query\n[Route impossible]\n/Reply Act: none
[*] -up[#blue]-> [*]: <font color=blue>Peer:\nReceive Act:query\n[Peer found locally]\n/Reply Act: good

[*] -[#green]-> draft: <font color=green>User:\nUser initiates route\n/Create new route
[*] -[#blue]-> draft: <font color=blue>Peer:\nReceive Act:query\n[Peer not found locally]\n/Create draft route
[*] - -> draft: <font color=black>cron:\nAgent initiates route\n/Create new route

draft -[#red]-> pend: <font color=red>DB Trigger:\ndraft detected\n/Forward Upstream Act:query

pend -up[#blue]-> good: <font color=blue>Peer:\nReceive Act:good\n[Local request]\n/Notify user
pend -up[#blue]-> good: <font color=blue>Peer:\nReceive Act:good\n[External Request]\n/Relay Downstream Act:good
pend - -> timeout: <font color=black>timer:\nRequest times out

pend -[#blue]-> none: <font color=blue>Peer:\nReceive Act:none\n[No further relay]

good - -> stale: <font color=black>timer:\nTime runs out
liftUpdate - -> good: <font color=black>db:\nLift succeeds using this route\n[Refresh timestamp]
liftUpdate - -> none: <font color=black>db:\nLift fails using this route

tryable -[#blue]-> draft: <font color=blue>Peer:\nReceive Act: query\n[Peer not found locally]\n/Create draft route

@enduml

PlantUML version 1.2022.1(Tue Feb 01 11:19:58 MST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>