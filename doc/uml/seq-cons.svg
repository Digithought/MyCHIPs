<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="987px" preserveAspectRatio="none" style="width:581px;height:987px;background:#FFFFFF;" version="1.1" viewBox="0 0 581 987" width="581px" zoomAndPan="magnify"><defs><filter height="300%" id="f90nqocsdn1p4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="266" x="155.75" y="29.4023">Chit Chain Consensus Protocol</text><rect fill="#FFFFFF" filter="url(#f90nqocsdn1p4)" height="531.8867" style="stroke:#000000;stroke-width:2.0;" width="410.5" x="123" y="135.1992"/><rect fill="#FFFFFF" filter="url(#f90nqocsdn1p4)" height="175.3105" style="stroke:#000000;stroke-width:2.0;" width="349.5" x="133" y="244.5098"/><rect fill="#FFFFFF" height="240.2656" style="stroke:none;stroke-width:1.0;" width="410.5" x="123" y="426.8203"/><rect fill="#FFFFFF" filter="url(#f90nqocsdn1p4)" height="101.3105" style="stroke:#000000;stroke-width:2.0;" width="266" x="133" y="533.7754"/><rect fill="#FFFFFF" filter="url(#f90nqocsdn1p4)" height="154.3105" style="stroke:#000000;stroke-width:2.0;" width="557.5" x="10" y="717.0859"/><rect fill="#FFFFFF" height="77" style="stroke:none;stroke-width:1.0;" width="557.5" x="10" y="794.3965"/><line style="stroke:#44AAFF;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="54" x2="54" y1="118.1992" y2="888.3965"/><line style="stroke:#44AAFF;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="175" x2="175" y1="118.1992" y2="888.3965"/><line style="stroke:#44AAFF;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="359" x2="359" y1="118.1992" y2="888.3965"/><line style="stroke:#44AAFF;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="528.5" x2="528.5" y1="118.1992" y2="888.3965"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="63" x="20" y="115.6694">Stock Holder</text><ellipse cx="54.5" cy="50.1992" fill="#44AAFF" filter="url(#f90nqocsdn1p4)" rx="8" ry="8" style="stroke:#2277DD;stroke-width:2.0;"/><path d="M54.5,58.1992 L54.5,85.1992 M41.5,66.1992 L67.5,66.1992 M54.5,85.1992 L41.5,100.1992 M54.5,85.1992 L67.5,100.1992 " fill="none" filter="url(#f90nqocsdn1p4)" style="stroke:#2277DD;stroke-width:2.0;"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="63" x="20" y="895.8667">Stock Holder</text><ellipse cx="54.5" cy="908.3965" fill="#44AAFF" filter="url(#f90nqocsdn1p4)" rx="8" ry="8" style="stroke:#2277DD;stroke-width:2.0;"/><path d="M54.5,916.3965 L54.5,943.3965 M41.5,924.3965 L67.5,924.3965 M54.5,943.3965 L41.5,958.3965 M54.5,943.3965 L67.5,958.3965 " fill="none" filter="url(#f90nqocsdn1p4)" style="stroke:#2277DD;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="143" y="115.2461">Stock DB</text><path d="M157.5,65.7109 C157.5,55.7109 175.5,55.7109 175.5,55.7109 C175.5,55.7109 193.5,55.7109 193.5,65.7109 L193.5,91.7109 C193.5,101.7109 175.5,101.7109 175.5,101.7109 C175.5,101.7109 157.5,101.7109 157.5,91.7109 L157.5,65.7109 " fill="#FEFECE" filter="url(#f90nqocsdn1p4)" style="stroke:#000000;stroke-width:1.5;"/><path d="M157.5,65.7109 C157.5,75.7109 175.5,75.7109 175.5,75.7109 C175.5,75.7109 193.5,75.7109 193.5,65.7109 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="143" y="900.9316">Stock DB</text><path d="M157.5,913.8848 C157.5,903.8848 175.5,903.8848 175.5,903.8848 C175.5,903.8848 193.5,903.8848 193.5,913.8848 L193.5,939.8848 C193.5,949.8848 175.5,949.8848 175.5,949.8848 C175.5,949.8848 157.5,949.8848 157.5,939.8848 L157.5,913.8848 " fill="#FEFECE" filter="url(#f90nqocsdn1p4)" style="stroke:#000000;stroke-width:1.5;"/><path d="M157.5,913.8848 C157.5,923.8848 175.5,923.8848 175.5,923.8848 C175.5,923.8848 193.5,923.8848 193.5,913.8848 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="333" y="115.2461">Foil DB</text><path d="M341.5,65.7109 C341.5,55.7109 359.5,55.7109 359.5,55.7109 C359.5,55.7109 377.5,55.7109 377.5,65.7109 L377.5,91.7109 C377.5,101.7109 359.5,101.7109 359.5,101.7109 C359.5,101.7109 341.5,101.7109 341.5,91.7109 L341.5,65.7109 " fill="#FEFECE" filter="url(#f90nqocsdn1p4)" style="stroke:#000000;stroke-width:1.5;"/><path d="M341.5,65.7109 C341.5,75.7109 359.5,75.7109 359.5,75.7109 C359.5,75.7109 377.5,75.7109 377.5,65.7109 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="333" y="900.9316">Foil DB</text><path d="M341.5,913.8848 C341.5,903.8848 359.5,903.8848 359.5,903.8848 C359.5,903.8848 377.5,903.8848 377.5,913.8848 L377.5,939.8848 C377.5,949.8848 359.5,949.8848 359.5,949.8848 C359.5,949.8848 341.5,949.8848 341.5,939.8848 L341.5,913.8848 " fill="#FEFECE" filter="url(#f90nqocsdn1p4)" style="stroke:#000000;stroke-width:1.5;"/><path d="M341.5,913.8848 C341.5,923.8848 359.5,923.8848 359.5,923.8848 C359.5,923.8848 377.5,923.8848 377.5,913.8848 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="52" x="499.5" y="115.6694">Foil Holder</text><ellipse cx="528.5" cy="50.1992" fill="#44AAFF" filter="url(#f90nqocsdn1p4)" rx="8" ry="8" style="stroke:#2277DD;stroke-width:2.0;"/><path d="M528.5,58.1992 L528.5,85.1992 M515.5,66.1992 L541.5,66.1992 M528.5,85.1992 L515.5,100.1992 M528.5,85.1992 L541.5,100.1992 " fill="none" filter="url(#f90nqocsdn1p4)" style="stroke:#2277DD;stroke-width:2.0;"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="52" x="499.5" y="895.8667">Foil Holder</text><ellipse cx="528.5" cy="908.3965" fill="#44AAFF" filter="url(#f90nqocsdn1p4)" rx="8" ry="8" style="stroke:#2277DD;stroke-width:2.0;"/><path d="M528.5,916.3965 L528.5,943.3965 M515.5,924.3965 L541.5,924.3965 M528.5,943.3965 L515.5,958.3965 M528.5,943.3965 L541.5,958.3965 " fill="none" filter="url(#f90nqocsdn1p4)" style="stroke:#2277DD;stroke-width:2.0;"/><path d="M123,135.1992 L185,135.1992 L185,142.1992 L175,152.1992 L123,152.1992 L123,135.1992 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="531.8867" style="stroke:#000000;stroke-width:2.0;" width="410.5" x="123" y="135.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="138" y="148.7676">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="179" x="200" y="147.834">[Stock originates/validates chit]</text><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="217.5" y1="169.5098" y2="169.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="217.5" x2="217.5" y1="169.5098" y2="182.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="217.5" y1="182.5098" y2="182.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="186.5" y1="182.5098" y2="178.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="186.5" y1="182.5098" y2="186.5098"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="155" x="182.5" y="164.98">Apply validating signature to chit</text><line style="stroke:#000000;stroke-width:1.0;" x1="357.5" x2="347.5" y1="229.5098" y2="225.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="357.5" x2="347.5" y1="229.5098" y2="233.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="358.5" y1="229.5098" y2="229.5098"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="113" x="182.5" y="202.98">Transmit new valid Chit</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="115" x="182.5" y="213.98">with validating signature</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="148" x="182.5" y="224.98">Proposed endHash: propHash</text><path d="M133,244.5098 L195,244.5098 L195,251.5098 L185,261.5098 L133,261.5098 L133,244.5098 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="175.3105" style="stroke:#000000;stroke-width:2.0;" width="349.5" x="133" y="244.5098"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="148" y="258.0781">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="246" x="210" y="257.1445">[Foil agrees with stock's proposed endhash]</text><line style="stroke:#000000;stroke-width:1.0;" x1="359.5" x2="401.5" y1="289.8203" y2="289.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="401.5" x2="401.5" y1="289.8203" y2="302.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="360.5" x2="401.5" y1="302.8203" y2="302.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="360.5" x2="370.5" y1="302.8203" y2="298.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="360.5" x2="370.5" y1="302.8203" y2="306.8203"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="78" x="366.5" y="274.2905">Ratchet forward</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="104" x="366.5" y="285.2905">ackHash = propHash</text><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="185.5" y1="327.8203" y2="323.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="185.5" y1="327.8203" y2="331.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="358.5" y1="327.8203" y2="327.8203"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="116" x="192.5" y="323.2905">Acknowledge propHash</text><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="217.5" y1="363.8203" y2="363.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="217.5" x2="217.5" y1="363.8203" y2="376.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="217.5" y1="376.8203" y2="376.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="186.5" y1="376.8203" y2="372.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="186.5" y1="376.8203" y2="380.8203"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="78" x="182.5" y="348.2905">Ratchet forward</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="104" x="182.5" y="359.2905">ackHash = propHash</text><path d="M147,389.8203 L147,410.8203 L200,410.8203 L200,399.8203 L190,389.8203 L147,389.8203 " fill="#E8E8EA" filter="url(#f90nqocsdn1p4)" style="stroke:#202024;stroke-width:1.0;"/><path d="M190,389.8203 L190,399.8203 L200,399.8203 L190,389.8203 " fill="#E8E8EA" style="stroke:#202024;stroke-width:1.0;"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="32" x="153" y="403.2905">DONE</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="123" x2="533.5" y1="427.8203" y2="427.8203"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="170" x="128" y="438.4551">[Foil originates/validates chit]</text><line style="stroke:#000000;stroke-width:1.0;" x1="359.5" x2="401.5" y1="458.7754" y2="458.7754"/><line style="stroke:#000000;stroke-width:1.0;" x1="401.5" x2="401.5" y1="458.7754" y2="471.7754"/><line style="stroke:#000000;stroke-width:1.0;" x1="360.5" x2="401.5" y1="471.7754" y2="471.7754"/><line style="stroke:#000000;stroke-width:1.0;" x1="360.5" x2="370.5" y1="471.7754" y2="467.7754"/><line style="stroke:#000000;stroke-width:1.0;" x1="360.5" x2="370.5" y1="471.7754" y2="475.7754"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="155" x="366.5" y="454.2456">Apply validating signature to chit</text><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="185.5" y1="518.7754" y2="514.7754"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="185.5" y1="518.7754" y2="522.7754"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="358.5" y1="518.7754" y2="518.7754"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="113" x="192.5" y="492.2456">Transmit new valid Chit</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="115" x="192.5" y="503.2456">with validating signature</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="89" x="192.5" y="514.2456">And new endHash</text><path d="M133,533.7754 L195,533.7754 L195,540.7754 L185,550.7754 L133,550.7754 L133,533.7754 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="101.3105" style="stroke:#000000;stroke-width:2.0;" width="266" x="133" y="533.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="148" y="547.3438">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="184" x="210" y="546.4102">[Stock agrees with new endHash]</text><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="217.5" y1="579.0859" y2="579.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="217.5" x2="217.5" y1="579.0859" y2="592.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="217.5" y1="592.0859" y2="592.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="186.5" y1="592.0859" y2="588.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="186.5" y1="592.0859" y2="596.0859"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="78" x="182.5" y="563.5562">Ratchet forward</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="100" x="182.5" y="574.5562">ackHash = endHash</text><path d="M147,605.0859 L147,626.0859 L200,626.0859 L200,615.0859 L190,605.0859 L147,605.0859 " fill="#E8E8EA" filter="url(#f90nqocsdn1p4)" style="stroke:#202024;stroke-width:1.0;"/><path d="M190,605.0859 L190,615.0859 L200,615.0859 L190,605.0859 " fill="#E8E8EA" style="stroke:#202024;stroke-width:1.0;"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="32" x="153" y="618.5562">DONE</text><line style="stroke:#000000;stroke-width:1.0;" x1="357.5" x2="347.5" y1="659.0859" y2="655.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="357.5" x2="347.5" y1="659.0859" y2="663.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="358.5" y1="659.0859" y2="659.0859"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="160" x="182.5" y="654.5562">Compare my list of unlinked chits</text><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="185.5" y1="702.0859" y2="698.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="185.5" y1="702.0859" y2="706.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="358.5" y1="702.0859" y2="702.0859"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="147" x="192.5" y="686.5562">Send chits since last ackHash</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="88" x="192.5" y="697.5562">and new endHash</text><path d="M10,717.0859 L72,717.0859 L72,724.0859 L62,734.0859 L10,734.0859 L10,717.0859 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="154.3105" style="stroke:#000000;stroke-width:2.0;" width="557.5" x="10" y="717.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="730.6543">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="239" x="87" y="729.7207">[All stock's chits under endHash are valid]</text><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="217.5" y1="773.3965" y2="773.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="217.5" x2="217.5" y1="773.3965" y2="786.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="217.5" y1="786.3965" y2="786.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="186.5" y1="786.3965" y2="782.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="186.5" y1="786.3965" y2="790.3965"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="53" x="182.5" y="746.8667">Apply chits</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="78" x="182.5" y="757.8667">Ratchet forward</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="100" x="182.5" y="768.8667">ackHash = endHash</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="567.5" y1="795.3965" y2="795.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="54.5" x2="64.5" y1="813.3965" y2="809.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="54.5" x2="64.5" y1="813.3965" y2="817.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="54.5" x2="174.5" y1="813.3965" y2="813.3965"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="97" x="71.5" y="808.8667">Report error to user</text><line style="stroke:#000000;stroke-width:1.0;" x1="357.5" x2="347.5" y1="838.3965" y2="834.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="357.5" x2="347.5" y1="838.3965" y2="842.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="358.5" y1="838.3965" y2="838.3965"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="60" x="182.5" y="833.8667">Report error</text><line style="stroke:#000000;stroke-width:1.0;" x1="526.5" x2="516.5" y1="863.3965" y2="859.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="526.5" x2="516.5" y1="863.3965" y2="867.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="359.5" x2="527.5" y1="863.3965" y2="863.3965"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="97" x="366.5" y="858.8667">Report error to user</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="150" x="213.75" y="979.0645">Sat May 28 13:05:36 MDT 2022</text><!--MD5=[a4a73495bd9733f263b751e9e05eecd9]
@startuml
!include common.puml
$title(Chit Chain Consensus Protocol)
actor "Stock Holder" as vendor
database "Stock DB" as stock
database "Foil DB" as foil
actor "Foil Holder" as client

alt Stock originates/validates chit
  stock		->>	stock:		Apply validating signature to chit
  stock		->>	foil:		Transmit new valid Chit\nwith validating signature\nProposed endHash: propHash

  alt Foil agrees with stock's proposed endhash
    foil		->>	foil:		Ratchet forward\nackHash = propHash
    foil		->>	stock:		Acknowledge propHash
    stock		->>	stock:		Ratchet forward\nackHash = propHash
    note over stock: DONE
  end

else Foil originates/validates chit
  foil		->>	foil:		Apply validating signature to chit
  foil		->>	stock:		Transmit new valid Chit\nwith validating signature\nAnd new endHash

  alt Stock agrees with new endHash
    stock		->>	stock:		Ratchet forward\nackHash = endHash
    note over stock: DONE
  end
  
  stock		->>	foil:		Compare my list of unlinked chits
end

foil		->>	stock:		Send chits since last ackHash\nand new endHash
    
alt All stock's chits under endHash are valid
  stock		->>	stock:		Apply chits\nRatchet forward\nackHash = endHash
else
  stock		->>	vendor:		Report error to user
  stock		->>	foil:		Report error
  foil		->>	client:		Report error to user
end

@enduml

@startuml



skinparam backgroundColor fff
skinparam stereotypeCBackgroundColor 27d






skinparam circledCharacter {
  radius 8
  fontSize 11
  fontName Helvetica
}

skinparam class {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  attributeFontColor 333
  attributeFontSize 11
  attributeIconSize 11
}

skinparam actor {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam participant {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam collections {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam SequenceBox{
    backgroundColor e0e0e0
  borderColor cccccc
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam interface {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam component {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}



skinparam queue {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}


skinparam usecase {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam activity {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam sequence {
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  lifeLineBorderColor 4af
  lifeLineBackgroundColor e0e0e0
}




skinparam state {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
  startColor 4af
  endColor 27d
}

skinparam note {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}







  title Chit Chain Consensus Protocol
  footer Sat May 28 13:05:36 MDT 2022
actor "Stock Holder" as vendor
database "Stock DB" as stock
database "Foil DB" as foil
actor "Foil Holder" as client

alt Stock originates/validates chit
  stock		->>	stock:		Apply validating signature to chit
  stock		->>	foil:		Transmit new valid Chit\nwith validating signature\nProposed endHash: propHash

  alt Foil agrees with stock's proposed endhash
    foil		->>	foil:		Ratchet forward\nackHash = propHash
    foil		->>	stock:		Acknowledge propHash
    stock		->>	stock:		Ratchet forward\nackHash = propHash
    note over stock: DONE
  end

else Foil originates/validates chit
  foil		->>	foil:		Apply validating signature to chit
  foil		->>	stock:		Transmit new valid Chit\nwith validating signature\nAnd new endHash

  alt Stock agrees with new endHash
    stock		->>	stock:		Ratchet forward\nackHash = endHash
    note over stock: DONE
  end
  
  stock		->>	foil:		Compare my list of unlinked chits
end

foil		->>	stock:		Send chits since last ackHash\nand new endHash
    
alt All stock's chits under endHash are valid
  stock		->>	stock:		Apply chits\nRatchet forward\nackHash = endHash
else
  stock		->>	vendor:		Report error to user
  stock		->>	foil:		Report error
  foil		->>	client:		Report error to user
end

@enduml

PlantUML version 1.2022.1(Tue Feb 01 11:19:58 MST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>