<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1090px" preserveAspectRatio="none" style="width:649px;height:1090px;background:#FFFFFF;" version="1.1" viewBox="0 0 649 1090" width="649px" zoomAndPan="magnify"><defs><filter height="300%" id="f9ovetthgn58v" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="266" x="189.75" y="29.4023">Chit Chain Consensus Protocol</text><rect fill="#FFFFFF" filter="url(#f9ovetthgn58v)" height="543.8867" style="stroke:#000000;stroke-width:2.0;" width="625.5" x="10" y="135.1992"/><rect fill="#FFFFFF" filter="url(#f9ovetthgn58v)" height="175.3105" style="stroke:#000000;stroke-width:2.0;" width="349.5" x="191" y="269.5098"/><rect fill="#FFFFFF" height="227.2656" style="stroke:none;stroke-width:1.0;" width="625.5" x="10" y="451.8203"/><rect fill="#FFFFFF" filter="url(#f9ovetthgn58v)" height="101.3105" style="stroke:#000000;stroke-width:2.0;" width="266" x="191" y="545.7754"/><rect fill="#FFFFFF" filter="url(#f9ovetthgn58v)" height="167.2656" style="stroke:#000000;stroke-width:2.0;" width="625.5" x="10" y="729.0859"/><rect fill="#FFFFFF" height="89.9551" style="stroke:none;stroke-width:1.0;" width="625.5" x="10" y="806.3965"/><rect fill="#FFFFFF" filter="url(#f9ovetthgn58v)" height="64.3105" style="stroke:#000000;stroke-width:2.0;" width="340" x="191" y="910.3516"/><line style="stroke:#44AAFF;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="54" x2="54" y1="118.1992" y2="991.6621"/><line style="stroke:#44AAFF;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="233" x2="233" y1="118.1992" y2="991.6621"/><line style="stroke:#44AAFF;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="417" x2="417" y1="118.1992" y2="991.6621"/><line style="stroke:#44AAFF;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="596.5" x2="596.5" y1="118.1992" y2="991.6621"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="63" x="20" y="115.6694">Stock Holder</text><ellipse cx="54.5" cy="50.1992" fill="#44AAFF" filter="url(#f9ovetthgn58v)" rx="8" ry="8" style="stroke:#2277DD;stroke-width:2.0;"/><path d="M54.5,58.1992 L54.5,85.1992 M41.5,66.1992 L67.5,66.1992 M54.5,85.1992 L41.5,100.1992 M54.5,85.1992 L67.5,100.1992 " fill="none" filter="url(#f9ovetthgn58v)" style="stroke:#2277DD;stroke-width:2.0;"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="63" x="20" y="999.1323">Stock Holder</text><ellipse cx="54.5" cy="1011.6621" fill="#44AAFF" filter="url(#f9ovetthgn58v)" rx="8" ry="8" style="stroke:#2277DD;stroke-width:2.0;"/><path d="M54.5,1019.6621 L54.5,1046.6621 M41.5,1027.6621 L67.5,1027.6621 M54.5,1046.6621 L41.5,1061.6621 M54.5,1046.6621 L67.5,1061.6621 " fill="none" filter="url(#f9ovetthgn58v)" style="stroke:#2277DD;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="201" y="115.2461">Stock DB</text><path d="M215.5,65.7109 C215.5,55.7109 233.5,55.7109 233.5,55.7109 C233.5,55.7109 251.5,55.7109 251.5,65.7109 L251.5,91.7109 C251.5,101.7109 233.5,101.7109 233.5,101.7109 C233.5,101.7109 215.5,101.7109 215.5,91.7109 L215.5,65.7109 " fill="#FEFECE" filter="url(#f9ovetthgn58v)" style="stroke:#000000;stroke-width:1.5;"/><path d="M215.5,65.7109 C215.5,75.7109 233.5,75.7109 233.5,75.7109 C233.5,75.7109 251.5,75.7109 251.5,65.7109 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="201" y="1004.1973">Stock DB</text><path d="M215.5,1017.1504 C215.5,1007.1504 233.5,1007.1504 233.5,1007.1504 C233.5,1007.1504 251.5,1007.1504 251.5,1017.1504 L251.5,1043.1504 C251.5,1053.1504 233.5,1053.1504 233.5,1053.1504 C233.5,1053.1504 215.5,1053.1504 215.5,1043.1504 L215.5,1017.1504 " fill="#FEFECE" filter="url(#f9ovetthgn58v)" style="stroke:#000000;stroke-width:1.5;"/><path d="M215.5,1017.1504 C215.5,1027.1504 233.5,1027.1504 233.5,1027.1504 C233.5,1027.1504 251.5,1027.1504 251.5,1017.1504 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="391" y="115.2461">Foil DB</text><path d="M399.5,65.7109 C399.5,55.7109 417.5,55.7109 417.5,55.7109 C417.5,55.7109 435.5,55.7109 435.5,65.7109 L435.5,91.7109 C435.5,101.7109 417.5,101.7109 417.5,101.7109 C417.5,101.7109 399.5,101.7109 399.5,91.7109 L399.5,65.7109 " fill="#FEFECE" filter="url(#f9ovetthgn58v)" style="stroke:#000000;stroke-width:1.5;"/><path d="M399.5,65.7109 C399.5,75.7109 417.5,75.7109 417.5,75.7109 C417.5,75.7109 435.5,75.7109 435.5,65.7109 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="391" y="1004.1973">Foil DB</text><path d="M399.5,1017.1504 C399.5,1007.1504 417.5,1007.1504 417.5,1007.1504 C417.5,1007.1504 435.5,1007.1504 435.5,1017.1504 L435.5,1043.1504 C435.5,1053.1504 417.5,1053.1504 417.5,1053.1504 C417.5,1053.1504 399.5,1053.1504 399.5,1043.1504 L399.5,1017.1504 " fill="#FEFECE" filter="url(#f9ovetthgn58v)" style="stroke:#000000;stroke-width:1.5;"/><path d="M399.5,1017.1504 C399.5,1027.1504 417.5,1027.1504 417.5,1027.1504 C417.5,1027.1504 435.5,1027.1504 435.5,1017.1504 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="52" x="567.5" y="115.6694">Foil Holder</text><ellipse cx="596.5" cy="50.1992" fill="#44AAFF" filter="url(#f9ovetthgn58v)" rx="8" ry="8" style="stroke:#2277DD;stroke-width:2.0;"/><path d="M596.5,58.1992 L596.5,85.1992 M583.5,66.1992 L609.5,66.1992 M596.5,85.1992 L583.5,100.1992 M596.5,85.1992 L609.5,100.1992 " fill="none" filter="url(#f9ovetthgn58v)" style="stroke:#2277DD;stroke-width:2.0;"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="52" x="567.5" y="999.1323">Foil Holder</text><ellipse cx="596.5" cy="1011.6621" fill="#44AAFF" filter="url(#f9ovetthgn58v)" rx="8" ry="8" style="stroke:#2277DD;stroke-width:2.0;"/><path d="M596.5,1019.6621 L596.5,1046.6621 M583.5,1027.6621 L609.5,1027.6621 M596.5,1046.6621 L583.5,1061.6621 M596.5,1046.6621 L609.5,1061.6621 " fill="none" filter="url(#f9ovetthgn58v)" style="stroke:#2277DD;stroke-width:2.0;"/><path d="M10,135.1992 L72,135.1992 L72,142.1992 L62,152.1992 L10,152.1992 L10,135.1992 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="543.8867" style="stroke:#000000;stroke-width:2.0;" width="625.5" x="10" y="135.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="148.7676">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="179" x="87" y="147.834">[Stock originates/validates chit]</text><line style="stroke:#000000;stroke-width:1.0;" x1="231.5" x2="221.5" y1="169.5098" y2="165.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="231.5" x2="221.5" y1="169.5098" y2="173.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="54.5" x2="232.5" y1="169.5098" y2="169.5098"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="155" x="61.5" y="164.98">Apply validating signature to chit</text><line style="stroke:#000000;stroke-width:1.0;" x1="415.5" x2="405.5" y1="216.5098" y2="212.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="415.5" x2="405.5" y1="216.5098" y2="220.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="233.5" x2="416.5" y1="216.5098" y2="216.5098"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="113" x="240.5" y="189.98">Transmit new valid Chit</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="115" x="240.5" y="200.98">with validating signature</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="148" x="240.5" y="211.98">Proposed endHash: propHash</text><line style="stroke:#000000;stroke-width:1.0;" x1="417.5" x2="459.5" y1="241.5098" y2="241.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="459.5" x2="459.5" y1="241.5098" y2="254.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="418.5" x2="459.5" y1="254.5098" y2="254.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="418.5" x2="428.5" y1="254.5098" y2="250.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="418.5" x2="428.5" y1="254.5098" y2="258.5098"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="106" x="424.5" y="236.98">Add/link new valid chit</text><path d="M191,269.5098 L253,269.5098 L253,276.5098 L243,286.5098 L191,286.5098 L191,269.5098 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="175.3105" style="stroke:#000000;stroke-width:2.0;" width="349.5" x="191" y="269.5098"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="206" y="283.0781">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="246" x="268" y="282.1445">[Foil agrees with stock's proposed endhash]</text><line style="stroke:#000000;stroke-width:1.0;" x1="417.5" x2="459.5" y1="314.8203" y2="314.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="459.5" x2="459.5" y1="314.8203" y2="327.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="418.5" x2="459.5" y1="327.8203" y2="327.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="418.5" x2="428.5" y1="327.8203" y2="323.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="418.5" x2="428.5" y1="327.8203" y2="331.8203"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="78" x="424.5" y="299.2905">Ratchet forward</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="104" x="424.5" y="310.2905">ackHash = propHash</text><line style="stroke:#000000;stroke-width:1.0;" x1="233.5" x2="243.5" y1="352.8203" y2="348.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="233.5" x2="243.5" y1="352.8203" y2="356.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="233.5" x2="416.5" y1="352.8203" y2="352.8203"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="116" x="250.5" y="348.2905">Acknowledge propHash</text><line style="stroke:#000000;stroke-width:1.0;" x1="233.5" x2="275.5" y1="388.8203" y2="388.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="275.5" x2="275.5" y1="388.8203" y2="401.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="234.5" x2="275.5" y1="401.8203" y2="401.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="234.5" x2="244.5" y1="401.8203" y2="397.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="234.5" x2="244.5" y1="401.8203" y2="405.8203"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="78" x="240.5" y="373.2905">Ratchet forward</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="104" x="240.5" y="384.2905">ackHash = propHash</text><path d="M205,414.8203 L205,435.8203 L258,435.8203 L258,424.8203 L248,414.8203 L205,414.8203 " fill="#E8E8EA" filter="url(#f9ovetthgn58v)" style="stroke:#202024;stroke-width:1.0;"/><path d="M248,414.8203 L248,424.8203 L258,424.8203 L248,414.8203 " fill="#E8E8EA" style="stroke:#202024;stroke-width:1.0;"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="32" x="211" y="428.2905">DONE</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="635.5" y1="452.8203" y2="452.8203"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="170" x="15" y="463.4551">[Foil originates/validates chit]</text><line style="stroke:#000000;stroke-width:1.0;" x1="417.5" x2="427.5" y1="483.7754" y2="479.7754"/><line style="stroke:#000000;stroke-width:1.0;" x1="417.5" x2="427.5" y1="483.7754" y2="487.7754"/><line style="stroke:#000000;stroke-width:1.0;" x1="417.5" x2="595.5" y1="483.7754" y2="483.7754"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="155" x="434.5" y="479.2456">Apply validating signature to chit</text><line style="stroke:#000000;stroke-width:1.0;" x1="233.5" x2="243.5" y1="530.7754" y2="526.7754"/><line style="stroke:#000000;stroke-width:1.0;" x1="233.5" x2="243.5" y1="530.7754" y2="534.7754"/><line style="stroke:#000000;stroke-width:1.0;" x1="233.5" x2="416.5" y1="530.7754" y2="530.7754"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="113" x="250.5" y="504.2456">Transmit new valid Chit</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="115" x="250.5" y="515.2456">with validating signature</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="89" x="250.5" y="526.2456">And new endHash</text><path d="M191,545.7754 L253,545.7754 L253,552.7754 L243,562.7754 L191,562.7754 L191,545.7754 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="101.3105" style="stroke:#000000;stroke-width:2.0;" width="266" x="191" y="545.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="206" y="559.3438">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="184" x="268" y="558.4102">[Stock agrees with new endHash]</text><line style="stroke:#000000;stroke-width:1.0;" x1="233.5" x2="275.5" y1="591.0859" y2="591.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="275.5" x2="275.5" y1="591.0859" y2="604.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="234.5" x2="275.5" y1="604.0859" y2="604.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="234.5" x2="244.5" y1="604.0859" y2="600.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="234.5" x2="244.5" y1="604.0859" y2="608.0859"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="78" x="240.5" y="575.5562">Ratchet forward</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="100" x="240.5" y="586.5562">ackHash = endHash</text><path d="M205,617.0859 L205,638.0859 L258,638.0859 L258,627.0859 L248,617.0859 L205,617.0859 " fill="#E8E8EA" filter="url(#f9ovetthgn58v)" style="stroke:#202024;stroke-width:1.0;"/><path d="M248,617.0859 L248,627.0859 L258,627.0859 L248,617.0859 " fill="#E8E8EA" style="stroke:#202024;stroke-width:1.0;"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="32" x="211" y="630.5562">DONE</text><line style="stroke:#000000;stroke-width:1.0;" x1="415.5" x2="405.5" y1="671.0859" y2="667.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="415.5" x2="405.5" y1="671.0859" y2="675.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="233.5" x2="416.5" y1="671.0859" y2="671.0859"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="160" x="240.5" y="666.5562">Compare my list of unlinked chits</text><line style="stroke:#000000;stroke-width:1.0;" x1="233.5" x2="243.5" y1="714.0859" y2="710.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="233.5" x2="243.5" y1="714.0859" y2="718.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="233.5" x2="416.5" y1="714.0859" y2="714.0859"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="147" x="250.5" y="698.5562">Send chits since last ackHash</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="88" x="250.5" y="709.5562">and new endHash</text><path d="M10,729.0859 L72,729.0859 L72,736.0859 L62,746.0859 L10,746.0859 L10,729.0859 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="167.2656" style="stroke:#000000;stroke-width:2.0;" width="625.5" x="10" y="729.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="742.6543">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="195" x="87" y="741.7207">[All newly received chits are valid]</text><line style="stroke:#000000;stroke-width:1.0;" x1="233.5" x2="275.5" y1="785.3965" y2="785.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="275.5" x2="275.5" y1="785.3965" y2="798.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="234.5" x2="275.5" y1="798.3965" y2="798.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="234.5" x2="244.5" y1="798.3965" y2="794.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="234.5" x2="244.5" y1="798.3965" y2="802.3965"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="53" x="240.5" y="758.8667">Apply chits</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="78" x="240.5" y="769.8667">Ratchet forward</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="100" x="240.5" y="780.8667">ackHash = endHash</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="635.5" y1="807.3965" y2="807.3965"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="214" x="15" y="818.0313">[Can't reconcile/accept received chits]</text><line style="stroke:#000000;stroke-width:1.0;" x1="54.5" x2="64.5" y1="838.3516" y2="834.3516"/><line style="stroke:#000000;stroke-width:1.0;" x1="54.5" x2="64.5" y1="838.3516" y2="842.3516"/><line style="stroke:#000000;stroke-width:1.0;" x1="54.5" x2="232.5" y1="838.3516" y2="838.3516"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="97" x="71.5" y="833.8218">Report error to user</text><line style="stroke:#000000;stroke-width:1.0;" x1="415.5" x2="405.5" y1="863.3516" y2="859.3516"/><line style="stroke:#000000;stroke-width:1.0;" x1="415.5" x2="405.5" y1="863.3516" y2="867.3516"/><line style="stroke:#000000;stroke-width:1.0;" x1="233.5" x2="416.5" y1="863.3516" y2="863.3516"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="60" x="240.5" y="858.8218">Report error</text><line style="stroke:#000000;stroke-width:1.0;" x1="594.5" x2="584.5" y1="888.3516" y2="884.3516"/><line style="stroke:#000000;stroke-width:1.0;" x1="594.5" x2="584.5" y1="888.3516" y2="892.3516"/><line style="stroke:#000000;stroke-width:1.0;" x1="417.5" x2="595.5" y1="888.3516" y2="888.3516"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="97" x="424.5" y="883.8218">Report error to user</text><path d="M191,910.3516 L253,910.3516 L253,917.3516 L243,927.3516 L191,927.3516 L191,910.3516 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="64.3105" style="stroke:#000000;stroke-width:2.0;" width="340" x="191" y="910.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="206" y="923.9199">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="258" x="268" y="922.9863">[Does foil still have any valid, unlinked chits]</text><line style="stroke:#000000;stroke-width:1.0;" x1="415.5" x2="405.5" y1="966.6621" y2="962.6621"/><line style="stroke:#000000;stroke-width:1.0;" x1="415.5" x2="405.5" y1="966.6621" y2="970.6621"/><line style="stroke:#000000;stroke-width:1.0;" x1="233.5" x2="416.5" y1="966.6621" y2="966.6621"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="107" x="240.5" y="940.1323">Requeue/retry regular</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="110" x="240.5" y="951.1323">chit transmission to foil</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="121" x="240.5" y="962.1323">(return to top of diagram)</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="152" x="246.75" y="1082.3301">Thu Aug 18 15:25:44 MDT 2022</text><!--MD5=[a63f1db38be9cd634557d2a5130c4d70]
@startuml
!include common.puml
$title(Chit Chain Consensus Protocol)
actor "Stock Holder" as vendor
database "Stock DB" as stock
database "Foil DB" as foil
actor "Foil Holder" as client

alt Stock originates/validates chit
  vendor	->>	stock:		Apply validating signature to chit
  stock		->>	foil:		Transmit new valid Chit\nwith validating signature\nProposed endHash: propHash
  foil		->>	foil:		Add/link new valid chit

  alt Foil agrees with stock's proposed endhash
    foil		->>	foil:		Ratchet forward\nackHash = propHash
    foil		->>	stock:		Acknowledge propHash
    stock		->>	stock:		Ratchet forward\nackHash = propHash
    note over stock: DONE
  end

else Foil originates/validates chit
  client	->>	foil:		Apply validating signature to chit
  foil		->>	stock:		Transmit new valid Chit\nwith validating signature\nAnd new endHash

  alt Stock agrees with new endHash
    stock		->>	stock:		Ratchet forward\nackHash = endHash
    note over stock: DONE
  end
  
  stock		->>	foil:		Compare my list of unlinked chits
end

foil		->>	stock:		Send chits since last ackHash\nand new endHash
    
alt All newly received chits are valid
  stock		->>	stock:		Apply chits\nRatchet forward\nackHash = endHash
else Can't reconcile/accept received chits
  stock		->>	vendor:		Report error to user
  stock		->>	foil:		Report error
  foil		->>	client:		Report error to user
end

alt Does foil still have any valid, unlinked chits
  stock		->>	foil:		Requeue/retry regular\nchit transmission to foil\n(return to top of diagram)
end

@enduml

@startuml



skinparam backgroundColor fff
skinparam stereotypeCBackgroundColor 27d






skinparam circledCharacter {
  radius 8
  fontSize 11
  fontName Helvetica
}

skinparam class {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  attributeFontColor 333
  attributeFontSize 11
  attributeIconSize 11
}

skinparam actor {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam participant {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam collections {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam SequenceBox{
    backgroundColor e0e0e0
  borderColor cccccc
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam interface {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam component {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}



skinparam queue {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}


skinparam usecase {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam activity {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam sequence {
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  lifeLineBorderColor 4af
  lifeLineBackgroundColor e0e0e0
}




skinparam state {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
  startColor 4af
  endColor 27d
}

skinparam note {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}







  title Chit Chain Consensus Protocol
  footer Thu Aug 18 15:25:44 MDT 2022
actor "Stock Holder" as vendor
database "Stock DB" as stock
database "Foil DB" as foil
actor "Foil Holder" as client

alt Stock originates/validates chit
  vendor	->>	stock:		Apply validating signature to chit
  stock		->>	foil:		Transmit new valid Chit\nwith validating signature\nProposed endHash: propHash
  foil		->>	foil:		Add/link new valid chit

  alt Foil agrees with stock's proposed endhash
    foil		->>	foil:		Ratchet forward\nackHash = propHash
    foil		->>	stock:		Acknowledge propHash
    stock		->>	stock:		Ratchet forward\nackHash = propHash
    note over stock: DONE
  end

else Foil originates/validates chit
  client	->>	foil:		Apply validating signature to chit
  foil		->>	stock:		Transmit new valid Chit\nwith validating signature\nAnd new endHash

  alt Stock agrees with new endHash
    stock		->>	stock:		Ratchet forward\nackHash = endHash
    note over stock: DONE
  end
  
  stock		->>	foil:		Compare my list of unlinked chits
end

foil		->>	stock:		Send chits since last ackHash\nand new endHash
    
alt All newly received chits are valid
  stock		->>	stock:		Apply chits\nRatchet forward\nackHash = endHash
else Can't reconcile/accept received chits
  stock		->>	vendor:		Report error to user
  stock		->>	foil:		Report error
  foil		->>	client:		Report error to user
end

alt Does foil still have any valid, unlinked chits
  stock		->>	foil:		Requeue/retry regular\nchit transmission to foil\n(return to top of diagram)
end

@enduml

PlantUML version 1.2022.1(Tue Feb 01 11:19:58 MST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>