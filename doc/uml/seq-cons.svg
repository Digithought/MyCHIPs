<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1103px" preserveAspectRatio="none" style="width:581px;height:1103px;background:#FFFFFF;" version="1.1" viewBox="0 0 581 1103" width="581px" zoomAndPan="magnify"><defs><filter height="300%" id="f1jg7h6qbl8lw1" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="266" x="155.75" y="29.4023">Chit Chain Consensus Protocol</text><rect fill="#FFFFFF" filter="url(#f1jg7h6qbl8lw1)" height="569.8867" style="stroke:#000000;stroke-width:2.0;" width="410.5" x="123" y="135.1992"/><rect fill="#FFFFFF" filter="url(#f1jg7h6qbl8lw1)" height="175.3105" style="stroke:#000000;stroke-width:2.0;" width="349.5" x="133" y="282.5098"/><rect fill="#FFFFFF" height="240.2656" style="stroke:none;stroke-width:1.0;" width="410.5" x="123" y="464.8203"/><rect fill="#FFFFFF" filter="url(#f1jg7h6qbl8lw1)" height="101.3105" style="stroke:#000000;stroke-width:2.0;" width="266" x="133" y="571.7754"/><rect fill="#FFFFFF" filter="url(#f1jg7h6qbl8lw1)" height="154.3105" style="stroke:#000000;stroke-width:2.0;" width="557.5" x="10" y="755.0859"/><rect fill="#FFFFFF" height="77" style="stroke:none;stroke-width:1.0;" width="557.5" x="10" y="832.3965"/><rect fill="#FFFFFF" filter="url(#f1jg7h6qbl8lw1)" height="64.3105" style="stroke:#000000;stroke-width:2.0;" width="340" x="133" y="923.3965"/><line style="stroke:#44AAFF;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="54" x2="54" y1="118.1992" y2="1004.707"/><line style="stroke:#44AAFF;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="175" x2="175" y1="118.1992" y2="1004.707"/><line style="stroke:#44AAFF;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="359" x2="359" y1="118.1992" y2="1004.707"/><line style="stroke:#44AAFF;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="528.5" x2="528.5" y1="118.1992" y2="1004.707"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="63" x="20" y="115.6694">Stock Holder</text><ellipse cx="54.5" cy="50.1992" fill="#44AAFF" filter="url(#f1jg7h6qbl8lw1)" rx="8" ry="8" style="stroke:#2277DD;stroke-width:2.0;"/><path d="M54.5,58.1992 L54.5,85.1992 M41.5,66.1992 L67.5,66.1992 M54.5,85.1992 L41.5,100.1992 M54.5,85.1992 L67.5,100.1992 " fill="none" filter="url(#f1jg7h6qbl8lw1)" style="stroke:#2277DD;stroke-width:2.0;"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="63" x="20" y="1012.1772">Stock Holder</text><ellipse cx="54.5" cy="1024.707" fill="#44AAFF" filter="url(#f1jg7h6qbl8lw1)" rx="8" ry="8" style="stroke:#2277DD;stroke-width:2.0;"/><path d="M54.5,1032.707 L54.5,1059.707 M41.5,1040.707 L67.5,1040.707 M54.5,1059.707 L41.5,1074.707 M54.5,1059.707 L67.5,1074.707 " fill="none" filter="url(#f1jg7h6qbl8lw1)" style="stroke:#2277DD;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="143" y="115.2461">Stock DB</text><path d="M157.5,65.7109 C157.5,55.7109 175.5,55.7109 175.5,55.7109 C175.5,55.7109 193.5,55.7109 193.5,65.7109 L193.5,91.7109 C193.5,101.7109 175.5,101.7109 175.5,101.7109 C175.5,101.7109 157.5,101.7109 157.5,91.7109 L157.5,65.7109 " fill="#FEFECE" filter="url(#f1jg7h6qbl8lw1)" style="stroke:#000000;stroke-width:1.5;"/><path d="M157.5,65.7109 C157.5,75.7109 175.5,75.7109 175.5,75.7109 C175.5,75.7109 193.5,75.7109 193.5,65.7109 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="143" y="1017.2422">Stock DB</text><path d="M157.5,1030.1953 C157.5,1020.1953 175.5,1020.1953 175.5,1020.1953 C175.5,1020.1953 193.5,1020.1953 193.5,1030.1953 L193.5,1056.1953 C193.5,1066.1953 175.5,1066.1953 175.5,1066.1953 C175.5,1066.1953 157.5,1066.1953 157.5,1056.1953 L157.5,1030.1953 " fill="#FEFECE" filter="url(#f1jg7h6qbl8lw1)" style="stroke:#000000;stroke-width:1.5;"/><path d="M157.5,1030.1953 C157.5,1040.1953 175.5,1040.1953 175.5,1040.1953 C175.5,1040.1953 193.5,1040.1953 193.5,1030.1953 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="333" y="115.2461">Foil DB</text><path d="M341.5,65.7109 C341.5,55.7109 359.5,55.7109 359.5,55.7109 C359.5,55.7109 377.5,55.7109 377.5,65.7109 L377.5,91.7109 C377.5,101.7109 359.5,101.7109 359.5,101.7109 C359.5,101.7109 341.5,101.7109 341.5,91.7109 L341.5,65.7109 " fill="#FEFECE" filter="url(#f1jg7h6qbl8lw1)" style="stroke:#000000;stroke-width:1.5;"/><path d="M341.5,65.7109 C341.5,75.7109 359.5,75.7109 359.5,75.7109 C359.5,75.7109 377.5,75.7109 377.5,65.7109 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="333" y="1017.2422">Foil DB</text><path d="M341.5,1030.1953 C341.5,1020.1953 359.5,1020.1953 359.5,1020.1953 C359.5,1020.1953 377.5,1020.1953 377.5,1030.1953 L377.5,1056.1953 C377.5,1066.1953 359.5,1066.1953 359.5,1066.1953 C359.5,1066.1953 341.5,1066.1953 341.5,1056.1953 L341.5,1030.1953 " fill="#FEFECE" filter="url(#f1jg7h6qbl8lw1)" style="stroke:#000000;stroke-width:1.5;"/><path d="M341.5,1030.1953 C341.5,1040.1953 359.5,1040.1953 359.5,1040.1953 C359.5,1040.1953 377.5,1040.1953 377.5,1030.1953 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="52" x="499.5" y="115.6694">Foil Holder</text><ellipse cx="528.5" cy="50.1992" fill="#44AAFF" filter="url(#f1jg7h6qbl8lw1)" rx="8" ry="8" style="stroke:#2277DD;stroke-width:2.0;"/><path d="M528.5,58.1992 L528.5,85.1992 M515.5,66.1992 L541.5,66.1992 M528.5,85.1992 L515.5,100.1992 M528.5,85.1992 L541.5,100.1992 " fill="none" filter="url(#f1jg7h6qbl8lw1)" style="stroke:#2277DD;stroke-width:2.0;"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="52" x="499.5" y="1012.1772">Foil Holder</text><ellipse cx="528.5" cy="1024.707" fill="#44AAFF" filter="url(#f1jg7h6qbl8lw1)" rx="8" ry="8" style="stroke:#2277DD;stroke-width:2.0;"/><path d="M528.5,1032.707 L528.5,1059.707 M515.5,1040.707 L541.5,1040.707 M528.5,1059.707 L515.5,1074.707 M528.5,1059.707 L541.5,1074.707 " fill="none" filter="url(#f1jg7h6qbl8lw1)" style="stroke:#2277DD;stroke-width:2.0;"/><path d="M123,135.1992 L185,135.1992 L185,142.1992 L175,152.1992 L123,152.1992 L123,135.1992 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="569.8867" style="stroke:#000000;stroke-width:2.0;" width="410.5" x="123" y="135.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="138" y="148.7676">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="179" x="200" y="147.834">[Stock originates/validates chit]</text><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="217.5" y1="169.5098" y2="169.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="217.5" x2="217.5" y1="169.5098" y2="182.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="217.5" y1="182.5098" y2="182.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="186.5" y1="182.5098" y2="178.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="186.5" y1="182.5098" y2="186.5098"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="155" x="182.5" y="164.98">Apply validating signature to chit</text><line style="stroke:#000000;stroke-width:1.0;" x1="357.5" x2="347.5" y1="229.5098" y2="225.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="357.5" x2="347.5" y1="229.5098" y2="233.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="358.5" y1="229.5098" y2="229.5098"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="113" x="182.5" y="202.98">Transmit new valid Chit</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="115" x="182.5" y="213.98">with validating signature</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="148" x="182.5" y="224.98">Proposed endHash: propHash</text><line style="stroke:#000000;stroke-width:1.0;" x1="359.5" x2="401.5" y1="254.5098" y2="254.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="401.5" x2="401.5" y1="254.5098" y2="267.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="360.5" x2="401.5" y1="267.5098" y2="267.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="360.5" x2="370.5" y1="267.5098" y2="263.5098"/><line style="stroke:#000000;stroke-width:1.0;" x1="360.5" x2="370.5" y1="267.5098" y2="271.5098"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="106" x="366.5" y="249.98">Add/link new valid chit</text><path d="M133,282.5098 L195,282.5098 L195,289.5098 L185,299.5098 L133,299.5098 L133,282.5098 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="175.3105" style="stroke:#000000;stroke-width:2.0;" width="349.5" x="133" y="282.5098"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="148" y="296.0781">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="246" x="210" y="295.1445">[Foil agrees with stock's proposed endhash]</text><line style="stroke:#000000;stroke-width:1.0;" x1="359.5" x2="401.5" y1="327.8203" y2="327.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="401.5" x2="401.5" y1="327.8203" y2="340.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="360.5" x2="401.5" y1="340.8203" y2="340.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="360.5" x2="370.5" y1="340.8203" y2="336.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="360.5" x2="370.5" y1="340.8203" y2="344.8203"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="78" x="366.5" y="312.2905">Ratchet forward</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="104" x="366.5" y="323.2905">ackHash = propHash</text><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="185.5" y1="365.8203" y2="361.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="185.5" y1="365.8203" y2="369.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="358.5" y1="365.8203" y2="365.8203"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="116" x="192.5" y="361.2905">Acknowledge propHash</text><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="217.5" y1="401.8203" y2="401.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="217.5" x2="217.5" y1="401.8203" y2="414.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="217.5" y1="414.8203" y2="414.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="186.5" y1="414.8203" y2="410.8203"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="186.5" y1="414.8203" y2="418.8203"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="78" x="182.5" y="386.2905">Ratchet forward</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="104" x="182.5" y="397.2905">ackHash = propHash</text><path d="M147,427.8203 L147,448.8203 L200,448.8203 L200,437.8203 L190,427.8203 L147,427.8203 " fill="#E8E8EA" filter="url(#f1jg7h6qbl8lw1)" style="stroke:#202024;stroke-width:1.0;"/><path d="M190,427.8203 L190,437.8203 L200,437.8203 L190,427.8203 " fill="#E8E8EA" style="stroke:#202024;stroke-width:1.0;"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="32" x="153" y="441.2905">DONE</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="123" x2="533.5" y1="465.8203" y2="465.8203"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="170" x="128" y="476.4551">[Foil originates/validates chit]</text><line style="stroke:#000000;stroke-width:1.0;" x1="359.5" x2="401.5" y1="496.7754" y2="496.7754"/><line style="stroke:#000000;stroke-width:1.0;" x1="401.5" x2="401.5" y1="496.7754" y2="509.7754"/><line style="stroke:#000000;stroke-width:1.0;" x1="360.5" x2="401.5" y1="509.7754" y2="509.7754"/><line style="stroke:#000000;stroke-width:1.0;" x1="360.5" x2="370.5" y1="509.7754" y2="505.7754"/><line style="stroke:#000000;stroke-width:1.0;" x1="360.5" x2="370.5" y1="509.7754" y2="513.7754"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="155" x="366.5" y="492.2456">Apply validating signature to chit</text><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="185.5" y1="556.7754" y2="552.7754"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="185.5" y1="556.7754" y2="560.7754"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="358.5" y1="556.7754" y2="556.7754"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="113" x="192.5" y="530.2456">Transmit new valid Chit</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="115" x="192.5" y="541.2456">with validating signature</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="89" x="192.5" y="552.2456">And new endHash</text><path d="M133,571.7754 L195,571.7754 L195,578.7754 L185,588.7754 L133,588.7754 L133,571.7754 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="101.3105" style="stroke:#000000;stroke-width:2.0;" width="266" x="133" y="571.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="148" y="585.3438">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="184" x="210" y="584.4102">[Stock agrees with new endHash]</text><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="217.5" y1="617.0859" y2="617.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="217.5" x2="217.5" y1="617.0859" y2="630.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="217.5" y1="630.0859" y2="630.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="186.5" y1="630.0859" y2="626.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="186.5" y1="630.0859" y2="634.0859"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="78" x="182.5" y="601.5562">Ratchet forward</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="100" x="182.5" y="612.5562">ackHash = endHash</text><path d="M147,643.0859 L147,664.0859 L200,664.0859 L200,653.0859 L190,643.0859 L147,643.0859 " fill="#E8E8EA" filter="url(#f1jg7h6qbl8lw1)" style="stroke:#202024;stroke-width:1.0;"/><path d="M190,643.0859 L190,653.0859 L200,653.0859 L190,643.0859 " fill="#E8E8EA" style="stroke:#202024;stroke-width:1.0;"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="32" x="153" y="656.5562">DONE</text><line style="stroke:#000000;stroke-width:1.0;" x1="357.5" x2="347.5" y1="697.0859" y2="693.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="357.5" x2="347.5" y1="697.0859" y2="701.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="358.5" y1="697.0859" y2="697.0859"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="160" x="182.5" y="692.5562">Compare my list of unlinked chits</text><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="185.5" y1="740.0859" y2="736.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="185.5" y1="740.0859" y2="744.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="358.5" y1="740.0859" y2="740.0859"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="147" x="192.5" y="724.5562">Send chits since last ackHash</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="88" x="192.5" y="735.5562">and new endHash</text><path d="M10,755.0859 L72,755.0859 L72,762.0859 L62,772.0859 L10,772.0859 L10,755.0859 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="154.3105" style="stroke:#000000;stroke-width:2.0;" width="557.5" x="10" y="755.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="768.6543">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="195" x="87" y="767.7207">[All newly received chits are valid]</text><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="217.5" y1="811.3965" y2="811.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="217.5" x2="217.5" y1="811.3965" y2="824.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="217.5" y1="824.3965" y2="824.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="186.5" y1="824.3965" y2="820.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="176.5" x2="186.5" y1="824.3965" y2="828.3965"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="53" x="182.5" y="784.8667">Apply chits</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="78" x="182.5" y="795.8667">Ratchet forward</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="100" x="182.5" y="806.8667">ackHash = endHash</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="567.5" y1="833.3965" y2="833.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="54.5" x2="64.5" y1="851.3965" y2="847.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="54.5" x2="64.5" y1="851.3965" y2="855.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="54.5" x2="174.5" y1="851.3965" y2="851.3965"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="97" x="71.5" y="846.8667">Report error to user</text><line style="stroke:#000000;stroke-width:1.0;" x1="357.5" x2="347.5" y1="876.3965" y2="872.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="357.5" x2="347.5" y1="876.3965" y2="880.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="358.5" y1="876.3965" y2="876.3965"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="60" x="182.5" y="871.8667">Report error</text><line style="stroke:#000000;stroke-width:1.0;" x1="526.5" x2="516.5" y1="901.3965" y2="897.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="526.5" x2="516.5" y1="901.3965" y2="905.3965"/><line style="stroke:#000000;stroke-width:1.0;" x1="359.5" x2="527.5" y1="901.3965" y2="901.3965"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="97" x="366.5" y="896.8667">Report error to user</text><path d="M133,923.3965 L195,923.3965 L195,930.3965 L185,940.3965 L133,940.3965 L133,923.3965 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="64.3105" style="stroke:#000000;stroke-width:2.0;" width="340" x="133" y="923.3965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="148" y="936.9648">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="258" x="210" y="936.0313">[Does foil still have any valid, unlinked chits]</text><line style="stroke:#000000;stroke-width:1.0;" x1="357.5" x2="347.5" y1="979.707" y2="975.707"/><line style="stroke:#000000;stroke-width:1.0;" x1="357.5" x2="347.5" y1="979.707" y2="983.707"/><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="358.5" y1="979.707" y2="979.707"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="107" x="182.5" y="953.1772">Requeue/retry regular</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="110" x="182.5" y="964.1772">chit transmission to foil</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="121" x="182.5" y="975.1772">(return to top of diagram)</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="148" x="214.75" y="1095.375">Thu Jun 30 10:54:40 MDT 2022</text><!--MD5=[c046a0123775f01e7cb3f19f4e77851a]
@startuml
!include common.puml
$title(Chit Chain Consensus Protocol)
actor "Stock Holder" as vendor
database "Stock DB" as stock
database "Foil DB" as foil
actor "Foil Holder" as client

alt Stock originates/validates chit
  stock		->>	stock:		Apply validating signature to chit
  stock		->>	foil:		Transmit new valid Chit\nwith validating signature\nProposed endHash: propHash
  foil		->>	foil:		Add/link new valid chit

  alt Foil agrees with stock's proposed endhash
    foil		->>	foil:		Ratchet forward\nackHash = propHash
    foil		->>	stock:		Acknowledge propHash
    stock		->>	stock:		Ratchet forward\nackHash = propHash
    note over stock: DONE
  end

else Foil originates/validates chit
  foil		->>	foil:		Apply validating signature to chit
  foil		->>	stock:		Transmit new valid Chit\nwith validating signature\nAnd new endHash

  alt Stock agrees with new endHash
    stock		->>	stock:		Ratchet forward\nackHash = endHash
    note over stock: DONE
  end
  
  stock		->>	foil:		Compare my list of unlinked chits
end

foil		->>	stock:		Send chits since last ackHash\nand new endHash
    
alt All newly received chits are valid
  stock		->>	stock:		Apply chits\nRatchet forward\nackHash = endHash
else
  stock		->>	vendor:		Report error to user
  stock		->>	foil:		Report error
  foil		->>	client:		Report error to user
end

alt Does foil still have any valid, unlinked chits
  stock		->>	foil:		Requeue/retry regular\nchit transmission to foil\n(return to top of diagram)
end

@enduml

@startuml



skinparam backgroundColor fff
skinparam stereotypeCBackgroundColor 27d






skinparam circledCharacter {
  radius 8
  fontSize 11
  fontName Helvetica
}

skinparam class {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  attributeFontColor 333
  attributeFontSize 11
  attributeIconSize 11
}

skinparam actor {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam participant {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam collections {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam SequenceBox{
    backgroundColor e0e0e0
  borderColor cccccc
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam interface {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam component {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}



skinparam queue {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}


skinparam usecase {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam activity {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam sequence {
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  lifeLineBorderColor 4af
  lifeLineBackgroundColor e0e0e0
}




skinparam state {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
  startColor 4af
  endColor 27d
}

skinparam note {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}







  title Chit Chain Consensus Protocol
  footer Thu Jun 30 10:54:40 MDT 2022
actor "Stock Holder" as vendor
database "Stock DB" as stock
database "Foil DB" as foil
actor "Foil Holder" as client

alt Stock originates/validates chit
  stock		->>	stock:		Apply validating signature to chit
  stock		->>	foil:		Transmit new valid Chit\nwith validating signature\nProposed endHash: propHash
  foil		->>	foil:		Add/link new valid chit

  alt Foil agrees with stock's proposed endhash
    foil		->>	foil:		Ratchet forward\nackHash = propHash
    foil		->>	stock:		Acknowledge propHash
    stock		->>	stock:		Ratchet forward\nackHash = propHash
    note over stock: DONE
  end

else Foil originates/validates chit
  foil		->>	foil:		Apply validating signature to chit
  foil		->>	stock:		Transmit new valid Chit\nwith validating signature\nAnd new endHash

  alt Stock agrees with new endHash
    stock		->>	stock:		Ratchet forward\nackHash = endHash
    note over stock: DONE
  end
  
  stock		->>	foil:		Compare my list of unlinked chits
end

foil		->>	stock:		Send chits since last ackHash\nand new endHash
    
alt All newly received chits are valid
  stock		->>	stock:		Apply chits\nRatchet forward\nackHash = endHash
else
  stock		->>	vendor:		Report error to user
  stock		->>	foil:		Report error
  foil		->>	client:		Report error to user
end

alt Does foil still have any valid, unlinked chits
  stock		->>	foil:		Requeue/retry regular\nchit transmission to foil\n(return to top of diagram)
end

@enduml

PlantUML version 1.2022.1(Tue Feb 01 11:19:58 MST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>