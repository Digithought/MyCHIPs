<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="581px" preserveAspectRatio="none" style="width:901px;height:581px;background:#FFFFFF;" version="1.1" viewBox="0 0 901 581" width="901px" zoomAndPan="magnify"><defs><filter height="300%" id="f94ro5onyoxt6" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="196" x="346" y="17.4023">NPF Connection States</text><!--MD5=[9718f0a68e86fb10f428024a7c36f10e]
cluster killable--><rect fill="#E8E8EA" filter="url(#f94ro5onyoxt6)" height="416" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="624" x="7" y="136.1992"/><rect fill="#FFFFFF" height="389" rx="12.5" ry="12.5" style="stroke:#FFFFFF;stroke-width:1.0;" width="618" x="10" y="160.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="7" x2="631" y1="157.1992" y2="157.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="32" x="303" y="148.6694">killable</text><g id="killable.ticket"><rect fill="#E8E8EA" filter="url(#f94ro5onyoxt6)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="153" x="231.5" y="333.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="231.5" x2="384.5" y1="354.1992" y2="354.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="295" y="346.6694">ticket</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="133" x="236.5" y="370.8008">Server awaits DB query</text></g><g id="killable.id"><rect fill="#E8E8EA" filter="url(#f94ro5onyoxt6)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="157" x="197.5" y="188.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="197.5" x2="354.5" y1="209.1992" y2="209.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="8" x="272" y="201.6694">id</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="137" x="202.5" y="225.8008">Server has peer identity</text></g><g id="killable.request"><rect fill="#E8E8EA" filter="url(#f94ro5onyoxt6)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="157" x="39.5" y="333.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="39.5" x2="196.5" y1="354.1992" y2="354.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="37" x="99.5" y="346.6694">request</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="137" x="44.5" y="370.8008">Server awaits key query</text></g><g id="killable.pending"><rect fill="#E8E8EA" filter="url(#f94ro5onyoxt6)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="187" x="419.5" y="333.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="419.5" x2="606.5" y1="354.1992" y2="354.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="38" x="494" y="346.6694">pending</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="167" x="424.5" y="370.8008">Client awaits ack from server</text></g><g id="killable.open"><rect fill="#E8E8EA" filter="url(#f94ro5onyoxt6)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="144" x="262" y="478.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="262" x2="406" y1="499.1992" y2="499.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="322" y="491.6694">open</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="124" x="267" y="515.8008">Open for transactions</text></g><ellipse cx="722" cy="37.1992" fill="#44AAFF" filter="url(#f94ro5onyoxt6)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><g id="none"><rect fill="#E8E8EA" filter="url(#f94ro5onyoxt6)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="133" x="655.5" y="188.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="655.5" x2="788.5" y1="209.1992" y2="209.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="710" y="201.6694">none</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="113" x="660.5" y="225.8008">No Peer Connection</text></g><!--MD5=[0ed2e745026fd0d436b1b77e9cdb1882]
link *start to none--><path d="M722,47.5492 C722,72.6892 722,142.4692 722,182.6592 " fill="none" id="*start-to-none" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="722,187.8892,726,178.8892,722,182.8892,718,178.8892,722,187.8892" style="stroke:#000000;stroke-width:1.0;"/><!--MD5=[67f8662f6ee20d70269597966f5238c7]
link none to ticket--><path d="M655.27,230.8592 C644.5,233.4092 633.46,235.9392 623,238.1992 C553.13,253.2892 528.42,235.2292 465,268.1992 C445.2,278.4892 447.47,290.6792 429,303.1992 C413.33,313.8192 395.24,323.1792 377.9,331.0092 " fill="none" id="none-to-ticket" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="373.03,333.1792,382.8789,333.1849,377.6002,331.1512,379.634,325.8726,373.03,333.1792" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="510" y="277.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="114" x="466" y="288.6694">Receive client request I</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="70" x="488" y="299.6694">[Query Ticket]</text><!--MD5=[25fd9406ec9bf6ca8053a811d7ab66f3]
link ticket to none--><path d="M384.56,337.0592 C390.45,335.6892 396.31,334.3892 402,333.1992 C482.67,316.3192 512.53,342.4492 585,303.1992 C603.53,293.1592 600.25,280.9992 617,268.1992 C630.51,257.8792 646.28,248.5792 661.43,240.7192 " fill="none" id="ticket-to-none" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="666.11,238.3292,656.2764,238.8768,661.6609,240.6108,659.9269,245.9953,666.11,238.3292" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="18" x="645.5" y="283.1694">DB:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="73" x="618" y="294.1694">Ticket not valid</text><!--MD5=[14fddb17e4e79e3183ff958f377193c8]
link ticket to open--><path d="M312.41,383.4592 C316.89,408.1092 323.84,446.3292 328.64,472.7092 " fill="none" id="ticket-to-open" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="329.57,477.8192,331.8882,468.2471,328.6718,472.9006,324.0183,469.6842,329.57,477.8192" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="18" x="365.5" y="422.6694">DB:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="55" x="347" y="433.6694">Ticket valid</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="99" x="325" y="444.6694">[Send Acknowledge]</text><!--MD5=[a9e71d2b32bf692bd28fc2d48b1ec5d5]
reverse link none to killable--><path d="M700.39,183.8692 C682.4,161.9892 654.67,133.6592 623,120.1992 C524.3,78.2392 489.21,110.8692 382,108.1992 C302.2,106.2092 80.59,64.9192 23,120.1992 C19.4338,123.6217 16.6038,127.5488 14.3852,131.8115 C13.8305,132.8772 13.3141,133.9639 12.8339,135.0689 C12.7139,135.3452 12.5961,135.6226 12.4806,135.9011 " fill="none" id="none-backto-killable" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="703.64,187.8692,701.0902,178.3561,700.4957,183.9817,694.8701,183.3871,703.64,187.8692" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="31" x="320.5" y="86.6694">Timer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="80" x="296" y="97.6694">Timeout elapsed</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="291" y="108.6694">[Close connection]</text><!--MD5=[e3482483f9cf288302d47f55096db336]
link none to id--><path d="M655.35,213.1992 C576.56,213.1992 445.36,213.1992 359.77,213.1992 " fill="none" id="none-to-id" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="354.71,213.1992,363.71,217.1992,359.71,213.1992,363.71,209.1992,354.71,213.1992" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="492" y="195.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="116" x="447" y="206.6694">Receive client identity N</text><!--MD5=[e007722e2a34482c690b75cb243038ee]
link id to request--><path d="M197.5,237.3292 C149.78,251.4692 97.83,267.0792 97,268.1992 C84.08,285.5892 90.9,309.7192 100.08,328.4692 " fill="none" id="id-to-request" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="102.46,333.1192,101.9374,323.2842,100.1897,328.6643,94.8096,326.9167,102.46,333.1192" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="144" y="277.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="118" x="98" y="288.6694">Receive client request K</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="94" x="110" y="299.6694">[Query for site key]</text><!--MD5=[c0292e642c508e35c8b65c003e88b372]
link request to open--><path d="M115.45,383.3892 C114.76,403.2392 117.19,430.8092 133,448.1992 C149.86,466.7492 207.48,481.0492 256.72,490.2592 " fill="none" id="request-to-open" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="261.77,491.1992,253.6535,485.6205,256.8543,490.2847,252.1902,493.4856,261.77,491.1992" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="34" x="204" y="422.6694">Query:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="174" x="134" y="433.6694">Noise decrypts OK and tally current</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="99" x="171.5" y="444.6694">[Send Acknowledge]</text><!--MD5=[709914f4a9b2fa327c9c3fb323efca27]
link request to none--><path d="M172.54,333.0692 C188.85,324.6992 206.29,314.5392 221,303.1992 C237.7,290.3392 234.07,277.4692 253,268.1992 C327.08,231.9092 541.55,251.2892 623,238.1992 C631.91,236.7692 641.21,234.9492 650.38,232.9592 " fill="none" id="request-to-none" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="655.46,231.8392,645.8121,229.8599,650.5761,232.9103,647.5257,237.6742,655.46,231.8392" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="18" x="328" y="283.1694">DB:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="166" x="254" y="294.1694">Noise fails or tally not valid/current</text><!--MD5=[51ade5b87b3a352e88c32cd994f85c58]
link none to pending--><path d="M722.32,238.4892 C721.26,258.3992 716.55,285.9892 700,303.1992 C676.87,327.2392 643.78,340.7692 611.84,348.3192 " fill="none" id="none-to-pending" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="606.72,349.4792,616.38,351.3986,611.5972,348.3779,614.6179,343.5951,606.72,349.4792" style="stroke:#000000;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="792.5" y="283.1694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="175" x="718" y="294.1694">I have sent a request for connection</text><!--MD5=[b6c0acea4cadd97425e8e4c5ee30e824]
link pending to open--><path d="M494.87,383.5592 C479.78,402.7192 456.96,429.2592 433,448.1992 C420.06,458.4292 404.9,467.7792 390.4,475.7192 " fill="none" id="pending-to-open" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="385.93,478.1392,395.7484,477.3657,390.3255,475.756,391.9352,470.333,385.93,478.1392" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="510" y="428.1694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="108" x="469" y="439.1694">Received confirmation</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="149" x="369.5" y="572.8672">Sun Oct 24 14:34:14 MDT 2021</text><!--MD5=[710cee14a273d77f40c40e24ea010082]
@startuml
!include common.puml

$title(NPF Connection States)
[*] - -> none

none:  No Peer Connection
state killable {
  ticket: Server awaits DB query
  id: Server has peer identity
  request: Server awaits key query
  pending: Client awaits ack from server
  open:  Open for transactions
}

'State transition rules:
none -[$peer]-> ticket: $trans($peer,Receive client request I, Query Ticket)
ticket -[$db]-> none: $trans(DB,Ticket not valid)
ticket -[$db]-> open: $trans(DB,Ticket valid, Send Acknowledge)

killable -up-> none: $trans(Timer,Timeout elapsed, Close connection)

none -[$peer]-> id: $trans($peer,Receive client identity N)
id -[$peer]-> request: $trans($peer,Receive client request K, Query for site key)
request -[$db]-> open: $trans(Query, Noise decrypts OK and tally current, Send Acknowledge)
request -[$db]-> none: $trans(DB, Noise fails or tally not valid/current)

none - -> pending: $trans($peer, I have sent a request for connection)
pending -[$peer]-> open: $trans($peer, Received confirmation)

@enduml

@startuml



skinparam backgroundColor fff
skinparam stereotypeCBackgroundColor 27d






skinparam circledCharacter {
  radius 8
  fontSize 11
  fontName Helvetica
}

skinparam class {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  attributeFontColor 333
  attributeFontSize 11
  attributeIconSize 11
}

skinparam actor {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam participant {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam collections {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam SequenceBox{
    backgroundColor e0e0e0
  borderColor cccccc
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam interface {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam component {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}



skinparam queue {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}


skinparam usecase {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam activity {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam sequence {
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  lifeLineBorderColor 4af
  lifeLineBackgroundColor e0e0e0
}




skinparam state {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
  startColor 4af
  endColor 27d
}

skinparam note {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}








  title NPF Connection States
  footer Sun Oct 24 14:34:14 MDT 2021
[*] - -> none

none:  No Peer Connection
state killable {
  ticket: Server awaits DB query
  id: Server has peer identity
  request: Server awaits key query
  pending: Client awaits ack from server
  open:  Open for transactions
}

none -[#blue]-> ticket: <font color=blue>Peer:\nReceive client request I\n[Query Ticket]
ticket -[#red]-> none: <font color=black>DB:\nTicket not valid
ticket -[#red]-> open: <font color=black>DB:\nTicket valid\n[Send Acknowledge]

killable -up-> none: <font color=black>Timer:\nTimeout elapsed\n[Close connection]

none -[#blue]-> id: <font color=blue>Peer:\nReceive client identity N
id -[#blue]-> request: <font color=blue>Peer:\nReceive client request K\n[Query for site key]
request -[#red]-> open: <font color=black>Query:\nNoise decrypts OK and tally current\n[Send Acknowledge]
request -[#red]-> none: <font color=black>DB:\nNoise fails or tally not valid/current

none - -> pending: <font color=blue>Peer:\nI have sent a request for connection
pending -[#blue]-> open: <font color=blue>Peer:\nReceived confirmation

@enduml

PlantUML version 1.2021.10(Mon Aug 30 07:43:48 MDT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>