<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="581px" preserveAspectRatio="none" style="width:856px;height:581px;background:#FFFFFF;" version="1.1" viewBox="0 0 856 581" width="856px" zoomAndPan="magnify"><defs><filter height="300%" id="f1sxp6wixa579s" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="196" x="323.5" y="17.4023">NPF Connection States</text><!--MD5=[9718f0a68e86fb10f428024a7c36f10e]
cluster killable--><rect fill="#E8E8EA" filter="url(#f1sxp6wixa579s)" height="416" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="640" x="7" y="136.1992"/><rect fill="#FFFFFF" height="389" rx="12.5" ry="12.5" style="stroke:#FFFFFF;stroke-width:1.0;" width="634" x="10" y="160.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="7" x2="647" y1="157.1992" y2="157.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="32" x="311" y="148.6694">killable</text><g id="killable.ticket"><rect fill="#E8E8EA" filter="url(#f1sxp6wixa579s)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="168" x="232" y="333.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="232" x2="400" y1="354.1992" y2="354.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="303" y="346.6694">ticket</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="148" x="237" y="370.8008">Server awaits ticket query</text></g><g id="killable.id"><rect fill="#E8E8EA" filter="url(#f1sxp6wixa579s)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="215" x="176.5" y="188.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="176.5" x2="391.5" y1="209.1992" y2="209.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="8" x="280" y="201.6694">id</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="195" x="181.5" y="225.8008">Server has peer's claimed identity</text></g><g id="killable.request"><rect fill="#E8E8EA" filter="url(#f1sxp6wixa579s)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="157" x="39.5" y="333.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="39.5" x2="196.5" y1="354.1992" y2="354.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="37" x="99.5" y="346.6694">request</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="137" x="44.5" y="370.8008">Server awaits key query</text></g><g id="killable.pending"><rect fill="#E8E8EA" filter="url(#f1sxp6wixa579s)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="187" x="435.5" y="333.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="435.5" x2="622.5" y1="354.1992" y2="354.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="38" x="510" y="346.6694">pending</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="167" x="440.5" y="370.8008">Client awaits ack from server</text></g><g id="killable.open"><rect fill="#E8E8EA" filter="url(#f1sxp6wixa579s)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="144" x="262" y="478.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="262" x2="406" y1="499.1992" y2="499.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="322" y="491.6694">open</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="124" x="267" y="515.8008">Open for transactions</text></g><ellipse cx="738" cy="37.1992" fill="#44AAFF" filter="url(#f1sxp6wixa579s)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><g id="none"><rect fill="#E8E8EA" filter="url(#f1sxp6wixa579s)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="133" x="671.5" y="188.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="671.5" x2="804.5" y1="209.1992" y2="209.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="726" y="201.6694">none</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="113" x="676.5" y="225.8008">No Peer Connection</text></g><!--MD5=[0ed2e745026fd0d436b1b77e9cdb1882]
link *start to none--><path d="M738,47.5492 C738,72.6892 738,142.4692 738,182.6592 " fill="none" id="*start-to-none" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="738,187.8892,742,178.8892,738,182.8892,734,178.8892,738,187.8892" style="stroke:#000000;stroke-width:1.0;"/><!--MD5=[67f8662f6ee20d70269597966f5238c7]
link none to ticket--><path d="M671.29,230.9392 C660.52,233.4792 649.47,235.9892 639,238.1992 C565.65,253.7092 539.67,233.9092 473,268.1992 C453.16,278.4092 455.47,290.6792 437,303.1992 C421.33,313.8192 403.24,323.1792 385.9,331.0092 " fill="none" id="none-to-ticket" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="381.03,333.1792,390.8789,333.1849,385.6002,331.1512,387.634,325.8726,381.03,333.1792" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="518" y="277.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="114" x="474" y="288.6694">Receive client request I</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="70" x="496" y="299.6694">[Query Ticket]</text><!--MD5=[25fd9406ec9bf6ca8053a811d7ab66f3]
link ticket to none--><path d="M400.24,336.9492 C406.24,335.6392 412.21,334.3792 418,333.1992 C495.33,317.4892 523.75,341.0292 593,303.1992 C611.5,293.0992 608.07,280.7492 625,268.1992 C639.29,257.6092 655.99,248.2692 672.09,240.4692 " fill="none" id="ticket-to-none" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="676.62,238.3092,666.7749,238.5805,672.1086,240.465,670.2241,245.7987,676.62,238.3092" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="18" x="653.5" y="283.1694">DB:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="73" x="626" y="294.1694">Ticket not valid</text><!--MD5=[14fddb17e4e79e3183ff958f377193c8]
link ticket to open--><path d="M319.05,383.4592 C322.16,408.1092 326.97,446.3292 330.29,472.7092 " fill="none" id="ticket-to-open" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="330.93,477.8192,333.7661,468.3875,330.301,472.8589,325.8296,469.3939,330.93,477.8192" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="18" x="373" y="422.6694">DB:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="55" x="354.5" y="433.6694">Ticket valid</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="108" x="328" y="444.6694">[Send acknowledge A]</text><!--MD5=[a9e71d2b32bf692bd28fc2d48b1ec5d5]
reverse link none to killable--><path d="M716.4,183.8492 C698.41,161.9692 670.68,133.6392 639,120.1992 C537,76.9392 500.76,110.8692 390,108.1992 C308.42,106.2392 81.9,63.7292 23,120.1992 C19.4325,123.6192 16.6016,127.5444 14.3823,131.8058 C13.8275,132.8711 13.3109,133.9575 12.8306,135.0622 C12.7105,135.3384 12.5927,135.6158 12.4771,135.8942 " fill="none" id="none-backto-killable" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="719.64,187.8592,717.0691,178.3518,716.487,183.9786,710.8602,183.3966,719.64,187.8592" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="31" x="328.5" y="86.6694">Timer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="80" x="304" y="97.6694">Timeout elapsed</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="299" y="108.6694">[Close connection]</text><!--MD5=[e3482483f9cf288302d47f55096db336]
link none to id--><path d="M671.27,213.1992 C599.17,213.1992 483.03,213.1992 396.71,213.1992 " fill="none" id="none-to-id" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="391.59,213.1992,400.59,217.1992,396.59,213.1992,400.59,209.1992,391.59,213.1992" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="518.5" y="195.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="116" x="473.5" y="206.6694">Receive client identity N</text><!--MD5=[e007722e2a34482c690b75cb243038ee]
link id to request--><path d="M186.99,238.2092 C147.89,248.8492 110.61,260.6392 105,268.1992 C92.3,285.2992 96.83,309.4592 103.83,328.2892 " fill="none" id="id-to-request" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="105.65,332.9492,106.1102,323.1111,103.835,328.2903,98.6559,326.0151,105.65,332.9492" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="152" y="277.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="118" x="106" y="288.6694">Receive client request K</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="94" x="118" y="299.6694">[Query for site key]</text><!--MD5=[c0292e642c508e35c8b65c003e88b372]
link request to open--><path d="M117.02,383.4992 C117.56,403.4092 121.61,431.0092 138,448.1992 C168.42,480.1092 215.8,493.7292 256.37,499.3192 " fill="none" id="request-to-open" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="261.79,500.0292,253.3792,494.905,256.8315,499.3862,252.3503,502.8385,261.79,500.0292" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="34" x="209" y="422.6694">Query:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="174" x="139" y="433.6694">Noise decrypts OK and tally current</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="108" x="172" y="444.6694">[Send acknowledge A]</text><!--MD5=[709914f4a9b2fa327c9c3fb323efca27]
link request to none--><path d="M178,333.0892 C195.24,324.8392 213.55,314.7392 229,303.1992 C245.89,290.5892 242.06,277.4592 261,268.1992 C336.7,231.1892 555.79,251.4992 639,238.1992 C647.91,236.7692 657.21,234.9592 666.38,232.9792 " fill="none" id="request-to-none" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="671.46,231.8592,661.8109,229.8859,666.5767,232.9333,663.5293,237.6991,671.46,231.8592" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="18" x="336" y="283.1694">DB:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="166" x="262" y="294.1694">Noise fails or tally not valid/current</text><!--MD5=[51ade5b87b3a352e88c32cd994f85c58]
link none to pending--><path d="M735.87,238.5892 C732.85,258.5492 725.57,286.1892 708,303.1992 C686.29,324.2292 656.69,337.0992 627.81,344.9692 " fill="none" id="none-to-pending" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="622.81,346.2892,632.5307,347.8727,627.6461,345.0196,630.4993,340.1349,622.81,346.2892" style="stroke:#000000;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="775.5" y="277.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="119" x="729" y="288.6694">I have sent a request for</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="59" x="759" y="299.6694">connection I</text><!--MD5=[b6c0acea4cadd97425e8e4c5ee30e824]
link pending to open--><path d="M510.3,383.4192 C494.46,402.7492 470.34,429.5792 445,448.1992 C430.83,458.6092 414.35,467.8892 398.49,475.6892 " fill="none" id="pending-to-open" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="393.59,478.0692,403.4332,477.7351,398.0875,475.8847,399.938,470.5391,393.59,478.0692" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="531.5" y="428.1694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="123" x="483" y="439.1694">Received acknowledge A</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="148" x="347.5" y="572.8672">Tue Feb 01 22:05:15 MST 2022</text><!--MD5=[88ff8ba851a2d83b425731653a132375]
@startuml
!include common.puml

$title(NPF Connection States)
[*] - -> none

none:  No Peer Connection
state killable {
  ticket: Server awaits ticket query
  id: Server has peer's claimed identity
  request: Server awaits key query
  pending: Client awaits ack from server
  open:  Open for transactions
}

'State transition rules:
none -[$peer]-> ticket: $trans($peer,Receive client request I, Query Ticket)
ticket -[$db]-> none: $trans(DB,Ticket not valid)
ticket -[$db]-> open: $trans(DB,Ticket valid, Send acknowledge A)

killable -up-> none: $trans(Timer,Timeout elapsed, Close connection)

none -[$peer]-> id: $trans($peer,Receive client identity N)
id -[$peer]-> request: $trans($peer,Receive client request K, Query for site key)
request -[$db]-> open: $trans(Query, Noise decrypts OK and tally current, Send acknowledge A)
request -[$db]-> none: $trans(DB, Noise fails or tally not valid/current)

none - -> pending: $trans($peer, I have sent a request for\nconnection I)
pending -[$peer]-> open: $trans($peer, Received acknowledge A)

@enduml

@startuml



skinparam backgroundColor fff
skinparam stereotypeCBackgroundColor 27d






skinparam circledCharacter {
  radius 8
  fontSize 11
  fontName Helvetica
}

skinparam class {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  attributeFontColor 333
  attributeFontSize 11
  attributeIconSize 11
}

skinparam actor {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam participant {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam collections {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam SequenceBox{
    backgroundColor e0e0e0
  borderColor cccccc
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam interface {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam component {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}



skinparam queue {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}


skinparam usecase {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam activity {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam sequence {
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  lifeLineBorderColor 4af
  lifeLineBackgroundColor e0e0e0
}




skinparam state {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
  startColor 4af
  endColor 27d
}

skinparam note {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}








  title NPF Connection States
  footer Tue Feb 01 22:05:15 MST 2022
[*] - -> none

none:  No Peer Connection
state killable {
  ticket: Server awaits ticket query
  id: Server has peer's claimed identity
  request: Server awaits key query
  pending: Client awaits ack from server
  open:  Open for transactions
}

none -[#blue]-> ticket: <font color=blue>Peer:\nReceive client request I\n[Query Ticket]
ticket -[#red]-> none: <font color=black>DB:\nTicket not valid
ticket -[#red]-> open: <font color=black>DB:\nTicket valid\n[Send acknowledge A]

killable -up-> none: <font color=black>Timer:\nTimeout elapsed\n[Close connection]

none -[#blue]-> id: <font color=blue>Peer:\nReceive client identity N
id -[#blue]-> request: <font color=blue>Peer:\nReceive client request K\n[Query for site key]
request -[#red]-> open: <font color=black>Query:\nNoise decrypts OK and tally current\n[Send acknowledge A]
request -[#red]-> none: <font color=black>DB:\nNoise fails or tally not valid/current

none - -> pending: <font color=blue>Peer:\nI have sent a request for\nconnection I
pending -[#blue]-> open: <font color=blue>Peer:\nReceived acknowledge A

@enduml

PlantUML version 1.2021.12(Tue Oct 05 10:01:58 MDT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>