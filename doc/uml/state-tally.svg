<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="908px" preserveAspectRatio="none" style="width:1025px;height:908px;background:#FFFFFF;" version="1.1" viewBox="0 0 1025 908" width="1025px" zoomAndPan="magnify"><defs><filter height="300%" id="f1y1igtn7e73hd" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="169" x="421.5" y="17.4023">Tally State Diagram</text><!--MD5=[932510f84763d6405ab56e4a2265926e]
cluster working--><rect fill="#E8E8EA" filter="url(#f1y1igtn7e73hd)" height="129" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="525" x="454" y="147.1992"/><rect fill="#FFFFFF" height="102" rx="12.5" ry="12.5" style="stroke:#FFFFFF;stroke-width:1.0;" width="519" x="457" y="171.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="454" x2="979" y1="168.1992" y2="168.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="38" x="697.5" y="159.6694">working</text><g id="working.draft"><rect fill="#E8E8EA" filter="url(#f1y1igtn7e73hd)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="168" x="659" y="189.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="659" x2="827" y1="210.1992" y2="210.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="22" x="732" y="202.6694">draft</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="129" x="664" y="226.8008">Status: draft, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="148" x="664" y="240.9336">User: modify, sign, delete</text></g><g id="working.void"><rect fill="#E8E8EA" filter="url(#f1y1igtn7e73hd)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="145" x="478.5" y="193.6992"/><line style="stroke:#202024;stroke-width:1.5;" x1="478.5" x2="623.5" y1="214.6992" y2="214.6992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="20" x="541" y="207.1694">void</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="125" x="483.5" y="231.3008">Status: void, Req: null</text></g><g id="userVoid"><rect fill="#E8E8EA" filter="url(#f1y1igtn7e73hd)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="161" x="385.5" y="376.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="385.5" x2="546.5" y1="397.1992" y2="397.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="43" x="444.5" y="389.6694">userVoid</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="141" x="390.5" y="413.8008">Status: offer, Req-&gt;void</text></g><g id="userAccept"><rect fill="#E8E8EA" filter="url(#f1y1igtn7e73hd)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="166" x="7" y="376.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="7" x2="173" y1="397.1992" y2="397.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="62" y="389.6694">userAccept</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="146" x="12" y="413.8008">Status: offer, Req-&gt;open</text></g><g id="userDraft"><rect fill="#E8E8EA" filter="url(#f1y1igtn7e73hd)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="165" x="581.5" y="376.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="581.5" x2="746.5" y1="397.1992" y2="397.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="46" x="641" y="389.6694">userDraft</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="145" x="586.5" y="413.8008">Status: draft, Req-&gt;offer</text></g><g id="userClose"><rect fill="#E8E8EA" filter="url(#f1y1igtn7e73hd)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="168" x="381" y="668.6992"/><line style="stroke:#202024;stroke-width:1.5;" x1="381" x2="549" y1="689.6992" y2="689.6992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="50" x="440" y="682.1694">userClose</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="148" x="386" y="706.3008">Status: open, Req-&gt;close</text></g><g id="open"><rect fill="#E8E8EA" filter="url(#f1y1igtn7e73hd)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="150" x="100" y="664.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="100" x2="250" y1="685.1992" y2="685.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="163" y="677.6694">open</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="130" x="105" y="701.8008">Status: open, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="122" x="105" y="715.9336">Have both signatures</text></g><g id="close"><rect fill="#E8E8EA" filter="url(#f1y1igtn7e73hd)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="150" x="245" y="822.6992"/><line style="stroke:#202024;stroke-width:1.5;" x1="245" x2="395" y1="843.6992" y2="843.6992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="307" y="836.1694">close</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="130" x="250" y="860.3008">Status: close, Req: null</text></g><g id="peerProffer"><rect fill="#E8E8EA" filter="url(#f1y1igtn7e73hd)" height="73.3984" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="187" x="149.5" y="182.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="149.5" x2="336.5" y1="203.1992" y2="203.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="55" x="215.5" y="195.6694">peerProffer</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="128" x="154.5" y="219.8008">Status: offer, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="110" x="154.5" y="233.9336">Peer signature only</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="167" x="154.5" y="248.0664">User: accept, refuse, counter</text></g><g id="userProffer"><rect fill="#E8E8EA" filter="url(#f1y1igtn7e73hd)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="148" x="418" y="521.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="418" x2="566" y1="542.1992" y2="542.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="55" x="464.5" y="534.6694">userProffer</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="128" x="423" y="558.8008">Status: offer, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="110" x="423" y="572.9336">User signature only</text></g><g id="closed"><rect fill="#E8E8EA" filter="url(#f1y1igtn7e73hd)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="158" x="522" y="818.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="522" x2="680" y1="839.1992" y2="839.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="32" x="585" y="831.6694">closed</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="138" x="527" y="855.8008">Status: closed, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="87" x="527" y="869.9336">Balance is zero</text></g><ellipse cx="493" cy="37.1992" fill="#44AAFF" filter="url(#f1y1igtn7e73hd)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><!--MD5=[98967d72ce6cf1fee1a27daeddde0c85]
link *start to draft--><path d="M501.29,42.8492 C524.2,55.8192 590.08,93.8992 641,131.1992 C664,148.0492 688.41,168.6392 707.58,185.4992 " fill="none" id="*start-to-draft" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="711.34,188.8292,707.2176,179.8846,707.5833,185.5296,701.9383,185.8953,711.34,188.8292" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="654.5" y="92.1694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="630" y="103.1694">User or system</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="73" x="631.5" y="114.1694">drafts new tally</text><!--MD5=[9ec7ac5dda423f90c5021c5946f6f01c]
link *start to peerProffer--><path d="M483.77,42.1892 C469.13,48.6792 439.87,62.3192 417,77.1992 C369.93,107.8192 320.51,148.6792 286.42,178.4392 " fill="none" id="*start-to-peerProffer" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="282.34,182.0192,291.748,179.1055,286.1038,178.7277,286.4816,173.0835,282.34,182.0192" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="472" y="86.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="134" x="418" y="97.6694">Receive new proposed tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="447" y="108.6694">[valid signature]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="457" y="119.6694">/Notify user</text><!--MD5=[a44e5c2645e460f04bf8564fa34cd3a8]
link working to userDraft--><path d="M961.9548,276.5162 C961.9026,276.6329 961.8501,276.7494 961.7972,276.8659 C960.952,278.7286 960.0321,280.5541 959.0311,282.3265 C957.0291,285.8714 954.7025,289.2042 952,292.1992 C924.43,322.7492 825.68,355.6592 751.44,377.0092 " fill="none" id="working-to-userDraft" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="746.59,378.3992,756.3453,379.7537,751.3949,377.0162,754.1324,372.0658,746.59,378.3992" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="966" y="309.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="75" x="942" y="320.6694">User signs tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="50" x="954.5" y="331.6694">[valid cert]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="69" x="945" y="342.6694">/Request offer</text><!--MD5=[c062f63624191a0da7aca53a7050afab]
link draft to draft--><path d="M827.23,199.5592 C847.22,201.0992 862,207.4792 862,218.6992 C862,228.9592 849.65,235.1692 832.26,237.3292 " fill="none" id="draft-to-draft" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="827.23,237.8392,836.5851,240.9185,832.2049,237.3389,835.7845,232.9587,827.23,237.8392" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="894.5" y="199.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="42" x="886.5" y="210.6694">Ticketed</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="59" x="878" y="221.6694">tally request</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="79" x="868" y="232.6694">[Have peer cert]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="879.5" y="243.6694">/Notify user</text><!--MD5=[6d291786cb24f46a4240ab0fc8738824]
link userVoid to void--><path d="M488.3,375.9492 C495.64,367.0692 503.35,356.6292 509,346.1992 C525.95,314.9192 537.69,275.5792 544.36,249.1492 " fill="none" id="userVoid-to-void" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="545.63,244.0392,539.5612,251.7961,544.414,248.8891,547.321,253.7418,545.63,244.0392" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="563.5" y="315.1694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="88" x="547.5" y="326.1694">Req:void detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="125" x="529" y="337.1694">/Transmit Act:peerRefuse</text><!--MD5=[c7ac37025faefbcdfa5e2680d3e0f310]
link peerProffer to userVoid--><path d="M254.42,255.4492 C265.13,283.6892 283.79,322.2292 312,346.1992 C331.53,362.7992 356.49,374.4092 380.6,382.4792 " fill="none" id="peerProffer-to-userVoid" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="385.41,384.0492,378.083,377.4678,380.6539,382.5067,375.615,385.0776,385.41,384.0492" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="333" y="315.1694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="63" x="315" y="326.1694">Refuses tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="67" x="313" y="337.1694">/Request void</text><!--MD5=[5a677363dbee82a844a3a2699cbcf052]
link peerProffer to userDraft--><path d="M317.47,255.2392 C340.29,267.8392 364.7,283.1692 385,300.1992 C405.32,317.2392 400.32,332.4492 423,346.1992 C477.79,379.4092 501.51,362.0592 564,376.1992 C568.07,377.1192 572.23,378.0692 576.42,379.0392 " fill="none" id="peerProffer-to-userDraft" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="581.37,380.1892,573.505,374.2612,576.499,379.0607,571.6994,382.0548,581.37,380.1892" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="448.5" y="309.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="62" x="431" y="320.6694">Modifies tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="424" y="331.6694">[valid signature]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="69" x="427.5" y="342.6694">/Request offer</text><!--MD5=[00756e7d50895592618212a2609de1c8]
link peerProffer to userAccept--><path d="M187.6,255.2192 C170.56,267.9692 152.7,283.3892 139,300.1992 C121.7,321.4292 108.54,349.7792 100.24,370.8692 " fill="none" id="peerProffer-to-userAccept" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="98.34,375.7992,105.3156,368.8465,100.1426,371.1354,97.8536,365.9624,98.34,375.7992" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="164.5" y="309.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="62" x="147" y="320.6694">Accepts tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="140" y="331.6694">[valid signature]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="71" x="142.5" y="342.6694">/Request open</text><!--MD5=[0f6370e74eacbad1916d400f4efdc997]
link userAccept to open--><path d="M97.1,426.4692 C112.28,478.3292 147.89,600.0392 165.2,659.2092 " fill="none" id="userAccept-to-open" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="166.62,664.0492,167.9132,654.2856,165.2069,659.2531,160.2394,656.5467,166.62,664.0492" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="175.5" y="542.6694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="88" x="159.5" y="553.6694">req:open detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="123" x="142" y="564.6694">/Transmit act:peerAccept</text><!--MD5=[de356edad13472afc7f6bff6bdbc586e]
link userDraft to userProffer--><path d="M635.98,426.2292 C606.89,451.1692 561.24,490.3192 529.15,517.8392 " fill="none" id="userDraft-to-userProffer" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="525.31,521.1292,534.7465,518.3091,529.1063,517.8753,529.5401,512.2351,525.31,521.1292" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="632.5" y="465.6694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="615.5" y="476.6694">Req:offer detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="123" x="599" y="487.6694">/Transmit Act:peerProffer</text><!--MD5=[ab43650b9e226fe3d785eadc3ee14834]
link userProffer to open--><path d="M427.85,580.2292 C374.55,603.9392 298.87,637.5992 244.22,661.9092 " fill="none" id="userProffer-to-open" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="239.33,664.0892,249.1788,664.0692,243.8949,662.0493,245.9149,656.7654,239.33,664.0892" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="402.5" y="619.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="125" x="353" y="630.6694">Receive peer acceptance</text><!--MD5=[20977e86b08024021f234dd1a3fc6495]
link userProffer to void--><path d="M566.16,547.4192 C617.3,542.3192 684.23,528.2992 731,491.1992 C756.38,471.0692 756.46,457.7092 764,426.1992 C769.17,404.5892 773.92,396.0792 764,376.1992 C738.92,325.9292 712.18,327.3592 663,300.1992 C654.26,295.3692 650.68,297.1492 642,292.1992 C619.98,279.6392 597.68,261.9692 580.66,247.2192 " fill="none" id="userProffer-to-void" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="576.9,243.9192,581.0416,252.855,580.6638,247.2107,586.308,246.8329,576.9,243.9192" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="788.5" y="393.1694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="63" x="770" y="404.1694">Refused tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="59" x="772" y="415.1694">[Notify user]</text><!--MD5=[cb3564aa29e0dd29935cf7ec7e45e987]
link userProffer to peerProffer--><path d="M417.93,530.5692 C364.94,512.7592 296.89,480.5692 261,426.1992 C228.26,376.5992 230.27,305.0692 235.82,260.5292 " fill="none" id="userProffer-to-peerProffer" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="236.48,255.5092,231.3588,263.9219,235.8388,260.4679,239.2928,264.9479,236.48,255.5092" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="301.5" y="393.1694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="105" x="262" y="404.1694">Receive modified tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="286.5" y="415.1694">/Notify user</text><!--MD5=[7505974e352a697c40b5a979226705dc]
link void to peerProffer--><path d="M478.31,218.6992 C437.55,218.6992 386.13,218.6992 341.76,218.6992 " fill="none" id="void-to-peerProffer" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="336.66,218.6992,345.66,222.6992,341.66,218.6992,345.66,214.6992,336.66,218.6992" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="394.5" y="190.1694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="105" x="355" y="201.1694">Receive modified tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="379.5" y="212.1694">/Notify user</text><!--MD5=[1730e699f46067b12b5f9d7039180f86]
link open to userClose--><path d="M250.06,693.6992 C288.37,693.6992 335.24,693.6992 375.42,693.6992 " fill="none" id="open-to-userClose" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="380.79,693.6992,371.79,689.6992,375.79,693.6992,371.79,697.6992,380.79,693.6992" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="302" y="665.1694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="94" x="268.5" y="676.1694">Wants to close tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="73" x="279" y="687.1694">/Request close</text><!--MD5=[8f429cfedb3a3b3b4f08e2b8cbb78e3d]
link open to close--><path d="M202.27,723.2892 C228.23,750.4992 267.07,791.2192 292.96,818.3492 " fill="none" id="open-to-close" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="296.68,822.2492,293.3687,812.9737,293.2314,818.6289,287.5762,818.4915,296.68,822.2492" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="282" y="762.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="65" x="262.5" y="773.6694">Receive peer</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="66" x="262" y="784.6694">close request</text><!--MD5=[81c14222c6606be8a75a840cbe7d5569]
link userClose to close--><path d="M442.02,718.7792 C416.12,745.9392 374.05,790.0392 346.7,818.7092 " fill="none" id="userClose-to-close" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="343.11,822.4792,352.2142,818.7224,346.559,818.8592,346.4222,813.204,343.11,822.4792" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="436.5" y="762.6694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="94" x="417.5" y="773.6694">Req:close detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="117" x="406" y="784.6694">/Transmit act:peerClose</text><!--MD5=[81ac61b32fe79fe384823f5ed7d24f41]
link close to closed--><path d="M395.3,847.6992 C432.64,847.6992 477.88,847.6992 516.41,847.6992 " fill="none" id="close-to-closed" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="521.56,847.6992,512.56,843.6992,516.56,847.6992,512.56,851.6992,521.56,847.6992" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="18" x="449.5" y="819.1694">DB:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="413.5" y="830.1694">(No explicit action)</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="89" x="414" y="841.1694">[Tally sum is zero]</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="142" x="435" y="900.1328">Fri Feb 04 13:27:09 MST 2022</text><!--MD5=[041a1d0ff34356a9f34d7b58fe674b59]
@startuml
!include common.puml

$title(Tally State Diagram)
'state "void" as void

'States are determined by a combination of values, as defined here:
userVoid : Status: offer, Req->void
userAccept : Status: offer, Req->open
userDraft : Status: draft, Req->offer
userClose : Status: open, Req->close
state working {
  draft : Status: draft, Req: null
  draft : User: modify, sign, delete
  void : Status: void, Req: null
}
open : Status: open, Req: null
open : Have both signatures
close : Status: close, Req: null
peerProffer : Status: offer, Req: null
peerProffer : Peer signature only
peerProffer : User: accept, refuse, counter
userProffer : Status: offer, Req: null
userProffer : User signature only
closed : Status: closed, Req: null
closed : Balance is zero

'State transition rules:
[*] -[$user]-> draft : $trans($user,User or system\ndrafts new tally)
[*] -[$peer]-> peerProffer : $trans($peer,Receive new proposed tally,valid signature,Notify user)
working -[$user]-> userDraft : $trans($user,User signs tally,valid cert,Request offer)

draft -[$peer]-> draft : $trans($peer,Ticketed\ntally request,Have peer cert, Notify user)
userVoid -[$db]-> void : $trans($db,Req:void detected,'',Transmit Act:peerRefuse)

peerProffer -[$user]-> userVoid : $trans($user,Refuses tally, '', Request void)
peerProffer -[$user]-> userDraft : $trans($user,Modifies tally,valid signature, Request offer)
peerProffer -[$user]-> userAccept : $trans($user,Accepts tally,valid signature, Request open)

userAccept -[$db]-> open : $trans($db,req:open detected,'',Transmit act:peerAccept)

userDraft -[$db]-> userProffer : $trans($db,Req:offer detected,,Transmit Act:peerProffer)

userProffer -[$peer]-> open : $trans($peer, Receive peer acceptance)
userProffer -[$peer]-> void : $trans($peer,"Refused tally",Notify user)
userProffer -[$peer]-> peerProffer : $trans($peer,Receive modified tally,'',Notify user)
void -[$peer]-> peerProffer : $trans($peer,Receive modified tally,'',Notify user)

open -right[$user]-> userClose : $trans($user, Wants to close tally, '', Request close)
open -[$peer]-> close : $trans($peer,Receive peer\nclose request)
userClose -[$db]-> close : $trans($db,Req:close detected,'',Transmit act:peerClose)
close -right[$db]-> closed : $trans(DB,'(No explicit action)',Tally sum is zero)

'closed - -> [*]

@enduml

@startuml



skinparam backgroundColor fff
skinparam stereotypeCBackgroundColor 27d






skinparam circledCharacter {
  radius 8
  fontSize 11
  fontName Helvetica
}

skinparam class {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  attributeFontColor 333
  attributeFontSize 11
  attributeIconSize 11
}

skinparam actor {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam participant {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam collections {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam SequenceBox{
    backgroundColor e0e0e0
  borderColor cccccc
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam interface {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam component {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}



skinparam queue {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}


skinparam usecase {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam activity {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam sequence {
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  lifeLineBorderColor 4af
  lifeLineBackgroundColor e0e0e0
}




skinparam state {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
  startColor 4af
  endColor 27d
}

skinparam note {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}








  title Tally State Diagram
  footer Fri Feb 04 13:27:09 MST 2022

userVoid : Status: offer, Req->void
userAccept : Status: offer, Req->open
userDraft : Status: draft, Req->offer
userClose : Status: open, Req->close
state working {
  draft : Status: draft, Req: null
  draft : User: modify, sign, delete
  void : Status: void, Req: null
}
open : Status: open, Req: null
open : Have both signatures
close : Status: close, Req: null
peerProffer : Status: offer, Req: null
peerProffer : Peer signature only
peerProffer : User: accept, refuse, counter
userProffer : Status: offer, Req: null
userProffer : User signature only
closed : Status: closed, Req: null
closed : Balance is zero

[*] -[#green]-> draft : <font color=green>User:\nUser or system\ndrafts new tally
[*] -[#blue]-> peerProffer : <font color=blue>Peer:\nReceive new proposed tally\n[valid signature]\n/Notify user
working -[#green]-> userDraft : <font color=green>User:\nUser signs tally\n[valid cert]\n/Request offer

draft -[#blue]-> draft : <font color=blue>Peer:\nTicketed\ntally request\n[Have peer cert]\n/Notify user
userVoid -[#red]-> void : <font color=red>DB Trigger:\nReq:void detected\n/Transmit Act:peerRefuse

peerProffer -[#green]-> userVoid : <font color=green>User:\nRefuses tally\n/Request void
peerProffer -[#green]-> userDraft : <font color=green>User:\nModifies tally\n[valid signature]\n/Request offer
peerProffer -[#green]-> userAccept : <font color=green>User:\nAccepts tally\n[valid signature]\n/Request open

userAccept -[#red]-> open : <font color=red>DB Trigger:\nreq:open detected\n/Transmit act:peerAccept

userDraft -[#red]-> userProffer : <font color=red>DB Trigger:\nReq:offer detected\n/Transmit Act:peerProffer

userProffer -[#blue]-> open : <font color=blue>Peer:\nReceive peer acceptance
userProffer -[#blue]-> void : <font color=blue>Peer:\nRefused tally\n[Notify user]
userProffer -[#blue]-> peerProffer : <font color=blue>Peer:\nReceive modified tally\n/Notify user
void -[#blue]-> peerProffer : <font color=blue>Peer:\nReceive modified tally\n/Notify user

open -right[#green]-> userClose : <font color=green>User:\nWants to close tally\n/Request close
open -[#blue]-> close : <font color=blue>Peer:\nReceive peer\nclose request
userClose -[#red]-> close : <font color=red>DB Trigger:\nReq:close detected\n/Transmit act:peerClose
close -right[#red]-> closed : <font color=black>DB:\n(No explicit action)\n[Tally sum is zero]


@enduml

PlantUML version 1.2021.12(Tue Oct 05 10:01:58 MDT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>