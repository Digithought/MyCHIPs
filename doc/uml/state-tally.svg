<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1014px" preserveAspectRatio="none" style="width:1069px;height:1014px;background:#FFFFFF;" version="1.1" viewBox="0 0 1069 1014" width="1069px" zoomAndPan="magnify"><defs><filter height="300%" id="f1eq36e6wpd8ps" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="169" x="443.75" y="17.4023">Tally State Diagram</text><!--MD5=[932510f84763d6405ab56e4a2265926e]
cluster working--><rect fill="#E8E8EA" filter="url(#f1eq36e6wpd8ps)" height="121" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="580" x="458.5" y="158.1992"/><rect fill="#FFFFFF" height="94" rx="12.5" ry="12.5" style="stroke:#FFFFFF;stroke-width:1.0;" width="574" x="461.5" y="182.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="458.5" x2="1038.5" y1="179.1992" y2="179.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="38" x="729.5" y="170.6694">working</text><!--MD5=[434d6044c2588cbe8ba7a06cfdde95dc]
cluster liftable--><rect fill="#E8E8EA" filter="url(#f1eq36e6wpd8ps)" height="284" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="204" x="141.5" y="701.1992"/><rect fill="#FFFFFF" height="257" rx="12.5" ry="12.5" style="stroke:#FFFFFF;stroke-width:1.0;" width="198" x="144.5" y="725.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="141.5" x2="345.5" y1="722.1992" y2="722.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="30" x="228.5" y="713.6694">liftable</text><g id="working.draft"><rect fill="#E8E8EA" filter="url(#f1eq36e6wpd8ps)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="192" x="663.5" y="196.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="663.5" x2="855.5" y1="217.1992" y2="217.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="22" x="748.5" y="209.6694">draft</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="129" x="668.5" y="233.8008">Status: draft, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="172" x="668.5" y="247.9336">User: can modify, sign, delete</text></g><g id="working.void"><rect fill="#E8E8EA" filter="url(#f1eq36e6wpd8ps)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="145" x="483" y="196.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="483" x2="628" y1="217.1992" y2="217.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="20" x="545.5" y="209.6694">void</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="125" x="488" y="233.8008">Status: void, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="97" x="488" y="247.9336">User: can modify</text></g><g id="liftable.open"><rect fill="#E8E8EA" filter="url(#f1eq36e6wpd8ps)" height="73.3984" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="171" x="158" y="731.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="158" x2="329" y1="752.1992" y2="752.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="231.5" y="744.6694">open</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="130" x="163" y="768.8008">Status: open, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="151" x="163" y="782.9336">Must have both signatures</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="135" x="163" y="797.0664">User: can request close</text></g><g id="liftable.close"><rect fill="#E8E8EA" filter="url(#f1eq36e6wpd8ps)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="150" x="176.5" y="910.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="176.5" x2="326.5" y1="931.1992" y2="931.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="238.5" y="923.6694">close</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="130" x="181.5" y="947.8008">Status: close, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="105" x="181.5" y="961.9336">Non-zero balance</text></g><g id="pOfferVoid"><rect fill="#E8E8EA" filter="url(#f1eq36e6wpd8ps)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="152" x="377.5" y="386.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="377.5" x2="529.5" y1="407.1992" y2="407.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="55" x="426" y="399.6694">P.offer.void</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="132" x="382.5" y="423.8008">Status: offer, Req: void</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="382.5" y="437.9336">Agent: Attention!</text></g><g id="BOfferOpen"><rect fill="#E8E8EA" filter="url(#f1eq36e6wpd8ps)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="157" x="7" y="386.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="7" x2="164" y1="407.1992" y2="407.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="59" x="56" y="399.6694">B.offer.open</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="137" x="12" y="423.8008">Status: offer, Req: open</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="12" y="437.9336">Agent: Attention!</text></g><g id="DraftOffer"><rect fill="#E8E8EA" filter="url(#f1eq36e6wpd8ps)" height="73.3984" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="164" x="564.5" y="379.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="564.5" x2="728.5" y1="400.1992" y2="400.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="47" x="623" y="392.6694">draft.offer</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="136" x="569.5" y="416.8008">Status: draft, Req: offer</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="144" x="569.5" y="430.9336">Must have user signature</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="569.5" y="445.0664">Agent: Attention!</text></g><g id="OpenClose"><rect fill="#E8E8EA" filter="url(#f1eq36e6wpd8ps)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="159" x="467" y="738.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="467" x2="626" y1="759.1992" y2="759.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="53" x="520" y="751.6694">open.close</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="139" x="472" y="775.8008">Status: open, Req: close</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="472" y="789.9336">Agent: Attention!</text></g><g id="pOffer"><rect fill="#E8E8EA" filter="url(#f1eq36e6wpd8ps)" height="73.3984" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="211" x="129" y="189.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="129" x2="340" y1="210.1992" y2="210.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="32" x="218.5" y="202.6694">P.offer</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="128" x="134" y="226.8008">Status: offer, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="110" x="134" y="240.9336">Peer signature only</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="191" x="134" y="255.0664">User: can accept, refuse, counter</text></g><g id="hOffer"><rect fill="#E8E8EA" filter="url(#f1eq36e6wpd8ps)" height="73.3984" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="148" x="362.5" y="547.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="362.5" x2="510.5" y1="568.1992" y2="568.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="33" x="420" y="560.6694">H.offer</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="128" x="367.5" y="584.8008">Status: offer, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="110" x="367.5" y="598.9336">User signature only</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="110" x="367.5" y="613.0664">User waits for peer</text></g><g id="closed"><rect fill="#E8E8EA" filter="url(#f1eq36e6wpd8ps)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="158" x="453.5" y="910.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="453.5" x2="611.5" y1="931.1992" y2="931.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="100" x="482.5" y="923.6694">close (zero balance)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="138" x="458.5" y="947.8008">Status: closed, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="87" x="458.5" y="961.9336">Balance is zero</text></g><ellipse cx="496.5" cy="37.1992" fill="#44AAFF" filter="url(#f1eq36e6wpd8ps)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><!--MD5=[98967d72ce6cf1fee1a27daeddde0c85]
link *start to draft--><path d="M505.81,41.3992 C522.2,47.2492 556.99,60.5992 583.5,77.1992 C637.56,111.0492 692.79,160.2092 726.62,192.3092 " fill="none" id="*start-to-draft" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="730.63,196.1392,726.8544,187.0428,727.0029,192.6977,721.348,192.8462,730.63,196.1392" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="685" y="97.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="660.5" y="108.6694">User or system</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="73" x="662" y="119.6694">drafts new tally</text><!--MD5=[a843d81587e846b1f84799ee78e823b8]
link *start to pOffer--><path d="M488.66,43.7792 C459.29,64.6892 354.14,139.5392 288.65,186.1592 " fill="none" id="*start-to-pOffer" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="284.39,189.1892,294.0412,187.2258,288.4625,186.2884,289.3999,180.7098,284.39,189.1892" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="494.5" y="86.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="134" x="440.5" y="97.6694">Receive new proposed tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="469.5" y="108.6694">[valid signature]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="47" x="484" y="119.6694">/Act: offer</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="53" x="481" y="130.6694">Notify user</text><!--MD5=[f93311f55d9ef408d52e14ba6e31305b]
link working to DraftOffer--><path d="M1021.8774,279.2538 C1021.828,279.3644 1021.7784,279.475 1021.7285,279.5853 C1021.5289,280.0269 1021.3249,280.4663 1021.1164,280.9033 C1020.2824,282.6515 1019.3763,284.3616 1018.3921,286.0185 C1016.4236,289.3322 1014.1425,292.433 1011.5,295.1992 C1010.87,295.8592 841.21,351.2392 733.45,386.3692 " fill="none" id="working-to-DraftOffer" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="728.69,387.9192,738.485,388.9476,733.4461,386.3767,736.017,381.3378,728.69,387.9192" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="1010.5" y="312.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="75" x="986.5" y="323.6694">User signs tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="50" x="999" y="334.6694">[valid cert]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="69" x="989.5" y="345.6694">/Request offer</text><!--MD5=[c062f63624191a0da7aca53a7050afab]
link draft to draft--><path d="M855.75,207.5792 C875.95,209.4592 890.5,215.4892 890.5,225.6992 C890.5,235.0292 878.34,240.8792 860.83,243.2392 " fill="none" id="draft-to-draft" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="855.75,243.8192,865.1489,246.7623,860.7171,243.2466,864.2327,238.8149,855.75,243.8192" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="938.5" y="212.1694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="104" x="899.5" y="223.1694">Ticketed tally request</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="79" x="912" y="234.1694">[Have peer cert]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="110" x="896.5" y="245.1694">/Act: ticket; Notify user</text><!--MD5=[32fa2ebd6d599e34ead6e35ca840f245]
link pOfferVoid to void--><path d="M482.36,386.1492 C492.24,375.2592 502.75,362.2992 510.5,349.1992 C527.15,321.0392 539.33,285.6792 546.79,260.1992 " fill="none" id="pOfferVoid-to-void" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="548.22,255.2392,541.8866,262.7817,546.837,260.0441,549.5745,264.9945,548.22,255.2392" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="548.5" y="318.1694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="88" x="532.5" y="329.1694">Req:void detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="88" x="532.5" y="340.1694">/Transmit Act:void</text><!--MD5=[6b9e9182ae89892674723abc43fbc571]
link pOffer to pOfferVoid--><path d="M250.27,262.2292 C263.63,289.0092 285,325.1092 312.5,349.1992 C329.96,364.4892 351.6,376.8992 372.64,386.6392 " fill="none" id="pOffer-to-pOfferVoid" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="377.41,388.8092,370.8719,381.4435,372.8582,386.7402,367.5615,388.7265,377.41,388.8092" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="333.5" y="318.1694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="63" x="315.5" y="329.1694">Refuses tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="67" x="313.5" y="340.1694">/Request void</text><!--MD5=[08dacb9f37a0c3215fcb43a00c7a1b37]
link pOffer to DraftOffer--><path d="M319.58,262.3792 C342.11,273.7692 365.66,287.5392 385.5,303.1992 C406.54,319.8092 401.7,335.1092 424.5,349.1992 C472.37,378.7692 493.61,363.0092 547.5,379.1992 C551.46,380.3892 555.49,381.6492 559.56,382.9492 " fill="none" id="pOffer-to-DraftOffer" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="564.34,384.4992,557.013,377.9178,559.5839,382.9567,554.545,385.5276,564.34,384.4992" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="450" y="312.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="62" x="432.5" y="323.6694">Modifies tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="425.5" y="334.6694">[valid signature]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="69" x="429" y="345.6694">/Request offer</text><!--MD5=[cc50ebd3c42bc55b4d513d732813f8e9]
link pOffer to BOfferOpen--><path d="M174.27,262.3592 C158.48,273.8692 142.53,287.7092 130.5,303.1992 C112.57,326.2892 100.79,357.4892 93.8,381.0092 " fill="none" id="pOffer-to-BOfferOpen" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="92.38,385.8992,98.74,378.3792,93.78,381.0992,91.06,376.1392,92.38,385.8992" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="156" y="312.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="62" x="138.5" y="323.6694">Accepts tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="131.5" y="334.6694">[valid signature]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="71" x="134" y="345.6694">/Request open</text><!--MD5=[7b6743e49a6f8d81c8cd9df7b9ebb834]
link BOfferOpen to open--><path d="M98.43,445.3392 C126.48,507.4892 193.01,654.8492 225.29,726.3692 " fill="none" id="BOfferOpen-to-open" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="227.37,730.9692,227.3129,721.1205,225.3128,726.412,220.0213,724.412,227.37,730.9692" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="193.5" y="575.6694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="88" x="177.5" y="586.6694">req:open detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="92" x="175.5" y="597.6694">/Transmit Act:open</text><!--MD5=[e86374a8b4b43ff786cd666e0d7700f5]
link DraftOffer to hOffer--><path d="M601.45,452.3092 C567.4,479.2292 520.71,516.1392 485.69,543.8192 " fill="none" id="DraftOffer-to-hOffer" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="481.48,547.1492,491.0231,544.7142,485.4051,544.0519,486.0674,538.434,481.48,547.1492" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="577.5" y="491.6694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="560.5" y="502.6694">Req:offer detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="560.5" y="513.6694">/Transmit Act:offer</text><!--MD5=[19685337731f22f29488c30b9cdec922]
link hOffer to open--><path d="M398.83,620.2192 C366.12,651.0692 318.84,695.6492 285.04,727.5192 " fill="none" id="hOffer-to-open" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="281.4,730.9592,290.6953,727.7037,285.041,727.5324,285.2123,721.8781,281.4,730.9592" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="413" y="659.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="125" x="363.5" y="670.6694">Receive peer acceptance</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="49" x="401.5" y="681.6694">/Act: open</text><!--MD5=[d5d583d9dafd86b63dd4d4520088065c]
link hOffer to void--><path d="M510.5,577.5192 C587.73,567.4692 703.46,538.0792 746.5,452.1992 C761.04,423.1892 760.57,408.4392 746.5,379.1992 C742.42,370.7192 652.3,300.7792 597.33,258.6192 " fill="none" id="hOffer-to-void" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="593.1,255.3792,597.8113,264.0281,597.069,258.4202,602.6769,257.6778,593.1,255.3792" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="796.5" y="407.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="101" x="759" y="418.6694">Receive peer refusal</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="104" x="757.5" y="429.6694">/Act: void; Notify user</text><!--MD5=[e7c045274f428f72e469ee4dfcada223]
link hOffer to pOffer--><path d="M362.14,549.6292 C322.55,527.8992 277.07,495.4392 252.5,452.1992 C219.83,394.7092 222.35,315.2992 227.9,267.6692 " fill="none" id="hOffer-to-pOffer" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="228.52,262.5992,223.4675,271.0534,227.9192,267.563,231.4096,272.0147,228.52,262.5992" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="293.5" y="407.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="105" x="254" y="418.6694">Receive modified tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="106" x="253.5" y="429.6694">/Act: offer; Notify user</text><!--MD5=[0545aa1bcab47bbb6a638ba8079c13c5]
link void to pOffer--><path d="M482.86,225.6992 C442.26,225.6992 390.81,225.6992 345.29,225.6992 " fill="none" id="void-to-pOffer" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="340.05,225.6992,349.05,229.6992,345.05,225.6992,349.05,221.6992,340.05,225.6992" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="398.5" y="197.1694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="105" x="359" y="208.1694">Receive modified tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="106" x="358.5" y="219.1694">/Act: offer; Notify user</text><!--MD5=[5474f4d027dde9dca5f96ace60676f0a]
link open to OpenClose--><path d="M329.11,767.6992 C370.65,767.6992 420.39,767.6992 461.81,767.6992 " fill="none" id="open-to-OpenClose" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="466.82,767.6992,457.82,763.6992,461.82,767.6992,457.82,771.6992,466.82,767.6992" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="384.5" y="739.1694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="101" x="347.5" y="750.1694">Issues close/call chit</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="73" x="361.5" y="761.1694">/Request close</text><!--MD5=[8f429cfedb3a3b3b4f08e2b8cbb78e3d]
link open to close--><path d="M245.18,804.3392 C246.57,833.9392 248.54,875.7692 249.91,904.8692 " fill="none" id="open-to-close" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="250.16,910.1492,253.7448,900.9759,249.9317,905.1544,245.7532,901.3413,250.16,910.1492" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="269.5" y="843.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="65" x="250" y="854.6694">Receive peer</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="66" x="249.5" y="865.6694">close request</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="51" x="257" y="876.6694">/Act: close</text><!--MD5=[ec3a4166d467ad797f342540326c9b3e]
link OpenClose to close--><path d="M496.79,797.3492 C443.93,827.8092 360.56,875.8492 305.95,907.3192 " fill="none" id="OpenClose-to-close" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="301.41,909.9392,311.2055,908.9158,305.7433,907.4447,307.2143,901.9825,301.41,909.9392" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="456" y="849.1694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="94" x="437" y="860.1694">Req:close detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="117" x="425.5" y="871.1694">/Transmit act:peerClose</text><!--MD5=[81ac61b32fe79fe384823f5ed7d24f41]
link close to closed--><path d="M326.8,939.6992 C364.14,939.6992 409.38,939.6992 447.91,939.6992 " fill="none" id="close-to-closed" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="453.06,939.6992,444.06,935.6992,448.06,939.6992,444.06,943.6992,453.06,939.6992" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="18" x="381" y="911.1694">DB:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="345" y="922.1694">(No explicit action)</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="89" x="345.5" y="933.1694">[Tally sum is zero]</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="153" x="451.75" y="1005.8672">Thu May 12 09:43:34 MDT 2022</text><!--MD5=[da5c1cc77c20fa22ce20d59409c2f6ff]
@startuml
!include common.puml

$title(Tally State Diagram)
state "P.offer.void" as pOfferVoid
state "B.offer.open" as BOfferOpen
state "draft.offer" as DraftOffer
state "open.close" as OpenClose
state working {
  state "draft" as draft
  state "void" as void
}
state liftable {
  state "open" as open
  state "close" as close
}
state "P.offer" as pOffer
state "H.offer" as hOffer
state "close (zero balance)" as closed

'State details
pOfferVoid : Status: offer, Req: void
pOfferVoid : Agent: Attention!

BOfferOpen : Status: offer, Req: open
BOfferOpen : Agent: Attention!

DraftOffer : Status: draft, Req: offer
DraftOffer : Must have user signature
DraftOffer : Agent: Attention!

OpenClose : Status: open, Req: close
OpenClose : Agent: Attention!

draft : Status: draft, Req: null
draft : User: can modify, sign, delete

void : Status: void, Req: null
void : User: can modify

pOffer : Status: offer, Req: null
pOffer : Peer signature only
pOffer : User: can accept, refuse, counter

hOffer : Status: offer, Req: null
hOffer : User signature only
hOffer : User waits for peer

open : Status: open, Req: null
open : Must have both signatures
open : User: can request close

close : Status: close, Req: null
close : Non-zero balance

closed : Status: closed, Req: null
closed : Balance is zero

'State transition rules:
[*] -[$user]-> draft : $trans($user,User or system\ndrafts new tally)
[*] -[$peer]-> pOffer : $trans($peer,Receive new proposed tally,valid signature,Act: offer\nNotify user)
working -[$user]-> DraftOffer : $trans($user,User signs tally,valid cert,Request offer)

draft -[$peer]-> draft : $trans($peer,Ticketed tally request,Have peer cert, Act: ticket; Notify user)
pOfferVoid -[$db]-> void : $trans($db,Req:void detected,'',Transmit Act:void)

pOffer -[$user]-> pOfferVoid : $trans($user,Refuses tally, '', Request void)
pOffer -[$user]-> DraftOffer : $trans($user,Modifies tally,valid signature, Request offer)
pOffer -[$user]-> BOfferOpen : $trans($user,Accepts tally,valid signature, Request open)

BOfferOpen -[$db]-> open : $trans($db,req:open detected,'',Transmit Act:open)

DraftOffer -[$db]-> hOffer : $trans($db,Req:offer detected,,Transmit Act:offer)

hOffer -[$peer]-> open : $trans($peer, Receive peer acceptance, '', Act: open)
hOffer -[$peer]-> void : $trans($peer,Receive peer refusal, '', Act: void; Notify user)
hOffer -[$peer]-> pOffer : $trans($peer,Receive modified tally, '', Act: offer; Notify user)
void -[$peer]-> pOffer : $trans($peer,Receive modified tally,'', Act: offer; Notify user)

open -right[$user]-> OpenClose : $trans($user, Issues close/call chit, '', Request close)
open -[$peer]-> close : $trans($peer,Receive peer\nclose request, '', Act: close)
OpenClose -[$db]-> close : $trans($db,Req:close detected,'',Transmit act:peerClose)
close -right[$db]-> closed : $trans(DB,'(No explicit action)',Tally sum is zero)

'closed - -> [*]

@enduml

@startuml



skinparam backgroundColor fff
skinparam stereotypeCBackgroundColor 27d






skinparam circledCharacter {
  radius 8
  fontSize 11
  fontName Helvetica
}

skinparam class {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  attributeFontColor 333
  attributeFontSize 11
  attributeIconSize 11
}

skinparam actor {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam participant {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam collections {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam SequenceBox{
    backgroundColor e0e0e0
  borderColor cccccc
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam interface {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam component {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}



skinparam queue {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}


skinparam usecase {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam activity {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam sequence {
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  lifeLineBorderColor 4af
  lifeLineBackgroundColor e0e0e0
}




skinparam state {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
  startColor 4af
  endColor 27d
}

skinparam note {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}








  title Tally State Diagram
  footer Thu May 12 09:43:34 MDT 2022
state "P.offer.void" as pOfferVoid
state "B.offer.open" as BOfferOpen
state "draft.offer" as DraftOffer
state "open.close" as OpenClose
state working {
  state "draft" as draft
  state "void" as void
}
state liftable {
  state "open" as open
  state "close" as close
}
state "P.offer" as pOffer
state "H.offer" as hOffer
state "close (zero balance)" as closed

pOfferVoid : Status: offer, Req: void
pOfferVoid : Agent: Attention!

BOfferOpen : Status: offer, Req: open
BOfferOpen : Agent: Attention!

DraftOffer : Status: draft, Req: offer
DraftOffer : Must have user signature
DraftOffer : Agent: Attention!

OpenClose : Status: open, Req: close
OpenClose : Agent: Attention!

draft : Status: draft, Req: null
draft : User: can modify, sign, delete

void : Status: void, Req: null
void : User: can modify

pOffer : Status: offer, Req: null
pOffer : Peer signature only
pOffer : User: can accept, refuse, counter

hOffer : Status: offer, Req: null
hOffer : User signature only
hOffer : User waits for peer

open : Status: open, Req: null
open : Must have both signatures
open : User: can request close

close : Status: close, Req: null
close : Non-zero balance

closed : Status: closed, Req: null
closed : Balance is zero

[*] -[#green]-> draft : <font color=green>User:\nUser or system\ndrafts new tally
[*] -[#blue]-> pOffer : <font color=blue>Peer:\nReceive new proposed tally\n[valid signature]\n/Act: offer\nNotify user
working -[#green]-> DraftOffer : <font color=green>User:\nUser signs tally\n[valid cert]\n/Request offer

draft -[#blue]-> draft : <font color=blue>Peer:\nTicketed tally request\n[Have peer cert]\n/Act: ticket; Notify user
pOfferVoid -[#red]-> void : <font color=red>DB Trigger:\nReq:void detected\n/Transmit Act:void

pOffer -[#green]-> pOfferVoid : <font color=green>User:\nRefuses tally\n/Request void
pOffer -[#green]-> DraftOffer : <font color=green>User:\nModifies tally\n[valid signature]\n/Request offer
pOffer -[#green]-> BOfferOpen : <font color=green>User:\nAccepts tally\n[valid signature]\n/Request open

BOfferOpen -[#red]-> open : <font color=red>DB Trigger:\nreq:open detected\n/Transmit Act:open

DraftOffer -[#red]-> hOffer : <font color=red>DB Trigger:\nReq:offer detected\n/Transmit Act:offer

hOffer -[#blue]-> open : <font color=blue>Peer:\nReceive peer acceptance\n/Act: open
hOffer -[#blue]-> void : <font color=blue>Peer:\nReceive peer refusal\n/Act: void; Notify user
hOffer -[#blue]-> pOffer : <font color=blue>Peer:\nReceive modified tally\n/Act: offer; Notify user
void -[#blue]-> pOffer : <font color=blue>Peer:\nReceive modified tally\n/Act: offer; Notify user

open -right[#green]-> OpenClose : <font color=green>User:\nIssues close/call chit\n/Request close
open -[#blue]-> close : <font color=blue>Peer:\nReceive peer\nclose request\n/Act: close
OpenClose -[#red]-> close : <font color=red>DB Trigger:\nReq:close detected\n/Transmit act:peerClose
close -right[#red]-> closed : <font color=black>DB:\n(No explicit action)\n[Tally sum is zero]


@enduml

PlantUML version 1.2022.1(Tue Feb 01 11:19:58 MST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>