<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1059px" preserveAspectRatio="none" style="width:753px;height:1059px;background:#FFFFFF;" version="1.1" viewBox="0 0 753 1059" width="753px" zoomAndPan="magnify"><defs><filter height="300%" id="f16fjpm9zbuofc" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="169" x="285.91" y="17.4023">Tally State Diagram</text><ellipse cx="257.82" cy="222.6992" fill="#44AAFF" filter="url(#f16fjpm9zbuofc)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><g id="void"><rect fill="#E8E8EA" filter="url(#f16fjpm9zbuofc)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="141" x="198.32" y="373.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="198.32" x2="339.32" y1="394.1992" y2="394.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="20" x="258.82" y="386.6694">void</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121" x="203.32" y="410.8008">Stat-&gt;void, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="65" x="203.32" y="424.9336">(or no tally)</text></g><g id="userVoid"><rect fill="#E8E8EA" filter="url(#f16fjpm9zbuofc)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="149" x="63.32" y="197.6992"/><line style="stroke:#202024;stroke-width:1.5;" x1="63.32" x2="212.32" y1="218.6992" y2="218.6992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="43" x="116.32" y="211.1694">userVoid</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="129" x="68.32" y="235.3008">Stat: draft, Req-&gt;void</text></g><g id="userAccept"><rect fill="#E8E8EA" filter="url(#f16fjpm9zbuofc)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="154" x="528.82" y="293.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="528.82" x2="682.82" y1="314.1992" y2="314.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="577.82" y="306.6694">userAccept</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="134" x="533.82" y="330.8008">Stat: draft, Req-&gt;open</text></g><g id="userDraft"><rect fill="#E8E8EA" filter="url(#f16fjpm9zbuofc)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="149" x="149.32" y="527.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="149.32" x2="298.32" y1="548.1992" y2="548.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="46" x="200.82" y="540.6694">userDraft</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="129" x="154.32" y="564.8008">Stat: void, Req-&gt;draft</text></g><g id="userClose"><rect fill="#E8E8EA" filter="url(#f16fjpm9zbuofc)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="155" x="220.32" y="819.6992"/><line style="stroke:#202024;stroke-width:1.5;" x1="220.32" x2="375.32" y1="840.6992" y2="840.6992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="50" x="272.82" y="833.1694">userClose</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="135" x="225.32" y="857.3008">Stat: open, Req-&gt;close</text></g><g id="open"><rect fill="#E8E8EA" filter="url(#f16fjpm9zbuofc)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="156" x="487.82" y="815.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="487.82" x2="643.82" y1="836.1992" y2="836.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="553.82" y="828.6694">open</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="126" x="492.82" y="852.8008">Stat-&gt;open, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="136" x="492.82" y="866.9336">E: Add peer's signature</text></g><g id="closing"><rect fill="#E8E8EA" filter="url(#f16fjpm9zbuofc)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="146" x="371.82" y="973.6992"/><line style="stroke:#202024;stroke-width:1.5;" x1="371.82" x2="517.82" y1="994.6992" y2="994.6992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="34" x="427.82" y="987.1694">closing</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="126" x="376.82" y="1011.3008">Stat-&gt;close, Req: null</text></g><g id="peerProffer"><rect fill="#E8E8EA" filter="url(#f16fjpm9zbuofc)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="145" x="265.32" y="28.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="265.32" x2="410.32" y1="49.1992" y2="49.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="55" x="310.32" y="41.6694">peerProffer</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="125" x="270.32" y="65.8008">Stat-&gt;draft, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="110" x="270.32" y="79.9336">Peer signature only</text></g><g id="userProffer"><rect fill="#E8E8EA" filter="url(#f16fjpm9zbuofc)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="145" x="358.32" y="672.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="358.32" x2="503.32" y1="693.1992" y2="693.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="55" x="403.32" y="685.6694">userProffer</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="125" x="363.32" y="709.8008">Stat-&gt;draft, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="110" x="363.32" y="723.9336">User signature only</text></g><g id="closed"><rect fill="#E8E8EA" filter="url(#f16fjpm9zbuofc)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="154" x="90.82" y="969.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="90.82" x2="244.82" y1="990.1992" y2="990.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="32" x="151.82" y="982.6694">closed</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="134" x="95.82" y="1006.8008">Stat-&gt;closed, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="87" x="95.82" y="1020.9336">Balance is zero</text></g><!--MD5=[eb2730c87370629c3c3d87a1a2ccbb41]
link *start to void--><path d="M258.39,232.7692 C259.9,257.2992 264.14,325.8892 266.73,367.7392 " fill="none" id="*start-to-void" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="267.05,372.9592,270.4775,363.726,266.7363,367.9691,262.4933,364.2279,267.05,372.9592" style="stroke:#000000;stroke-width:1.0;"/><!--MD5=[7505974e352a697c40b5a979226705dc]
link void to peerProffer--><path d="M279.61,373.1092 C282.9,363.6792 286.3,353.0792 288.82,343.1992 C311.65,253.8192 326.98,145.8892 333.8,92.2992 " fill="none" id="void-to-peerProffer" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="334.43,87.2792,329.3296,95.7046,333.801,92.2395,337.2661,96.7109,334.43,87.2792" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="356.32" y="191.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="82" x="328.32" y="202.6694">Proposes a Tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="331.32" y="213.6694">[valid signature]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="341.32" y="224.6694">/Notify user</text><path d="M324.82,233.1992 L324.82,254.1992 L409.82,254.1992 L409.82,243.1992 L399.82,233.1992 L324.82,233.1992 " fill="#E8E8EA" filter="url(#f16fjpm9zbuofc)" style="stroke:#0000FF;stroke-width:1.0;"/><path d="M399.82,233.1992 L399.82,243.1992 L409.82,243.1992 L399.82,233.1992 " fill="#E8E8EA" style="stroke:#0000FF;stroke-width:1.0;"/><a href="../Tallies.md#establishing-a-tally" target="_top" title="Can't happen until our user uses a connection ticket to connect to the propser's system and exchange keys" xlink:actuate="onRequest" xlink:href="../Tallies.md#establishing-a-tally" xlink:show="new" xlink:title="Can't happen until our user uses a connection ticket to connect to the propser's system and exchange keys" xlink:type="simple"><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" text-decoration="underline" textLength="64" x="330.82" y="246.6694">User-initiated</text></a><!--MD5=[4f5e7d5c0334881400bb03d542b6e1be]
link void to userDraft--><path d="M260.04,432.4892 C252.18,458.2692 240.69,495.8992 232.78,521.8492 " fill="none" id="void-to-userDraft" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="231.24,526.8792,237.688,519.4346,232.6964,522.096,230.0349,517.1044,231.24,526.8792" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="280.82" y="471.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="87" x="250.82" y="482.6694">New Tally Record</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="256.32" y="493.6694">[valid signature]</text><!--MD5=[6d291786cb24f46a4240ab0fc8738824]
link userVoid to void--><path d="M131.44,247.8992 C126.11,273.7392 122.07,314.7992 140.82,343.1992 C153.15,361.8692 173.04,374.6692 193.5,383.4092 " fill="none" id="userVoid-to-void" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="198.15,385.3192,191.3432,378.2012,193.5245,383.4205,188.3052,385.6019,198.15,385.3192" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="169.32" y="310.1694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="88" x="153.32" y="321.1694">Req:void detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="111" x="141.82" y="332.1694">/Transmit Act:userVoid</text><!--MD5=[c7ac37025faefbcdfa5e2680d3e0f310]
link peerProffer to userVoid--><path d="M279.35,87.3392 C263.92,96.0192 247.71,106.1992 233.82,117.1992 C205.29,139.8092 177.7,171.1492 159.48,193.5992 " fill="none" id="peerProffer-to-userVoid" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="156.19,197.6792,164.9599,193.1971,159.3343,193.7917,158.7398,188.1661,156.19,197.6792" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="259.32" y="132.1694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="234.82" y="143.1694">Request to void</text><!--MD5=[5a677363dbee82a844a3a2699cbcf052]
link peerProffer to userDraft--><path d="M265.13,67.0792 C195.69,79.3592 94.6,109.3692 45.82,182.1992 C6,241.6692 16.65,276.1992 41.82,343.1992 C70.9,420.5892 143.28,488.0292 187.51,523.8492 " fill="none" id="peerProffer-to-userDraft" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="191.43,527.0092,186.9127,518.2574,187.5298,523.8805,181.9068,524.4977,191.43,527.0092" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="67.32" y="310.1694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="62" x="49.82" y="321.1694">Modifies tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="42.82" y="332.1694">[valid signature]</text><!--MD5=[00756e7d50895592618212a2609de1c8]
link peerProffer to userAccept--><path d="M410.59,68.5792 C445.88,76.5992 486.81,91.0892 515.82,117.1992 C567.23,163.4592 590.99,244.7392 600.46,288.0692 " fill="none" id="peerProffer-to-userAccept" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="601.55,293.1592,603.5831,283.5225,600.5063,288.2694,595.7594,285.1925,601.55,293.1592" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="568.32" y="126.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="62" x="550.82" y="137.6694">Accepts tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="543.82" y="148.6694">[valid signature]</text><!--MD5=[0f6370e74eacbad1916d400f4efdc997]
link userAccept to open--><path d="M609.78,343.4392 C614.52,374.6392 621.82,430.5492 621.82,478.6992 C621.82,478.6992 621.82,478.6992 621.82,702.6992 C621.82,741.8292 602.97,783.0192 587.14,810.7092 " fill="none" id="userAccept-to-open" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="584.63,815.0392,592.595,809.2462,587.1307,810.7095,585.6674,805.2452,584.63,815.0392" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="656.32" y="544.1694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="88" x="640.32" y="555.1694">req:open detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="123" x="622.82" y="566.1694">/Transmit act:userAccept</text><!--MD5=[de356edad13472afc7f6bff6bdbc586e]
link userDraft to userProffer--><path d="M215.39,577.2292 C210.19,596.7192 206.89,623.8592 220.82,642.1992 C237.12,663.6592 300.27,679.3492 353.1,689.0392 " fill="none" id="userDraft-to-userProffer" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="358.18,689.9592,350.0322,684.4263,353.2593,689.0723,348.6132,692.2994,358.18,689.9592" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="255.32" y="616.6694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="238.32" y="627.6694">Req:draft detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="123" x="221.82" y="638.6694">/Transmit Act:peerProffer</text><!--MD5=[ab43650b9e226fe3d785eadc3ee14834]
link userProffer to open--><path d="M458.14,731.2292 C480.23,754.2992 511.34,786.7892 534.45,810.9292 " fill="none" id="userProffer-to-open" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="538.08,814.7292,534.7496,805.4606,534.6239,811.116,528.9684,810.9903,538.08,814.7292" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="527.82" y="770.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="68" x="506.82" y="781.6694">Accepted tally</text><!--MD5=[20977e86b08024021f234dd1a3fc6495]
link userProffer to void--><path d="M422.98,671.9792 C407.45,616.4092 372.08,496.6192 346.82,462.1992 C339.55,452.2892 330.13,443.2892 320.36,435.4892 " fill="none" id="userProffer-to-void" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="316.16,432.2192,320.8019,440.9056,320.1045,435.2919,325.7181,434.5945,316.16,432.2192" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="413.32" y="538.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="63" x="394.82" y="549.6694">Refused tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="57" x="397.82" y="560.6694">or timed out</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="59" x="396.82" y="571.6694">[Notify user]</text><!--MD5=[cb3564aa29e0dd29935cf7ec7e45e987]
link userProffer to peerProffer--><path d="M449.82,672.1092 C467.06,643.3292 489.82,597.0492 489.82,553.1992 C489.82,221.6992 489.82,221.6992 489.82,221.6992 C489.82,164.0892 438.41,118.3592 395.39,90.1692 " fill="none" id="userProffer-to-peerProffer" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="390.99,87.3292,396.3778,95.5737,395.1894,90.0431,400.72,88.8547,390.99,87.3292" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="516.32" y="394.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="77" x="490.82" y="405.6694">Counter-offered</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="501.32" y="416.6694">/Notify user</text><!--MD5=[655b5aaaf4b3ad4dc848a1695ed551d7]
reverse link userClose to open--><path d="M380.76,844.6992 C414.8,844.6992 454.01,844.6992 487.55,844.6992 " fill="none" id="userClose-backto-open" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="375.34,844.6992,384.34,848.6992,380.34,844.6992,384.34,840.6992,375.34,844.6992" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="418.07" y="827.1694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="393.57" y="838.1694">Requests close</text><!--MD5=[86ada14e9b63e8043e17c90ca3377d50]
link open to closing--><path d="M543.07,874.2892 C521.49,901.3892 489.26,941.8792 467.66,969.0192 " fill="none" id="open-to-closing" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="464.29,973.2492,473.0236,968.6968,467.403,969.3365,466.7633,963.716,464.29,973.2492" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="541.82" y="919.1694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="516.82" y="930.1694">Requests close</text><!--MD5=[46451cad79990bdc8741a2a06aa9c965]
link userClose to closing--><path d="M312.81,869.8692 C325.75,889.6892 345.65,917.8592 366.82,939.1992 C377.96,950.4292 391.36,961.2492 403.89,970.4692 " fill="none" id="userClose-to-closing" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="408.1,973.5392,403.1776,965.0087,404.0576,970.5967,398.4696,971.4766,408.1,973.5392" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="398.32" y="913.6694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="94" x="379.32" y="924.6694">Req:close detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="117" x="367.82" y="935.6694">/Transmit act:userClose</text><!--MD5=[1173effca0fb4868365d6bdb07246d54]
reverse link closed to closing--><path d="M250.13,998.6992 C288.62,998.6992 334.1,998.6992 371.41,998.6992 " fill="none" id="closed-backto-closing" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="244.98,998.6992,253.98,1002.6992,249.98,998.6992,253.98,994.6992,244.98,998.6992" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="18" x="299.32" y="970.1694">DB:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="263.32" y="981.1694">(No explicit action)</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="89" x="263.82" y="992.1694">[Tally sum is zero]</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="143" x="298.91" y="1051.1328">Sat Jan 29 10:19:15 MST 2022</text><!--MD5=[904db480c75430e0f151a8b674f1cadf]
@startuml
!include common.puml

$title(Tally State Diagram)
[*] - -> void
state "void" as void

'States are determined by a combination of values, as defined here:
userVoid : Stat: draft, Req->void
userAccept : Stat: draft, Req->open
userDraft : Stat: void, Req->draft
userClose : Stat: open, Req->close
void : Stat->void, Req: null\n(or no tally)
open : Stat->open, Req: null
closing : Stat->close, Req: null
peerProffer : Stat->draft, Req: null
peerProffer : Peer signature only
userProffer : Stat->draft, Req: null
userProffer : User signature only
closed : Stat->closed, Req: null
closed : Balance is zero
open : E: Add peer's signature

'State transition rules:
void -[$peer]-> peerProffer : $trans($peer,Proposes a Tally,valid signature,Notify user)
note on link
  [[../Tallies.md#establishing-a-tally{Can't happen until our user uses a connection ticket to connect to the propser's system and exchange keys} User-initiated]]
endnote
void -[$user]-> userDraft : $trans($user,New Tally Record,valid signature)

userVoid -[$db]-> void : $trans($db,Req:void detected,'',Transmit Act:userVoid)

peerProffer -[$user]-> userVoid : $trans($user,Request to void)
peerProffer -[$user]-> userDraft : $trans($user,Modifies tally,valid signature)
peerProffer -[$user]-> userAccept : $trans($user,Accepts tally,valid signature)

userAccept -[$db]-> open : $trans($db,req:open detected,'',Transmit act:userAccept)

userDraft -[$db]-> userProffer : $trans($db,Req:draft detected,,Transmit Act:peerProffer)

userProffer -[$peer]-> open : $trans($peer,Accepted tally)
userProffer -[$peer]-> void : $trans($peer,"Refused tally\nor timed out",Notify user)
userProffer -[$peer]-> peerProffer : $trans($peer,Counter-offered,'',Notify user)

open -left[$user]-> userClose : $trans($user,Requests close)
open -[$peer]-> closing : $trans($peer,Requests close)
userClose -[$db]-> closing : $trans($db,Req:close detected,'',Transmit act:userClose)
closing -left[$db]-> closed : $trans(DB,'(No explicit action)',Tally sum is zero)

'closed - -> [*]

@enduml

@startuml



skinparam backgroundColor fff
skinparam stereotypeCBackgroundColor 27d






skinparam circledCharacter {
  radius 8
  fontSize 11
  fontName Helvetica
}

skinparam class {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  attributeFontColor 333
  attributeFontSize 11
  attributeIconSize 11
}

skinparam actor {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam participant {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam collections {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam SequenceBox{
    backgroundColor e0e0e0
  borderColor cccccc
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam interface {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam component {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}



skinparam queue {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}


skinparam usecase {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam activity {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam sequence {
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  lifeLineBorderColor 4af
  lifeLineBackgroundColor e0e0e0
}




skinparam state {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
  startColor 4af
  endColor 27d
}

skinparam note {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}








  title Tally State Diagram
  footer Sat Jan 29 10:19:15 MST 2022
[*] - -> void
state "void" as void

userVoid : Stat: draft, Req->void
userAccept : Stat: draft, Req->open
userDraft : Stat: void, Req->draft
userClose : Stat: open, Req->close
void : Stat->void, Req: null\n(or no tally)
open : Stat->open, Req: null
closing : Stat->close, Req: null
peerProffer : Stat->draft, Req: null
peerProffer : Peer signature only
userProffer : Stat->draft, Req: null
userProffer : User signature only
closed : Stat->closed, Req: null
closed : Balance is zero
open : E: Add peer's signature

void -[#blue]-> peerProffer : <font color=blue>Peer:\nProposes a Tally\n[valid signature]\n/Notify user
note on link
  [[../Tallies.md#establishing-a-tally{Can't happen until our user uses a connection ticket to connect to the propser's system and exchange keys} User-initiated]]
endnote
void -[#green]-> userDraft : <font color=green>User:\nNew Tally Record\n[valid signature]

userVoid -[#red]-> void : <font color=red>DB Trigger:\nReq:void detected\n/Transmit Act:userVoid

peerProffer -[#green]-> userVoid : <font color=green>User:\nRequest to void
peerProffer -[#green]-> userDraft : <font color=green>User:\nModifies tally\n[valid signature]
peerProffer -[#green]-> userAccept : <font color=green>User:\nAccepts tally\n[valid signature]

userAccept -[#red]-> open : <font color=red>DB Trigger:\nreq:open detected\n/Transmit act:userAccept

userDraft -[#red]-> userProffer : <font color=red>DB Trigger:\nReq:draft detected\n/Transmit Act:peerProffer

userProffer -[#blue]-> open : <font color=blue>Peer:\nAccepted tally
userProffer -[#blue]-> void : <font color=blue>Peer:\nRefused tally\nor timed out\n[Notify user]
userProffer -[#blue]-> peerProffer : <font color=blue>Peer:\nCounter-offered\n/Notify user

open -left[#green]-> userClose : <font color=green>User:\nRequests close
open -[#blue]-> closing : <font color=blue>Peer:\nRequests close
userClose -[#red]-> closing : <font color=red>DB Trigger:\nReq:close detected\n/Transmit act:userClose
closing -left[#red]-> closed : <font color=black>DB:\n(No explicit action)\n[Tally sum is zero]


@enduml

PlantUML version 1.2021.12(Tue Oct 05 10:01:58 MDT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>