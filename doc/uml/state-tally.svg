<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1054px" preserveAspectRatio="none" style="width:1069px;height:1054px;background:#FFFFFF;" version="1.1" viewBox="0 0 1069 1054" width="1069px" zoomAndPan="magnify"><defs><filter height="300%" id="f1ocrli433sk7s" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="169" x="443.75" y="17.4023">Tally State Diagram</text><!--MD5=[932510f84763d6405ab56e4a2265926e]
cluster working--><rect fill="#E8E8EA" filter="url(#f1ocrli433sk7s)" height="121" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="580" x="458.5" y="198.1992"/><rect fill="#FFFFFF" height="94" rx="12.5" ry="12.5" style="stroke:#FFFFFF;stroke-width:1.0;" width="574" x="461.5" y="222.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="458.5" x2="1038.5" y1="219.1992" y2="219.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="38" x="729.5" y="210.6694">working</text><!--MD5=[434d6044c2588cbe8ba7a06cfdde95dc]
cluster liftable--><rect fill="#E8E8EA" filter="url(#f1ocrli433sk7s)" height="284" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="278" x="104.5" y="741.1992"/><rect fill="#FFFFFF" height="257" rx="12.5" ry="12.5" style="stroke:#FFFFFF;stroke-width:1.0;" width="272" x="107.5" y="765.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="104.5" x2="382.5" y1="762.1992" y2="762.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="30" x="228.5" y="753.6694">liftable</text><g id="working.draft"><rect fill="#E8E8EA" filter="url(#f1ocrli433sk7s)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="192" x="663.5" y="236.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="663.5" x2="855.5" y1="257.1992" y2="257.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="22" x="748.5" y="249.6694">draft</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="129" x="668.5" y="273.8008">Status: draft, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="172" x="668.5" y="287.9336">User: can modify, sign, delete</text></g><g id="working.void"><rect fill="#E8E8EA" filter="url(#f1ocrli433sk7s)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="145" x="483" y="236.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="483" x2="628" y1="257.1992" y2="257.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="20" x="545.5" y="249.6694">void</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="125" x="488" y="273.8008">Status: void, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="97" x="488" y="287.9336">User: can modify</text></g><g id="liftable.open"><rect fill="#E8E8EA" filter="url(#f1ocrli433sk7s)" height="73.3984" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="171" x="158" y="771.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="158" x2="329" y1="792.1992" y2="792.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="231.5" y="784.6694">open</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="130" x="163" y="808.8008">Status: open, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="151" x="163" y="822.9336">Must have both signatures</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="135" x="163" y="837.0664">User: can request close</text></g><g id="liftable.close"><rect fill="#E8E8EA" filter="url(#f1ocrli433sk7s)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="150" x="168.5" y="950.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="168.5" x2="318.5" y1="971.1992" y2="971.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="230.5" y="963.6694">close</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="130" x="173.5" y="987.8008">Status: close, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="105" x="173.5" y="1001.9336">Non-zero balance</text></g><g id="pOfferVoid"><rect fill="#E8E8EA" filter="url(#f1ocrli433sk7s)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="152" x="377.5" y="426.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="377.5" x2="529.5" y1="447.1992" y2="447.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="55" x="426" y="439.6694">P.offer.void</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="132" x="382.5" y="463.8008">Status: offer, Req: void</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="382.5" y="477.9336">Agent: Attention!</text></g><g id="BOfferOpen"><rect fill="#E8E8EA" filter="url(#f1ocrli433sk7s)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="157" x="7" y="426.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="7" x2="164" y1="447.1992" y2="447.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="59" x="56" y="439.6694">B.offer.open</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="137" x="12" y="463.8008">Status: offer, Req: open</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="12" y="477.9336">Agent: Attention!</text></g><g id="DraftOffer"><rect fill="#E8E8EA" filter="url(#f1ocrli433sk7s)" height="73.3984" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="164" x="564.5" y="419.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="564.5" x2="728.5" y1="440.1992" y2="440.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="47" x="623" y="432.6694">draft.offer</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="136" x="569.5" y="456.8008">Status: draft, Req: offer</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="144" x="569.5" y="470.9336">Must have user signature</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="569.5" y="485.0664">Agent: Attention!</text></g><g id="OpenClose"><rect fill="#E8E8EA" filter="url(#f1ocrli433sk7s)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="159" x="542" y="28.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="542" x2="701" y1="49.1992" y2="49.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="53" x="595" y="41.6694">open.close</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="139" x="547" y="65.8008">Status: open, Req: close</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="547" y="79.9336">Agent: Attention!</text></g><g id="pOffer"><rect fill="#E8E8EA" filter="url(#f1ocrli433sk7s)" height="73.3984" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="211" x="129" y="229.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="129" x2="340" y1="250.1992" y2="250.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="32" x="218.5" y="242.6694">P.offer</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="128" x="134" y="266.8008">Status: offer, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="110" x="134" y="280.9336">Peer signature only</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="191" x="134" y="295.0664">User: can accept, refuse, counter</text></g><g id="hOffer"><rect fill="#E8E8EA" filter="url(#f1ocrli433sk7s)" height="73.3984" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="148" x="362.5" y="587.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="362.5" x2="510.5" y1="608.1992" y2="608.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="33" x="420" y="600.6694">H.offer</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="128" x="367.5" y="624.8008">Status: offer, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="110" x="367.5" y="638.9336">User signature only</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="110" x="367.5" y="653.0664">User waits for peer</text></g><g id="closed"><rect fill="#E8E8EA" filter="url(#f1ocrli433sk7s)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="158" x="445.5" y="950.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="445.5" x2="603.5" y1="971.1992" y2="971.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="100" x="474.5" y="963.6694">close (zero balance)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="138" x="450.5" y="987.8008">Status: closed, Req: null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="87" x="450.5" y="1001.9336">Balance is zero</text></g><ellipse cx="496.5" cy="57.6992" fill="#44AAFF" filter="url(#f1ocrli433sk7s)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><!--MD5=[98967d72ce6cf1fee1a27daeddde0c85]
link *start to draft--><path d="M503.13,66.0192 C508.63,71.9592 516.79,80.4292 524.5,87.1992 C542.03,102.5892 653.99,186.2392 716.84,233.0092 " fill="none" id="*start-to-draft" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="720.9,236.0292,716.0803,227.4402,716.8931,233.0384,711.295,233.8512,720.9,236.0292" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="663" y="137.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="638.5" y="148.6694">User or system</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="73" x="640" y="159.6694">drafts new tally</text><!--MD5=[a843d81587e846b1f84799ee78e823b8]
link *start to pOffer--><path d="M488.94,64.6392 C459.26,87.9792 349.14,174.5592 283.9,225.8592 " fill="none" id="*start-to-pOffer" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="279.67,229.1892,289.2185,226.7756,283.6021,226.1007,284.277,220.4843,279.67,229.1892" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="473.5" y="126.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="134" x="419.5" y="137.6694">Receive new proposed tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="448.5" y="148.6694">[valid signature]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="47" x="463" y="159.6694">/Act: offer</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="53" x="460" y="170.6694">Notify user</text><!--MD5=[f93311f55d9ef408d52e14ba6e31305b]
link working to DraftOffer--><path d="M1021.8774,319.2538 C1021.828,319.3644 1021.7784,319.475 1021.7285,319.5853 C1021.5289,320.0269 1021.3249,320.4663 1021.1164,320.9033 C1020.2824,322.6515 1019.3763,324.3616 1018.3921,326.0185 C1016.4236,329.3322 1014.1425,332.433 1011.5,335.1992 C1010.87,335.8592 841.21,391.2392 733.45,426.3692 " fill="none" id="working-to-DraftOffer" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="728.69,427.9192,738.485,428.9476,733.4461,426.3767,736.017,421.3378,728.69,427.9192" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="1010.5" y="352.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="75" x="986.5" y="363.6694">User signs tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="50" x="999" y="374.6694">[valid cert]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="69" x="989.5" y="385.6694">/Request offer</text><!--MD5=[c062f63624191a0da7aca53a7050afab]
link draft to draft--><path d="M855.75,247.5792 C875.95,249.4592 890.5,255.4892 890.5,265.6992 C890.5,275.0292 878.34,280.8792 860.83,283.2392 " fill="none" id="draft-to-draft" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="855.75,283.8192,865.1489,286.7623,860.7171,283.2466,864.2327,278.8149,855.75,283.8192" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="938.5" y="252.1694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="104" x="899.5" y="263.1694">Ticketed tally request</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="79" x="912" y="274.1694">[Have peer cert]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="110" x="896.5" y="285.1694">/Act: ticket; Notify user</text><!--MD5=[32fa2ebd6d599e34ead6e35ca840f245]
link pOfferVoid to void--><path d="M482.36,426.1492 C492.24,415.2592 502.75,402.2992 510.5,389.1992 C527.15,361.0392 539.33,325.6792 546.79,300.1992 " fill="none" id="pOfferVoid-to-void" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="548.22,295.2392,541.8866,302.7817,546.837,300.0441,549.5745,304.9945,548.22,295.2392" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="548.5" y="358.1694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="88" x="532.5" y="369.1694">Req:void detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="88" x="532.5" y="380.1694">/Transmit Act:void</text><!--MD5=[6b9e9182ae89892674723abc43fbc571]
link pOffer to pOfferVoid--><path d="M250.27,302.2292 C263.63,329.0092 285,365.1092 312.5,389.1992 C329.96,404.4892 351.6,416.8992 372.64,426.6392 " fill="none" id="pOffer-to-pOfferVoid" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="377.41,428.8092,370.8719,421.4435,372.8582,426.7402,367.5615,428.7265,377.41,428.8092" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="333.5" y="358.1694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="63" x="315.5" y="369.1694">Refuses tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="67" x="313.5" y="380.1694">/Request void</text><!--MD5=[08dacb9f37a0c3215fcb43a00c7a1b37]
link pOffer to DraftOffer--><path d="M319.58,302.3792 C342.11,313.7692 365.66,327.5392 385.5,343.1992 C406.54,359.8092 401.7,375.1092 424.5,389.1992 C472.37,418.7692 493.61,403.0092 547.5,419.1992 C551.46,420.3892 555.49,421.6492 559.56,422.9492 " fill="none" id="pOffer-to-DraftOffer" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="564.34,424.4992,557.013,417.9178,559.5839,422.9567,554.545,425.5276,564.34,424.4992" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="450" y="352.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="62" x="432.5" y="363.6694">Modifies tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="425.5" y="374.6694">[valid signature]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="69" x="429" y="385.6694">/Request offer</text><!--MD5=[cc50ebd3c42bc55b4d513d732813f8e9]
link pOffer to BOfferOpen--><path d="M174.27,302.3592 C158.48,313.8692 142.53,327.7092 130.5,343.1992 C112.57,366.2892 100.79,397.4892 93.8,421.0092 " fill="none" id="pOffer-to-BOfferOpen" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="92.38,425.8992,98.74,418.3792,93.78,421.0992,91.06,416.1392,92.38,425.8992" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="156" y="352.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="62" x="138.5" y="363.6694">Accepts tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="76" x="131.5" y="374.6694">[valid signature]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="71" x="134" y="385.6694">/Request open</text><!--MD5=[7b6743e49a6f8d81c8cd9df7b9ebb834]
link BOfferOpen to open--><path d="M98.43,485.3392 C126.48,547.4892 193.01,694.8492 225.29,766.3692 " fill="none" id="BOfferOpen-to-open" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="227.37,770.9692,227.3129,761.1205,225.3128,766.412,220.0213,764.412,227.37,770.9692" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="193.5" y="615.6694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="88" x="177.5" y="626.6694">req:open detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="92" x="175.5" y="637.6694">/Transmit Act:open</text><!--MD5=[e86374a8b4b43ff786cd666e0d7700f5]
link DraftOffer to hOffer--><path d="M601.45,492.3092 C567.4,519.2292 520.71,556.1392 485.69,583.8192 " fill="none" id="DraftOffer-to-hOffer" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="481.48,587.1492,491.0231,584.7142,485.4051,584.0519,486.0674,578.434,481.48,587.1492" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="577.5" y="531.6694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="560.5" y="542.6694">Req:offer detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="560.5" y="553.6694">/Transmit Act:offer</text><!--MD5=[19685337731f22f29488c30b9cdec922]
link hOffer to open--><path d="M398.83,660.2192 C366.12,691.0692 318.84,735.6492 285.04,767.5192 " fill="none" id="hOffer-to-open" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="281.4,770.9592,290.6953,767.7037,285.041,767.5324,285.2123,761.8781,281.4,770.9592" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="413" y="699.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="125" x="363.5" y="710.6694">Receive peer acceptance</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="49" x="401.5" y="721.6694">/Act: open</text><!--MD5=[d5d583d9dafd86b63dd4d4520088065c]
link hOffer to void--><path d="M510.5,617.5192 C587.73,607.4692 703.46,578.0792 746.5,492.1992 C761.04,463.1892 760.57,448.4392 746.5,419.1992 C742.42,410.7192 652.3,340.7792 597.33,298.6192 " fill="none" id="hOffer-to-void" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="593.1,295.3792,597.8113,304.0281,597.069,298.4202,602.6769,297.6778,593.1,295.3792" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="796.5" y="447.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="101" x="759" y="458.6694">Receive peer refusal</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="104" x="757.5" y="469.6694">/Act: void; Notify user</text><!--MD5=[e7c045274f428f72e469ee4dfcada223]
link hOffer to pOffer--><path d="M362.14,589.6292 C322.55,567.8992 277.07,535.4392 252.5,492.1992 C219.83,434.7092 222.35,355.2992 227.9,307.6692 " fill="none" id="hOffer-to-pOffer" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="228.52,302.5992,223.4675,311.0534,227.9192,307.563,231.4096,312.0147,228.52,302.5992" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="293.5" y="447.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="105" x="254" y="458.6694">Receive modified tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="106" x="253.5" y="469.6694">/Act: offer; Notify user</text><!--MD5=[0545aa1bcab47bbb6a638ba8079c13c5]
link void to pOffer--><path d="M482.86,265.6992 C442.26,265.6992 390.81,265.6992 345.29,265.6992 " fill="none" id="void-to-pOffer" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="340.05,265.6992,349.05,269.6992,345.05,265.6992,349.05,261.6992,340.05,265.6992" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="398.5" y="237.1694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="105" x="359" y="248.1694">Receive modified tally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="106" x="358.5" y="259.1694">/Act: offer; Notify user</text><!--MD5=[8f429cfedb3a3b3b4f08e2b8cbb78e3d]
link open to close--><path d="M177.21,844.4892 C167.24,852.8692 158.36,862.7692 152.5,874.1992 C143.18,892.3992 142.7,902.2592 152.5,920.1992 C158.17,930.5892 166.56,939.3992 175.99,946.7892 " fill="none" id="open-to-close" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="180.09,949.8692,175.29,941.2692,176.09,946.8692,170.49,947.6692,180.09,949.8692" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="190.5" y="889.1694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="101" x="153.5" y="900.1694">Issues close/call chit</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="60" x="174" y="911.1694">/Set to close</text><!--MD5=[8f429cfedb3a3b3b4f08e2b8cbb78e3d]
link open to close--><path d="M253.87,844.4492 C256.2,854.0292 258.32,864.4392 259.5,874.1992 C261.94,894.4992 262.22,899.9392 259.5,920.1992 C258.4,928.4092 256.46,937.0992 254.31,945.1992 " fill="none" id="open-to-close-1" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="252.95,950.1492,259.1943,942.5329,254.2764,945.3284,251.4809,940.4105,252.95,950.1492" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="281.5" y="883.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="65" x="262" y="894.6694">Receive peer</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="66" x="261.5" y="905.6694">close request</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="51" x="269" y="916.6694">/Act: close</text><!--MD5=[81ac61b32fe79fe384823f5ed7d24f41]
link close to closed--><path d="M318.8,979.6992 C356.14,979.6992 401.38,979.6992 439.91,979.6992 " fill="none" id="close-to-closed" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="445.06,979.6992,436.06,975.6992,440.06,979.6992,436.06,983.6992,445.06,979.6992" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="18" x="373" y="951.1694">DB:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="337" y="962.1694">(No explicit action)</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="89" x="337.5" y="973.1694">[Tally sum is zero]</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="139" x="458.75" y="1045.8672">Fri Jul 01 11:24:18 MDT 2022</text><!--MD5=[3a3481eb3cbcee8bc1741ef6cbaebe32]
@startuml
!include common.puml

$title(Tally State Diagram)
state "P.offer.void" as pOfferVoid
state "B.offer.open" as BOfferOpen
state "draft.offer" as DraftOffer
state "open.close" as OpenClose
state working {
  state "draft" as draft
  state "void" as void
}
state liftable {
  state "open" as open
  state "close" as close
}
state "P.offer" as pOffer
state "H.offer" as hOffer
state "close (zero balance)" as closed

'State details
pOfferVoid : Status: offer, Req: void
pOfferVoid : Agent: Attention!

BOfferOpen : Status: offer, Req: open
BOfferOpen : Agent: Attention!

DraftOffer : Status: draft, Req: offer
DraftOffer : Must have user signature
DraftOffer : Agent: Attention!

OpenClose : Status: open, Req: close
OpenClose : Agent: Attention!

draft : Status: draft, Req: null
draft : User: can modify, sign, delete

void : Status: void, Req: null
void : User: can modify

pOffer : Status: offer, Req: null
pOffer : Peer signature only
pOffer : User: can accept, refuse, counter

hOffer : Status: offer, Req: null
hOffer : User signature only
hOffer : User waits for peer

open : Status: open, Req: null
open : Must have both signatures
open : User: can request close

close : Status: close, Req: null
close : Non-zero balance

closed : Status: closed, Req: null
closed : Balance is zero

'State transition rules:
[*] -[$user]-> draft : $trans($user,User or system\ndrafts new tally)
[*] -[$peer]-> pOffer : $trans($peer,Receive new proposed tally,valid signature,Act: offer\nNotify user)
working -[$user]-> DraftOffer : $trans($user,User signs tally,valid cert,Request offer)

draft -[$peer]-> draft : $trans($peer,Ticketed tally request,Have peer cert, Act: ticket; Notify user)
pOfferVoid -[$db]-> void : $trans($db,Req:void detected,'',Transmit Act:void)

pOffer -[$user]-> pOfferVoid : $trans($user,Refuses tally, '', Request void)
pOffer -[$user]-> DraftOffer : $trans($user,Modifies tally,valid signature, Request offer)
pOffer -[$user]-> BOfferOpen : $trans($user,Accepts tally,valid signature, Request open)

BOfferOpen -[$db]-> open : $trans($db,req:open detected,'',Transmit Act:open)

DraftOffer -[$db]-> hOffer : $trans($db,Req:offer detected,,Transmit Act:offer)

hOffer -[$peer]-> open : $trans($peer, Receive peer acceptance, '', Act: open)
hOffer -[$peer]-> void : $trans($peer,Receive peer refusal, '', Act: void; Notify user)
hOffer -[$peer]-> pOffer : $trans($peer,Receive modified tally, '', Act: offer; Notify user)
void -[$peer]-> pOffer : $trans($peer,Receive modified tally,'', Act: offer; Notify user)

open -[$user]-> close : $trans($user, Issues close/call chit, '', Set to close)
open -[$peer]-> close : $trans($peer,Receive peer\nclose request, '', Act: close)
close -right[$db]-> closed : $trans(DB,'(No explicit action)',Tally sum is zero)

'closed - -> [*]

@enduml

@startuml



skinparam backgroundColor fff
skinparam stereotypeCBackgroundColor 27d






skinparam circledCharacter {
  radius 8
  fontSize 11
  fontName Helvetica
}

skinparam class {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  attributeFontColor 333
  attributeFontSize 11
  attributeIconSize 11
}

skinparam actor {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam participant {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam collections {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam SequenceBox{
    backgroundColor e0e0e0
  borderColor cccccc
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam interface {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam component {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}



skinparam queue {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}


skinparam usecase {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam activity {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam sequence {
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  lifeLineBorderColor 4af
  lifeLineBackgroundColor e0e0e0
}




skinparam state {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
  startColor 4af
  endColor 27d
}

skinparam note {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}








  title Tally State Diagram
  footer Fri Jul 01 11:24:18 MDT 2022
state "P.offer.void" as pOfferVoid
state "B.offer.open" as BOfferOpen
state "draft.offer" as DraftOffer
state "open.close" as OpenClose
state working {
  state "draft" as draft
  state "void" as void
}
state liftable {
  state "open" as open
  state "close" as close
}
state "P.offer" as pOffer
state "H.offer" as hOffer
state "close (zero balance)" as closed

pOfferVoid : Status: offer, Req: void
pOfferVoid : Agent: Attention!

BOfferOpen : Status: offer, Req: open
BOfferOpen : Agent: Attention!

DraftOffer : Status: draft, Req: offer
DraftOffer : Must have user signature
DraftOffer : Agent: Attention!

OpenClose : Status: open, Req: close
OpenClose : Agent: Attention!

draft : Status: draft, Req: null
draft : User: can modify, sign, delete

void : Status: void, Req: null
void : User: can modify

pOffer : Status: offer, Req: null
pOffer : Peer signature only
pOffer : User: can accept, refuse, counter

hOffer : Status: offer, Req: null
hOffer : User signature only
hOffer : User waits for peer

open : Status: open, Req: null
open : Must have both signatures
open : User: can request close

close : Status: close, Req: null
close : Non-zero balance

closed : Status: closed, Req: null
closed : Balance is zero

[*] -[#green]-> draft : <font color=green>User:\nUser or system\ndrafts new tally
[*] -[#blue]-> pOffer : <font color=blue>Peer:\nReceive new proposed tally\n[valid signature]\n/Act: offer\nNotify user
working -[#green]-> DraftOffer : <font color=green>User:\nUser signs tally\n[valid cert]\n/Request offer

draft -[#blue]-> draft : <font color=blue>Peer:\nTicketed tally request\n[Have peer cert]\n/Act: ticket; Notify user
pOfferVoid -[#red]-> void : <font color=red>DB Trigger:\nReq:void detected\n/Transmit Act:void

pOffer -[#green]-> pOfferVoid : <font color=green>User:\nRefuses tally\n/Request void
pOffer -[#green]-> DraftOffer : <font color=green>User:\nModifies tally\n[valid signature]\n/Request offer
pOffer -[#green]-> BOfferOpen : <font color=green>User:\nAccepts tally\n[valid signature]\n/Request open

BOfferOpen -[#red]-> open : <font color=red>DB Trigger:\nreq:open detected\n/Transmit Act:open

DraftOffer -[#red]-> hOffer : <font color=red>DB Trigger:\nReq:offer detected\n/Transmit Act:offer

hOffer -[#blue]-> open : <font color=blue>Peer:\nReceive peer acceptance\n/Act: open
hOffer -[#blue]-> void : <font color=blue>Peer:\nReceive peer refusal\n/Act: void; Notify user
hOffer -[#blue]-> pOffer : <font color=blue>Peer:\nReceive modified tally\n/Act: offer; Notify user
void -[#blue]-> pOffer : <font color=blue>Peer:\nReceive modified tally\n/Act: offer; Notify user

open -[#green]-> close : <font color=green>User:\nIssues close/call chit\n/Set to close
open -[#blue]-> close : <font color=blue>Peer:\nReceive peer\nclose request\n/Act: close
close -right[#red]-> closed : <font color=black>DB:\n(No explicit action)\n[Tally sum is zero]


@enduml

PlantUML version 1.2022.1(Tue Feb 01 11:19:58 MST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>