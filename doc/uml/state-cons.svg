<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="830px" preserveAspectRatio="none" style="width:855px;height:830px;background:#FFFFFF;" version="1.1" viewBox="0 0 855 830" width="855px" zoomAndPan="magnify"><defs><filter height="300%" id="fnan7xcjt5c3k" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="302" x="270.04" y="17.4023">Chit Chain Consensus Stock States</text><ellipse cx="281.08" cy="37.1992" fill="#44AAFF" filter="url(#fnan7xcjt5c3k)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><g id="cons"><rect fill="#E8E8EA" filter="url(#fnan7xcjt5c3k)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="112" x="225.08" y="116.6992"/><line style="stroke:#202024;stroke-width:1.5;" x1="225.08" x2="337.08" y1="137.6992" y2="137.6992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="269.08" y="130.1694">cons</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="92" x="230.08" y="154.3008">Fully Consensed</text></g><g id="error"><rect fill="#E8E8EA" filter="url(#fnan7xcjt5c3k)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="108" x="411.08" y="582.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="411.08" x2="519.08" y1="603.1992" y2="603.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="453.08" y="595.6694">error</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="88" x="416.08" y="619.8008">Can't Consense</text></g><g id="pend"><rect fill="#E8E8EA" filter="url(#fnan7xcjt5c3k)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="146" x="386.08" y="749.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="386.08" x2="532.08" y1="770.1992" y2="770.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="447.08" y="762.6694">pend</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="126" x="391.08" y="786.8008">Pending Acknowledge</text></g><g id="problem"><rect fill="#E8E8EA" filter="url(#fnan7xcjt5c3k)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="126" x="225.08" y="270.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="225.08" x2="351.08" y1="291.1992" y2="291.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="39" x="268.58" y="283.6694">problem</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="106" x="230.08" y="307.8008">Does not reconcile</text></g><g id="request"><rect fill="#E8E8EA" filter="url(#fnan7xcjt5c3k)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="128" x="302.08" y="426.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="302.08" x2="430.08" y1="447.1992" y2="447.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="37" x="347.58" y="439.6694">request</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="108" x="307.08" y="463.8008">Requested Update</text></g><g id="newChit"><rect fill="#E8E8EA" filter="url(#fnan7xcjt5c3k)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="154" x="120.08" y="582.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="120.08" x2="274.08" y1="603.1992" y2="603.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="39" x="177.58" y="595.6694">newChit</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="134" x="125.08" y="619.8008">Regular chit processing</text></g><!--MD5=[1aabe860b3035abf686adf8cb8d84d0c]
link *start to cons--><path d="M281.08,47.2992 C281.08,61.5392 281.08,89.7192 281.08,111.4192 " fill="none" id="*start-to-cons" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="281.08,116.4992,285.08,107.4992,281.08,111.4992,277.08,107.4992,281.08,116.4992" style="stroke:#000000;stroke-width:1.0;"/><!--MD5=[d1a0a8b1bec6df8b6ba950f7e1727771]
link cons to newChit--><path d="M224.94,160.3392 C198.03,170.5992 166.44,185.4592 142.08,205.1992 C80.06,255.4592 60.86,274.3192 36.08,350.1992 C6,442.3192 102.98,534.6792 159.44,579.0492 " fill="none" id="cons-to-newChit" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="163.44,582.1592,158.7981,573.4729,159.4955,579.0865,153.8819,579.784,163.44,582.1592" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="67.08" y="365.1694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="87" x="37.08" y="376.1694">User creates new</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="86" x="37.58" y="387.1694">valid direct chit(s)</text><!--MD5=[d1a0a8b1bec6df8b6ba950f7e1727771]
link cons to newChit--><path d="M264.5,167.1092 C248.18,192.0692 223.53,232.4292 208.08,270.1992 C164.85,375.8592 181.26,516.2092 191.41,576.5592 " fill="none" id="cons-to-newChit-1" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="192.31,581.7992,194.7088,572.2469,191.4533,576.8732,186.8271,573.6177,192.31,581.7992" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="199.58" y="365.1694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="81" x="187.08" y="376.1694">Site creates new</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="69" x="193.08" y="387.1694">valid lift chit(s)</text><!--MD5=[8387851643e4676f60dc2d9128f1064a]
link newChit to pend--><path d="M235.46,632.3692 C283.61,662.6892 365.94,714.5492 416.14,746.1592 " fill="none" id="newChit-to-pend" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="420.6,748.9692,415.1276,740.7806,416.3729,746.2987,410.8548,747.544,420.6,748.9692" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="437.08" y="671.6694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="126" x="402.08" y="682.6694">Detected new valid chit(s)</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="126" x="402.08" y="693.6694">/Add to chain provisionally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="196" x="367.08" y="704.6694">Generate proposed endHash: propHash</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="126" x="402.08" y="715.6694">Send to Foil peer Act:prop</text><!--MD5=[736ff45283c82902e1fd10bfe2036b0f]
link cons to cons--><path d="M337.51,129.6992 C356.67,129.6392 372.08,133.6392 372.08,141.6992 C372.08,149.0092 359.43,152.9792 342.79,153.6092 " fill="none" id="cons-to-cons" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="337.51,153.6992,346.5772,157.5444,342.5093,153.6135,346.4401,149.5455,337.51,153.6992" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="427.58" y="122.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="125" x="378.08" y="133.6694">Receive new chit Act:new</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="120" x="380.58" y="144.6694">[Can reconcile endHash]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="86" x="397.58" y="155.6694">/Conform to chain</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="102" x="389.58" y="166.6694">ackHash = newHash</text><!--MD5=[36347962cfc003983838b5ae228d4f27]
link cons to problem--><path d="M278.7,166.7892 C277.15,186.5492 275.79,215.2392 278.08,240.1992 C278.83,248.3792 280.21,257.1592 281.7,265.2292 " fill="none" id="cons-to-problem" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="282.65,270.1392,284.8774,260.5455,281.7052,265.2293,277.0215,262.0572,282.65,270.1392" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="333.58" y="214.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="125" x="284.08" y="225.6694">Receive new chit Act:new</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="135" x="279.08" y="236.6694">[Cannot reconcile endHash]</text><!--MD5=[320ae12987bc82e73eecd6556cdf613d]
link problem to request--><path d="M282.09,320.3092 C278.16,341.5492 275.75,372.6692 288.08,396.1992 C293.63,406.7992 302.31,415.7192 311.89,423.0792 " fill="none" id="problem-to-request" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="316.05,426.1392,311.1618,417.5891,312.0193,423.1805,306.4279,424.0381,316.05,426.1392" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="323.58" y="359.6694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="99" x="302.08" y="370.6694">Detected failed state</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="125" x="289.08" y="381.6694">/Request update from Foil</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="62" x="320.58" y="392.6694">Act:compare</text><!--MD5=[b37e86b4b9510b86d80f10652d0f1bd1]
link request to error--><path d="M398.44,476.4192 C408.29,484.9892 418.51,495.2492 426.08,506.1992 C441.09,527.9092 451.43,556.2092 457.67,577.1592 " fill="none" id="request-to-error" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="459.09,582.0492,460.41,572.2892,457.69,577.2492,452.73,574.5292,459.09,582.0492" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="534.58" y="515.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="197" x="449.08" y="526.6694">Receive chits since ackHash Act:update</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="157" x="469.08" y="537.6694">[Cannot reconcile with endHash]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="170" x="462.58" y="548.6694">/Send error report to peer and user</text><!--MD5=[547c2df20c24641412486f72069c818c]
link request to cons--><path d="M397.55,426.1592 C406.2,417.7292 414.46,407.5092 419.08,396.1992 C451.2,317.6192 465.08,276.5392 419.08,205.1992 C401.97,178.6592 370.55,163.2692 342.02,154.4092 " fill="none" id="request-to-cons" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="337.1,152.9292,344.5623,159.3569,341.8872,154.3725,346.8715,151.6974,337.1,152.9292" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="534.58" y="281.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="197" x="449.08" y="292.6694">Receive chits since ackHash Act:update</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="179" x="458.08" y="303.6694">[Chain now reconciles with endHash]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="103" x="496.08" y="314.6694">/ackHash = endHash</text><!--MD5=[4830c2ef32245fea535fde9a8d09b26c]
link request to newChit--><path d="M302,461.3792 C272.78,468.7792 240.09,482.1292 219.08,506.1992 C202.2,525.5392 197.36,554.8892 196.35,576.7892 " fill="none" id="request-to-newChit" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="196.18,581.9092,200.486,573.0516,196.3513,576.9122,192.4907,572.7774,196.18,581.9092" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="305.58" y="515.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="197" x="220.08" y="526.6694">Receive chits since ackHash Act:update</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="126" x="255.58" y="537.6694">[Still have unlinked chit(s)]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="104" x="266.58" y="548.6694">/Requeue for sending</text><!--MD5=[6936f384358927667f431b3aa9ee4de5]
link pend to cons--><path d="M532.15,754.8592 C600.81,732.7192 693.08,688.1092 693.08,608.1992 C693.08,294.1992 693.08,294.1992 693.08,294.1992 C693.08,220.4192 457.4,171.5792 342.54,152.1592 " fill="none" id="pend-to-cons" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="337.5,151.3092,345.7123,156.746,342.4308,152.1382,347.0386,148.8567,337.5,151.3092" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="757.58" y="437.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="146" x="697.58" y="448.6694">Receive ack from Foil Act:ack</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="153" x="694.08" y="459.6694">[Agree with proposed endHash]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="151" x="695.08" y="470.6694">/Ratchet: ackHash = propHash</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="148" x="347.04" y="821.8672">Thu Jun 30 11:42:20 MDT 2022</text><!--MD5=[b144852a7e1d42940a6c31cbb12cbd2d]
@startuml
!include common.puml

$title(Chit Chain Consensus Stock States)
[*] - -> cons
cons: Fully Consensed
error: Can't Consense
pend: Pending Acknowledge
problem: Does not reconcile
request: Requested Update
newChit: Regular chit processing

'state stock {
'  stockPend:
'  stockRequest:
'}

'State transition rules:
cons -[$user]-> newChit: $trans($user, User creates new\nvalid direct chit(s),'')
cons -[$db]-> newChit: $trans($db, Site creates new\nvalid lift chit(s),'')

newChit -[$db]-> pend: $trans($db,Detected new valid chit(s),'', 'Add to chain provisionally\nGenerate proposed endHash: propHash\nSend to Foil peer Act:prop')

cons -[$peer]-> cons: $trans($peer,Receive new chit Act:new,'Can reconcile endHash', 'Conform to chain\nackHash = newHash')
cons -[$peer]-> problem: $trans($peer,Receive new chit Act:new,'Cannot reconcile endHash')
problem -[$db]-> request: $trans($db,Detected failed state,'', 'Request update from Foil\nAct:compare')

request -[$peer]-> error: $trans($peer,Receive chits since ackHash Act:update,'Cannot reconcile with endHash', 'Send error report to peer and user')
request -[$peer]-> cons: $trans($peer,Receive chits since ackHash Act:update,'Chain now reconciles with endHash', 'ackHash = endHash')
request -[$peer]-> newChit: $trans($peer,Receive chits since ackHash Act:update,'Still have unlinked chit(s)', 'Requeue for sending')

pend -[$peer]-> cons: $trans($peer,Receive ack from Foil Act:ack,'Agree with proposed endHash', 'Ratchet: ackHash = propHash')

@enduml

@startuml



skinparam backgroundColor fff
skinparam stereotypeCBackgroundColor 27d






skinparam circledCharacter {
  radius 8
  fontSize 11
  fontName Helvetica
}

skinparam class {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  attributeFontColor 333
  attributeFontSize 11
  attributeIconSize 11
}

skinparam actor {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam participant {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam collections {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam SequenceBox{
    backgroundColor e0e0e0
  borderColor cccccc
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam interface {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam component {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}



skinparam queue {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}


skinparam usecase {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam activity {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam sequence {
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  lifeLineBorderColor 4af
  lifeLineBackgroundColor e0e0e0
}




skinparam state {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
  startColor 4af
  endColor 27d
}

skinparam note {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}








  title Chit Chain Consensus Stock States
  footer Thu Jun 30 11:42:20 MDT 2022
[*] - -> cons
cons: Fully Consensed
error: Can't Consense
pend: Pending Acknowledge
problem: Does not reconcile
request: Requested Update
newChit: Regular chit processing


cons -[#green]-> newChit: <font color=green>User:\nUser creates new\nvalid direct chit(s)
cons -[#red]-> newChit: <font color=red>DB Trigger:\nSite creates new\nvalid lift chit(s)

newChit -[#red]-> pend: <font color=red>DB Trigger:\nDetected new valid chit(s)\n/Add to chain provisionally\nGenerate proposed endHash: propHash\nSend to Foil peer Act:prop

cons -[#blue]-> cons: <font color=blue>Peer:\nReceive new chit Act:new\n[Can reconcile endHash]\n/Conform to chain\nackHash = newHash
cons -[#blue]-> problem: <font color=blue>Peer:\nReceive new chit Act:new\n[Cannot reconcile endHash]
problem -[#red]-> request: <font color=red>DB Trigger:\nDetected failed state\n/Request update from Foil\nAct:compare

request -[#blue]-> error: <font color=blue>Peer:\nReceive chits since ackHash Act:update\n[Cannot reconcile with endHash]\n/Send error report to peer and user
request -[#blue]-> cons: <font color=blue>Peer:\nReceive chits since ackHash Act:update\n[Chain now reconciles with endHash]\n/ackHash = endHash
request -[#blue]-> newChit: <font color=blue>Peer:\nReceive chits since ackHash Act:update\n[Still have unlinked chit(s)]\n/Requeue for sending

pend -[#blue]-> cons: <font color=blue>Peer:\nReceive ack from Foil Act:ack\n[Agree with proposed endHash]\n/Ratchet: ackHash = propHash

@enduml

PlantUML version 1.2022.1(Tue Feb 01 11:19:58 MST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>