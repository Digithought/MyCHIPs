<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="529px" preserveAspectRatio="none" style="width:842px;height:529px;" version="1.1" viewBox="0 0 842 529" width="842px" zoomAndPan="magnify"><defs><filter height="300%" id="f1v11jdcill8mv" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="296" x="266.67" y="17.4023">Tally/Chit Consensus Stock States</text><ellipse cx="438.34" cy="37.1992" fill="#44AAFF" filter="url(#f1v11jdcill8mv)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><g id="cons"><rect fill="#E8E8EA" filter="url(#f1v11jdcill8mv)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="112" x="382.34" y="116.6992"/><line style="stroke:#202024;stroke-width:1.5;" x1="382.34" x2="494.34" y1="137.6992" y2="137.6992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="426.34" y="130.1694">cons</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="92" x="387.34" y="154.3008">Fully Consensed</text></g><g id="error"><rect fill="#E8E8EA" filter="url(#f1v11jdcill8mv)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="108" x="57.34" y="448.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="57.34" x2="165.34" y1="469.1992" y2="469.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="99.34" y="461.6694">error</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="88" x="62.34" y="485.8008">Can't Consense</text></g><g id="pend"><rect fill="#E8E8EA" filter="url(#f1v11jdcill8mv)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="146" x="489.34" y="448.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="489.34" x2="635.34" y1="469.1992" y2="469.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="24" x="550.34" y="461.6694">pend</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="126" x="494.34" y="485.8008">Pending Acknowledge</text></g><g id="request"><rect fill="#E8E8EA" filter="url(#f1v11jdcill8mv)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="128" x="47.34" y="281.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="47.34" x2="175.34" y1="302.1992" y2="302.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="37" x="92.84" y="294.6694">request</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="108" x="52.34" y="318.8008">Requested Update</text></g><g id="newChit"><rect fill="#E8E8EA" filter="url(#f1v11jdcill8mv)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="59" x="422.84" y="281.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="422.84" x2="481.84" y1="302.1992" y2="302.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="39" x="432.84" y="294.6694">newChit</text></g><!--MD5=[1aabe860b3035abf686adf8cb8d84d0c]
link *start to cons--><path d="M438.34,47.2992 C438.34,61.5392 438.34,89.7192 438.34,111.4192 " fill="none" id="*start-to-cons" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="438.34,116.4992,442.34,107.4992,438.34,111.4992,434.34,107.4992,438.34,116.4992" style="stroke:#000000;stroke-width:1.0;"/><!--MD5=[d1a0a8b1bec6df8b6ba950f7e1727771]
link cons to newChit--><path d="M435.2,166.9892 C432.92,189.0792 430.94,222.5192 435.34,251.1992 C436.62,259.4892 438.93,268.2492 441.45,276.2392 " fill="none" id="cons-to-newChit" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="443.03,281.1092,444.0583,271.3142,441.4875,276.3531,436.4486,273.7822,443.03,281.1092" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="466.34" y="220.1694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="87" x="436.34" y="231.1694">User creates new</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="86" x="436.84" y="242.1694">valid direct chit(s)</text><!--MD5=[d1a0a8b1bec6df8b6ba950f7e1727771]
link cons to newChit--><path d="M490.42,166.7692 C505.42,176.4492 519.97,189.1892 528.34,205.1992 C537.82,223.3192 537.72,233.0292 528.34,251.1992 C519.45,268.4192 502.25,281.3492 486.46,290.2292 " fill="none" id="cons-to-newChit-1" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="482.05,292.6292,491.8674,291.8423,486.4422,290.24,488.0446,284.8148,482.05,292.6292" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="549.84" y="220.1694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="81" x="537.34" y="231.1694">Site creates new</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="69" x="543.34" y="242.1694">valid lift chit(s)</text><!--MD5=[8387851643e4676f60dc2d9128f1064a]
link newChit to pend--><path d="M444.46,331.3092 C438.18,355.2692 432.89,392.1092 449.34,418.1992 C457.78,431.5892 470.56,441.7192 484.52,449.3792 " fill="none" id="newChit-to-pend" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="489.29,451.8792,483.1661,444.1657,484.8586,449.5635,479.4609,451.256,489.29,451.8792" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="520.34" y="370.6694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="126" x="485.34" y="381.6694">Detected new valid chit(s)</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="126" x="485.34" y="392.6694">/Add to chain provisionally</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="196" x="450.34" y="403.6694">Generate proposed endHash: propHash</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="126" x="485.34" y="414.6694">Send to Foil peer Act:prop</text><!--MD5=[736ff45283c82902e1fd10bfe2036b0f]
link cons to cons--><path d="M494.77,129.6992 C513.94,129.6392 529.34,133.6392 529.34,141.6992 C529.34,149.0092 516.69,152.9792 500.06,153.6092 " fill="none" id="cons-to-cons" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="494.77,153.6992,503.8372,157.5444,499.7693,153.6135,503.7001,149.5455,494.77,153.6992" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="584.84" y="122.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="125" x="535.34" y="133.6694">Receive new chit Act:new</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="120" x="537.84" y="144.6694">[Can reconcile endHash]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="86" x="554.84" y="155.6694">/Conform to chain</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="102" x="546.84" y="166.6694">ackHash = newHash</text><!--MD5=[f68fbaeddb943f187cd33904ea3a19a6]
link cons to request--><path d="M382.32,142.4292 C279.19,143.2592 65.56,151.5792 19.34,205.1992 C6,220.6892 9.19,233.4592 19.34,251.1992 C25.6,262.1292 35.02,271.0592 45.48,278.2792 " fill="none" id="cons-to-request" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="49.7,281.0692,44.3974,272.7697,45.5288,278.3122,39.9862,279.4436,49.7,281.0692" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="74.84" y="214.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="125" x="25.34" y="225.6694">Receive new chit Act:new</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="135" x="20.34" y="236.6694">[Cannot reconcile endHash]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="42.84" y="247.6694">/Reply Act:request</text><!--MD5=[547c2df20c24641412486f72069c818c]
link request to cons--><path d="M133.29,280.8592 C154.92,258.2492 189.91,225.1592 226.34,205.1992 C273.81,179.1892 333.34,162.8692 377.22,153.4492 " fill="none" id="request-to-cons" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="382.22,152.3992,372.589,150.3391,377.3273,153.4293,374.2371,158.1675,382.22,152.3992" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="312.84" y="214.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="197" x="227.34" y="225.6694">Receive chits since ackHash Act:update</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="179" x="236.34" y="236.6694">[Chain now reconciles with endHash]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="103" x="274.34" y="247.6694">/ackHash = endHash</text><!--MD5=[b37e86b4b9510b86d80f10652d0f1bd1]
link request to error--><path d="M111.34,331.5492 C111.34,361.1192 111.34,410.9792 111.34,442.7092 " fill="none" id="request-to-error" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="111.34,448.0192,115.34,439.0192,111.34,443.0192,107.34,439.0192,111.34,448.0192" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="197.84" y="376.1694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="197" x="112.34" y="387.1694">Receive chits since ackHash Act:update</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="157" x="132.34" y="398.1694">[Cannot reconcile with endHash]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="170" x="125.84" y="409.1694">/Send error report to peer and user</text><!--MD5=[6936f384358927667f431b3aa9ee4de5]
link pend to cons--><path d="M621.56,447.9992 C633.47,440.2992 644.43,430.4792 651.34,418.1992 C698.08,335.1792 688.86,277.9392 627.34,205.1992 C595.93,168.0492 541.91,152.8592 499.65,146.7092 " fill="none" id="pend-to-cons" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="494.55,145.9992,502.915,151.198,499.5026,146.6863,504.0143,143.2739,494.55,145.9992" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="744.84" y="292.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="146" x="684.84" y="303.6694">Receive ack from Foil Act:ack</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="153" x="681.34" y="314.6694">[Agree with proposed endHash]</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="151" x="682.34" y="325.6694">/Ratchet: ackHash = propHash</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="145" x="342.17" y="520.8672">Thu Jul 01 17:09:17 MDT 2021</text><!--MD5=[4949fdeac1d60d3c272e131ed4d75be7]
@startuml
!include common.puml

$title(Tally/Chit Consensus Stock States)
[*] - -> cons
cons: Fully Consensed
error: Can't Consense
pend: Pending Acknowledge
request: Requested Update

'state stock {
'  stockPend:
'  stockRequest:
'}

'State transition rules:
cons -[$user]-> newChit: $trans($user, User creates new\nvalid direct chit(s),'')
cons -[$db]-> newChit: $trans($db, Site creates new\nvalid lift chit(s),'')

newChit -[$db]-> pend: $trans($db,Detected new valid chit(s),'', 'Add to chain provisionally\nGenerate proposed endHash: propHash\nSend to Foil peer Act:prop')

cons -[$peer]-> cons: $trans($peer,Receive new chit Act:new,'Can reconcile endHash', 'Conform to chain\nackHash = newHash')
cons -[$peer]-> request: $trans($peer,Receive new chit Act:new,'Cannot reconcile endHash', 'Reply Act:request')

request -[$peer]-> cons: $trans($peer,Receive chits since ackHash Act:update,'Chain now reconciles with endHash', 'ackHash = endHash')
request -[$peer]-> error: $trans($peer,Receive chits since ackHash Act:update,'Cannot reconcile with endHash', 'Send error report to peer and user')

pend -[$peer]-> cons: $trans($peer,Receive ack from Foil Act:ack,'Agree with proposed endHash', 'Ratchet: ackHash = propHash')

@enduml

@startuml



skinparam backgroundColor fff
skinparam stereotypeCBackgroundColor 27d






skinparam circledCharacter {
  radius 8
  fontSize 11
  fontName Helvetica
}

skinparam class {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  attributeFontColor 333
  attributeFontSize 11
  attributeIconSize 11
}

skinparam actor {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam participant {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam collections {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam SequenceBox{
    backgroundColor e0e0e0
  borderColor cccccc
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam interface {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam component {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}



skinparam queue {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}


skinparam usecase {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam activity {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam sequence {
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  lifeLineBorderColor 4af
  lifeLineBackgroundColor e0e0e0
}




skinparam state {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
  startColor 4af
  endColor 27d
}

skinparam note {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}








  title Tally/Chit Consensus Stock States
  footer Thu Jul 01 17:09:17 MDT 2021
[*] - -> cons
cons: Fully Consensed
error: Can't Consense
pend: Pending Acknowledge
request: Requested Update


cons -[#green]-> newChit: <font color=green>User:\nUser creates new\nvalid direct chit(s)
cons -[#red]-> newChit: <font color=red>DB Trigger:\nSite creates new\nvalid lift chit(s)

newChit -[#red]-> pend: <font color=red>DB Trigger:\nDetected new valid chit(s)\n/Add to chain provisionally\nGenerate proposed endHash: propHash\nSend to Foil peer Act:prop

cons -[#blue]-> cons: <font color=blue>Peer:\nReceive new chit Act:new\n[Can reconcile endHash]\n/Conform to chain\nackHash = newHash
cons -[#blue]-> request: <font color=blue>Peer:\nReceive new chit Act:new\n[Cannot reconcile endHash]\n/Reply Act:request

request -[#blue]-> cons: <font color=blue>Peer:\nReceive chits since ackHash Act:update\n[Chain now reconciles with endHash]\n/ackHash = endHash
request -[#blue]-> error: <font color=blue>Peer:\nReceive chits since ackHash Act:update\n[Cannot reconcile with endHash]\n/Send error report to peer and user

pend -[#blue]-> cons: <font color=blue>Peer:\nReceive ack from Foil Act:ack\n[Agree with proposed endHash]\n/Ratchet: ackHash = propHash

@enduml

PlantUML version 1.2021.00(Sun Jan 10 03:25:05 MST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>