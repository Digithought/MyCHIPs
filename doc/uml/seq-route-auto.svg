<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="791px" preserveAspectRatio="none" style="width:526px;height:791px;" version="1.1" viewBox="0 0 526 791" width="526px" zoomAndPan="magnify"><defs><filter height="300%" id="f1xa17ddno6020" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="233" x="144.5" y="29.4023">Automatic Route Discovery</text><rect fill="#FFFFFF" filter="url(#f1xa17ddno6020)" height="178.5313" style="stroke:#000000;stroke-width:2.0;" width="366" x="146" y="233.6875"/><rect fill="#FFFFFF" filter="url(#f1xa17ddno6020)" height="122.2207" style="stroke:#000000;stroke-width:2.0;" width="307.5" x="156" y="282.998"/><rect fill="#FFFFFF" height="39.9551" style="stroke:none;stroke-width:1.0;" width="307.5" x="156" y="325.3086"/><rect fill="#FFFFFF" height="39.9551" style="stroke:none;stroke-width:1.0;" width="307.5" x="156" y="365.2637"/><rect fill="#FFFFFF" filter="url(#f1xa17ddno6020)" height="264.752" style="stroke:#000000;stroke-width:2.0;" width="347.5" x="136" y="426.2188"/><rect fill="#FFFFFF" filter="url(#f1xa17ddno6020)" height="233.4414" style="stroke:#000000;stroke-width:2.0;" width="327.5" x="146" y="450.5293"/><rect fill="#FFFFFF" filter="url(#f1xa17ddno6020)" height="202.1309" style="stroke:#000000;stroke-width:2.0;" width="307.5" x="156" y="474.8398"/><rect fill="#FFFFFF" height="39.9551" style="stroke:none;stroke-width:1.0;" width="307.5" x="156" y="517.1504"/><rect fill="#FFFFFF" height="39.9551" style="stroke:none;stroke-width:1.0;" width="307.5" x="156" y="557.1055"/><rect fill="#FFFFFF" height="39.9551" style="stroke:none;stroke-width:1.0;" width="307.5" x="156" y="597.0605"/><rect fill="#FFFFFF" height="39.9551" style="stroke:none;stroke-width:1.0;" width="307.5" x="156" y="637.0156"/><line style="stroke:#44AAFF;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="118" x2="118" y1="102.6875" y2="707.9707"/><line style="stroke:#44AAFF;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="195" x2="195" y1="102.6875" y2="707.9707"/><line style="stroke:#44AAFF;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="277" x2="277" y1="102.6875" y2="707.9707"/><line style="stroke:#44AAFF;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="371.5" x2="371.5" y1="102.6875" y2="707.9707"/><line style="stroke:#44AAFF;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="427.5" x2="427.5" y1="102.6875" y2="707.9707"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="81" y="99.7344">Debtor DB</text><path d="M100.5,50.1992 C100.5,40.1992 118.5,40.1992 118.5,40.1992 C118.5,40.1992 136.5,40.1992 136.5,50.1992 L136.5,76.1992 C136.5,86.1992 118.5,86.1992 118.5,86.1992 C118.5,86.1992 100.5,86.1992 100.5,76.1992 L100.5,50.1992 " fill="#FEFECE" filter="url(#f1xa17ddno6020)" style="stroke:#000000;stroke-width:1.5;"/><path d="M100.5,50.1992 C100.5,60.1992 118.5,60.1992 118.5,60.1992 C118.5,60.1992 136.5,60.1992 136.5,50.1992 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="81" y="720.5059">Debtor DB</text><path d="M100.5,733.459 C100.5,723.459 118.5,723.459 118.5,723.459 C118.5,723.459 136.5,723.459 136.5,733.459 L136.5,759.459 C136.5,769.459 118.5,769.459 118.5,769.459 C118.5,769.459 100.5,769.459 100.5,759.459 L100.5,733.459 " fill="#FEFECE" filter="url(#f1xa17ddno6020)" style="stroke:#000000;stroke-width:1.5;"/><path d="M100.5,733.459 C100.5,743.459 118.5,743.459 118.5,743.459 C118.5,743.459 136.5,743.459 136.5,733.459 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="166" y="99.7344">User DB</text><path d="M177.5,50.1992 C177.5,40.1992 195.5,40.1992 195.5,40.1992 C195.5,40.1992 213.5,40.1992 213.5,50.1992 L213.5,76.1992 C213.5,86.1992 195.5,86.1992 195.5,86.1992 C195.5,86.1992 177.5,86.1992 177.5,76.1992 L177.5,50.1992 " fill="#FEFECE" filter="url(#f1xa17ddno6020)" style="stroke:#000000;stroke-width:1.5;"/><path d="M177.5,50.1992 C177.5,60.1992 195.5,60.1992 195.5,60.1992 C195.5,60.1992 213.5,60.1992 213.5,50.1992 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="166" y="720.5059">User DB</text><path d="M177.5,733.459 C177.5,723.459 195.5,723.459 195.5,723.459 C195.5,723.459 213.5,723.459 213.5,733.459 L213.5,759.459 C213.5,769.459 195.5,769.459 195.5,769.459 C195.5,769.459 177.5,769.459 177.5,759.459 L177.5,733.459 " fill="#FEFECE" filter="url(#f1xa17ddno6020)" style="stroke:#000000;stroke-width:1.5;"/><path d="M177.5,733.459 C177.5,743.459 195.5,743.459 195.5,743.459 C195.5,743.459 213.5,743.459 213.5,733.459 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="235" y="99.7344">Creditor DB</text><path d="M259.5,50.1992 C259.5,40.1992 277.5,40.1992 277.5,40.1992 C277.5,40.1992 295.5,40.1992 295.5,50.1992 L295.5,76.1992 C295.5,86.1992 277.5,86.1992 277.5,86.1992 C277.5,86.1992 259.5,86.1992 259.5,76.1992 L259.5,50.1992 " fill="#FEFECE" filter="url(#f1xa17ddno6020)" style="stroke:#000000;stroke-width:1.5;"/><path d="M259.5,50.1992 C259.5,60.1992 277.5,60.1992 277.5,60.1992 C277.5,60.1992 295.5,60.1992 295.5,50.1992 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="235" y="720.5059">Creditor DB</text><path d="M259.5,733.459 C259.5,723.459 277.5,723.459 277.5,723.459 C277.5,723.459 295.5,723.459 295.5,733.459 L295.5,759.459 C295.5,769.459 277.5,769.459 277.5,769.459 C277.5,769.459 259.5,769.459 259.5,759.459 L259.5,733.459 " fill="#FEFECE" filter="url(#f1xa17ddno6020)" style="stroke:#000000;stroke-width:1.5;"/><path d="M259.5,733.459 C259.5,743.459 277.5,743.459 277.5,743.459 C277.5,743.459 295.5,743.459 295.5,733.459 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><rect fill="#E8E8EA" filter="url(#f1xa17ddno6020)" height="25" style="stroke:#202024;stroke-width:1.5;" width="36" x="351.5" y="72.6875"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="22" x="358.5" y="88.1577">user</text><rect fill="#E8E8EA" filter="url(#f1xa17ddno6020)" height="25" style="stroke:#202024;stroke-width:1.5;" width="36" x="351.5" y="706.9707"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="22" x="358.5" y="722.4409">user</text><rect fill="#E8E8EA" filter="url(#f1xa17ddno6020)" height="25" style="stroke:#202024;stroke-width:1.5;" width="48" x="401.5" y="72.6875"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="34" x="408.5" y="88.1577">partDB</text><rect fill="#E8E8EA" filter="url(#f1xa17ddno6020)" height="25" style="stroke:#202024;stroke-width:1.5;" width="48" x="401.5" y="706.9707"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="34" x="408.5" y="722.4409">partDB</text><path d="M5,117.6875 L5,160.6875 L228,160.6875 L228,127.6875 L218,117.6875 L5,117.6875 " fill="#E8E8EA" filter="url(#f1xa17ddno6020)" style="stroke:#202024;stroke-width:1.0;"/><path d="M218,117.6875 L218,127.6875 L228,127.6875 L218,117.6875 " fill="#E8E8EA" style="stroke:#202024;stroke-width:1.0;"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="202" x="11" y="131.1577">Debtor: A tally partner who owes our user</text><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="201" x="11" y="142.1577">a balance larger than is optimal according</text><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="196" x="11" y="153.1577">to the user's current trading parameters.</text><path d="M161,174.6875 L161,217.6875 L390,217.6875 L390,184.6875 L380,174.6875 L161,174.6875 " fill="#E8E8EA" filter="url(#f1xa17ddno6020)" style="stroke:#202024;stroke-width:1.0;"/><path d="M380,174.6875 L380,184.6875 L390,184.6875 L380,174.6875 " fill="#E8E8EA" style="stroke:#202024;stroke-width:1.0;"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="208" x="167" y="188.1577">Creditor: A tally partner who owes our user</text><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="201" x="167" y="199.1577">a balance larger than is optimal according</text><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="196" x="167" y="210.1577">to the user's current trading parameters.</text><path d="M146,233.6875 L507,233.6875 L507,240.6875 L497,250.6875 L146,250.6875 L146,233.6875 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="178.5313" style="stroke:#000000;stroke-width:2.0;" width="366" x="146" y="233.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="316" x="161" y="247.2559">User requests route via a specific tally/partner</text><line style="stroke:#000000;stroke-width:1.0;" x1="195.5" x2="205.5" y1="267.998" y2="263.998"/><line style="stroke:#000000;stroke-width:1.0;" x1="195.5" x2="205.5" y1="267.998" y2="271.998"/><line style="stroke:#000000;stroke-width:1.0;" x1="195.5" x2="370.5" y1="267.998" y2="267.998"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="152" x="212.5" y="263.4683">Request route to specified peer</text><path d="M156,282.998 L218,282.998 L218,289.998 L208,299.998 L156,299.998 L156,282.998 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="122.2207" style="stroke:#000000;stroke-width:2.0;" width="307.5" x="156" y="282.998"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="171" y="296.5664">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="131" x="233" y="295.6328">[Pathway found locally]</text><line style="stroke:#000000;stroke-width:1.0;" x1="369.5" x2="359.5" y1="317.3086" y2="313.3086"/><line style="stroke:#000000;stroke-width:1.0;" x1="369.5" x2="359.5" y1="317.3086" y2="321.3086"/><line style="stroke:#000000;stroke-width:1.0;" x1="195.5" x2="370.5" y1="317.3086" y2="317.3086"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="83" x="202.5" y="312.7788">Notify user: good</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="156" x2="463.5" y1="326.3086" y2="326.3086"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="235" x="161" y="336.9434">[Existing route found (good, failed, stale)]</text><line style="stroke:#000000;stroke-width:1.0;" x1="425.5" x2="415.5" y1="357.2637" y2="353.2637"/><line style="stroke:#000000;stroke-width:1.0;" x1="425.5" x2="415.5" y1="357.2637" y2="361.2637"/><line style="stroke:#000000;stroke-width:1.0;" x1="195.5" x2="426.5" y1="357.2637" y2="357.2637"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="79" x="202.5" y="352.7339">Request refresh</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="156" x2="463.5" y1="366.2637" y2="366.2637"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="93" x="161" y="376.8984">[No route found]</text><line style="stroke:#000000;stroke-width:1.0;" x1="425.5" x2="415.5" y1="397.2188" y2="393.2188"/><line style="stroke:#000000;stroke-width:1.0;" x1="425.5" x2="415.5" y1="397.2188" y2="401.2188"/><line style="stroke:#000000;stroke-width:1.0;" x1="195.5" x2="426.5" y1="397.2188" y2="397.2188"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="69" x="202.5" y="392.689">Request route</text><path d="M136,426.2188 L374,426.2188 L374,433.2188 L364,443.2188 L136,443.2188 L136,426.2188 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="264.752" style="stroke:#000000;stroke-width:2.0;" width="347.5" x="136" y="426.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="193" x="151" y="439.7871">User requests any/all routes</text><path d="M146,450.5293 L220,450.5293 L220,457.5293 L210,467.5293 L146,467.5293 L146,450.5293 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="233.4414" style="stroke:#000000;stroke-width:2.0;" width="327.5" x="146" y="450.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="161" y="464.0977">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="189" x="235" y="463.1641">[Over all tallies with lift capacity]</text><path d="M156,474.8398 L218,474.8398 L218,481.8398 L208,491.8398 L156,491.8398 L156,474.8398 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="202.1309" style="stroke:#000000;stroke-width:2.0;" width="307.5" x="156" y="474.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="171" y="488.4082">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="150" x="233" y="487.4746">[Destination found locally]</text><line style="stroke:#000000;stroke-width:1.0;" x1="369.5" x2="359.5" y1="509.1504" y2="505.1504"/><line style="stroke:#000000;stroke-width:1.0;" x1="369.5" x2="359.5" y1="509.1504" y2="513.1504"/><line style="stroke:#000000;stroke-width:1.0;" x1="195.5" x2="370.5" y1="509.1504" y2="509.1504"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="202.5" y="504.6206">Update user: good</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="156" x2="463.5" y1="518.1504" y2="518.1504"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="152" x="161" y="528.7852">[Current good route found]</text><line style="stroke:#000000;stroke-width:1.0;" x1="369.5" x2="359.5" y1="549.1055" y2="545.1055"/><line style="stroke:#000000;stroke-width:1.0;" x1="369.5" x2="359.5" y1="549.1055" y2="553.1055"/><line style="stroke:#000000;stroke-width:1.0;" x1="195.5" x2="370.5" y1="549.1055" y2="549.1055"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="90" x="202.5" y="544.5757">Update user: good</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="156" x2="463.5" y1="558.1055" y2="558.1055"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="156" x="161" y="568.7402">[Current failed route found]</text><line style="stroke:#000000;stroke-width:1.0;" x1="369.5" x2="359.5" y1="589.0605" y2="585.0605"/><line style="stroke:#000000;stroke-width:1.0;" x1="369.5" x2="359.5" y1="589.0605" y2="593.0605"/><line style="stroke:#000000;stroke-width:1.0;" x1="195.5" x2="370.5" y1="589.0605" y2="589.0605"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="91" x="202.5" y="584.5308">Update user: failed</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="156" x2="463.5" y1="598.0605" y2="598.0605"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="196" x="161" y="608.6953">[Stale route found (good or failed)]</text><line style="stroke:#000000;stroke-width:1.0;" x1="425.5" x2="415.5" y1="629.0156" y2="625.0156"/><line style="stroke:#000000;stroke-width:1.0;" x1="425.5" x2="415.5" y1="629.0156" y2="633.0156"/><line style="stroke:#000000;stroke-width:1.0;" x1="195.5" x2="426.5" y1="629.0156" y2="629.0156"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="128" x="202.5" y="624.4858">Request upstream refresh</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="156" x2="463.5" y1="638.0156" y2="638.0156"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="141" x="161" y="648.6504">[No existing route found]</text><line style="stroke:#000000;stroke-width:1.0;" x1="425.5" x2="415.5" y1="668.9707" y2="664.9707"/><line style="stroke:#000000;stroke-width:1.0;" x1="425.5" x2="415.5" y1="668.9707" y2="672.9707"/><line style="stroke:#000000;stroke-width:1.0;" x1="195.5" x2="426.5" y1="668.9707" y2="668.9707"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="118" x="202.5" y="664.4409">Request upstream route</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="153" x="184.5" y="783.127">Wed Mar 10 16:42:21 MST 2021</text><!--MD5=[cec253ed068e5dc34036328ca50c89df]
@startuml
!include common.puml
$title(Automatic Route Discovery)
database "Debtor DB" as debtDB
database "User DB" as userDB
database "Creditor DB" as credDB

note over debtDB
  Debtor: A tally partner who owes our user
  a balance larger than is optimal according
  to the user's current trading parameters.
end note

note over credDB
  Creditor: A tally partner who owes our user
  a balance larger than is optimal according
  to the user's current trading parameters.
end note

group User requests route via a specific tally/partner
  user		->>	userDB:		Request route to specified peer

  alt Pathway found locally
    userDB	->>	user:		Notify user: good
  else Existing route found (good, failed, stale)
    userDB	->>	partDB:		Request refresh
  else No route found
    userDB	->>	partDB:		Request route
  end
end

group User requests any/all routes
  loop Over all tallies with lift capacity
    alt Destination found locally
      userDB ->>	user:		Update user: good
  
    else Current good route found
      userDB ->>	user:		Update user: good
    
    else Current failed route found
      userDB ->>	user:		Update user: failed
    
    else Stale route found (good or failed)
      userDB ->>	partDB:		Request upstream refresh

    else No existing route found
      userDB ->>	partDB:		Request upstream route
    end
  end
end
  
@enduml

@startuml



skinparam backgroundColor fff
skinparam stereotypeCBackgroundColor 27d






skinparam circledCharacter {
  radius 8
  fontSize 11
  fontName Helvetica
}

skinparam class {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  attributeFontColor 333
  attributeFontSize 11
  attributeIconSize 11
}

skinparam actor {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam participant {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam collections {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam SequenceBox{
    backgroundColor e0e0e0
  borderColor cccccc
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam interface {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam component {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}



skinparam queue {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}


skinparam usecase {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam activity {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam sequence {
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  lifeLineBorderColor 4af
  lifeLineBackgroundColor e0e0e0
}




skinparam state {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
  startColor 4af
  endColor 27d
}

skinparam note {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}







  title Automatic Route Discovery
  footer Wed Mar 10 16:42:21 MST 2021
database "Debtor DB" as debtDB
database "User DB" as userDB
database "Creditor DB" as credDB

note over debtDB
  Debtor: A tally partner who owes our user
  a balance larger than is optimal according
  to the user's current trading parameters.
end note

note over credDB
  Creditor: A tally partner who owes our user
  a balance larger than is optimal according
  to the user's current trading parameters.
end note

group User requests route via a specific tally/partner
  user		->>	userDB:		Request route to specified peer

  alt Pathway found locally
    userDB	->>	user:		Notify user: good
  else Existing route found (good, failed, stale)
    userDB	->>	partDB:		Request refresh
  else No route found
    userDB	->>	partDB:		Request route
  end
end

group User requests any/all routes
  loop Over all tallies with lift capacity
    alt Destination found locally
      userDB ->>	user:		Update user: good
  
    else Current good route found
      userDB ->>	user:		Update user: good
    
    else Current failed route found
      userDB ->>	user:		Update user: failed
    
    else Stale route found (good or failed)
      userDB ->>	partDB:		Request upstream refresh

    else No existing route found
      userDB ->>	partDB:		Request upstream route
    end
  end
end
  
@enduml

PlantUML version 1.2021.00(Sun Jan 10 03:25:05 MST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>