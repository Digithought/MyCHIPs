<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="780px" preserveAspectRatio="none" style="width:942px;height:780px;" version="1.1" viewBox="0 0 942 780" width="942px" zoomAndPan="magnify"><defs><filter height="300%" id="f1xaeqcypwj8l6" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="151" x="389.25" y="17.4023">Direct Chit States</text><ellipse cx="427.5" cy="37.1992" fill="#44AAFF" filter="url(#f1xaeqcypwj8l6)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><g id="void"><rect fill="#E8E8EA" filter="url(#f1xaeqcypwj8l6)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="100" x="377.5" y="108.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="377.5" x2="477.5" y1="129.1992" y2="129.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="80" x="387.5" y="121.6694">void (or No Chit)</text></g><g id="userRequest"><rect fill="#E8E8EA" filter="url(#f1xaeqcypwj8l6)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="196" x="95.5" y="257.6992"/><line style="stroke:#202024;stroke-width:1.5;" x1="95.5" x2="291.5" y1="278.6992" y2="278.6992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="63" x="162" y="271.1694">userRequest</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="176" x="100.5" y="295.3008">Stat: void, Req=&gt;userRequest</text></g><g id="peerInvoice"><rect fill="#E8E8EA" filter="url(#f1xaeqcypwj8l6)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="135" x="596" y="253.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="596" x2="731" y1="274.1992" y2="274.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="57" x="635" y="266.6694">peerInvoice</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="114" x="601" y="290.8008">Stat: void, Req=null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="115" x="601" y="304.9336">E: Store/update chit</text></g><g id="userInvoice"><rect fill="#E8E8EA" filter="url(#f1xaeqcypwj8l6)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="149" x="167" y="422.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="167" x2="316" y1="443.1992" y2="443.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="57" x="213" y="435.6694">userInvoice</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="129" x="172" y="459.8008">Stat-&gt;pend, Req=null</text></g><g id="peerDecline"><rect fill="#E8E8EA" filter="url(#f1xaeqcypwj8l6)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="147" x="7" y="567.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="7" x2="154" y1="588.1992" y2="588.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="58" x="51.5" y="580.6694">peerDecline</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="127" x="12" y="604.8008">Stat:-&gt;void, Req=null</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="81" x="12" y="618.9336">E: Update chit</text></g><g id="valid"><rect fill="#E8E8EA" filter="url(#f1xaeqcypwj8l6)" height="59.2656" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="205" x="301" y="567.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="301" x2="506" y1="588.1992" y2="588.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="22" x="392.5" y="580.6694">valid</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="185" x="306" y="604.8008">Commence consensus algorithm</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="81" x="306" y="618.9336">E: Update chit</text></g><g id="linked"><rect fill="#E8E8EA" filter="url(#f1xaeqcypwj8l6)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="171" x="318" y="699.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="318" x2="489" y1="720.1992" y2="720.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="28" x="389.5" y="712.6694">linked</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="151" x="323" y="736.8008">Chit linked into hash chain</text></g><g id="userDecline"><rect fill="#E8E8EA" filter="url(#f1xaeqcypwj8l6)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="78" x="680.5" y="422.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="680.5" x2="758.5" y1="443.1992" y2="443.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="58" x="690.5" y="435.6694">userDecline</text></g><g id="userVoid"><rect fill="#E8E8EA" filter="url(#f1xaeqcypwj8l6)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="63" x="719" y="571.6992"/><line style="stroke:#202024;stroke-width:1.5;" x1="719" x2="782" y1="592.6992" y2="592.6992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="43" x="729" y="585.1694">userVoid</text></g><g id="userAgree"><rect fill="#E8E8EA" filter="url(#f1xaeqcypwj8l6)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="71" x="574" y="422.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="574" x2="645" y1="443.1992" y2="443.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="51" x="584" y="435.6694">userAgree</text></g><g id="userDraft"><rect fill="#E8E8EA" filter="url(#f1xaeqcypwj8l6)" height="50" rx="12.5" ry="12.5" style="stroke:#202024;stroke-width:1.5;" width="66" x="394.5" y="342.1992"/><line style="stroke:#202024;stroke-width:1.5;" x1="394.5" x2="460.5" y1="363.1992" y2="363.1992"/><text fill="#000033" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="46" x="404.5" y="355.6694">userDraft</text></g><!--MD5=[eb2730c87370629c3c3d87a1a2ccbb41]
link *start to void--><path d="M427.5,47.2092 C427.5,59.8992 427.5,83.6092 427.5,102.7692 " fill="none" id="*start-to-void" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="427.5,108.0392,431.5,99.0392,427.5,103.0392,423.5,99.0392,427.5,108.0392" style="stroke:#000000;stroke-width:1.0;"/><!--MD5=[fee529ca14ef31703213df1156ba08b7]
link void to userRequest--><path d="M377.21,150.8192 C352.54,160.0492 322.95,172.7992 298.5,188.1992 C269.26,206.6092 240.25,233.2492 220.16,253.3892 " fill="none" id="void-to-userRequest" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="216.26,257.3292,225.438,253.7565,219.7812,253.7794,219.7583,248.1226,216.26,257.3292" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="328" y="197.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="84" x="299.5" y="208.6694">Creates draft chit</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="63" x="310" y="219.6694">value --&gt; self</text><!--MD5=[4857567c3637e6f3ad392e28049db8f3]
link void to peerInvoice--><path d="M477.2,158.2492 C494.66,167.1592 514.22,177.6592 531.5,188.1992 C562.79,207.2792 596.49,231.2092 622,250.0792 " fill="none" id="void-to-peerInvoice" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="626.03,253.0692,621.1614,244.5078,622.0062,250.1013,616.4127,250.946,626.03,253.0692" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="630" y="197.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="119" x="583.5" y="208.6694">Receive Act:peerInvoice</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="615" y="219.6694">/Notify user</text><!--MD5=[5ddedc0eeeae4aa0951f280ca6b5b7e9]
link userRequest to userInvoice--><path d="M140,307.9492 C126.66,316.7292 114.03,328.0592 106.5,342.1992 C96.05,361.8092 94.04,373.7992 106.5,392.1992 C119.46,411.3392 140.42,423.6992 162,431.6792 " fill="none" id="userRequest-to-userInvoice" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="166.91,433.4092,159.764,426.6317,162.1974,431.7384,157.0907,434.1718,166.91,433.4092" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="152" y="359.1694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="131" x="114.5" y="370.1694">Req:userRequest detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="145" x="107.5" y="381.1694">/Transmit chit Act:peerInvoice</text><!--MD5=[d335ab72b11f2dc2fc5f2dab1ce1c8c6]
link userInvoice to userRequest--><path d="M252.5,422.0892 C260.75,400.3492 268.85,367.9392 257.5,342.1992 C252.3,330.3992 243.42,319.9492 233.9,311.2692 " fill="none" id="userInvoice-to-userRequest" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="230.08,307.9092,234.1854,316.8616,233.8304,311.2159,239.4761,310.8609,230.08,307.9092" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="42" x="288" y="364.6694">Timeout:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="91" x="263.5" y="375.6694">No reply from peer</text><!--MD5=[d25a39a7bbfae4679619c7bda00c763f]
link userInvoice to peerDecline--><path d="M166.76,464.4792 C144.75,472.5592 122.34,484.5292 106.5,502.1992 C91.9,518.4892 85.43,542.2892 82.58,561.8092 " fill="none" id="userInvoice-to-peerDecline" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="81.88,567.1892,87.028,558.7929,82.5371,562.2326,79.0974,557.7416,81.88,567.1892" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="154.5" y="511.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="120" x="107.5" y="522.6694">Receive Act:peerDecline</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="139.5" y="533.6694">/Notify user</text><!--MD5=[90e25901e122e04b472d56fa7a4112a8]
link peerDecline to userRequest--><path d="M73.05,566.8092 C61.88,516.7792 46.52,412.6192 90.5,342.1992 C98.67,329.1192 110.9,318.6792 124.11,310.4492 " fill="none" id="peerDecline-to-userRequest" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="128.62,307.7492,118.8446,308.9497,124.3325,310.3217,122.9605,315.8097,128.62,307.7492" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="81" y="444.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="60" x="64.5" y="455.6694">Modifies chit</text><!--MD5=[7b451dca8aeb0b4ea852bece8bdb67f6]
link userInvoice to valid--><path d="M243.32,472.4392 C245.97,492.0392 252.49,519.2392 268.5,537.1992 C278.35,548.2492 290.66,557.2892 303.81,564.6692 " fill="none" id="userInvoice-to-valid" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="308.3,567.1092,302.3054,559.2948,303.9078,564.72,298.4826,566.3223,308.3,567.1092" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="310" y="511.6694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="107" x="269.5" y="522.6694">Receive Act:peerValid</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="295" y="533.6694">/Notify user</text><!--MD5=[c1eb25d3e9b31b38e1f7778e1cbfebf7]
link peerInvoice to userDecline--><path d="M673.38,312.3792 C683.53,341.8292 699.25,387.4492 709.46,417.0692 " fill="none" id="peerInvoice-to-userDecline" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="711.18,422.0392,712.0312,412.2272,709.5518,417.3117,704.4673,414.8323,711.18,422.0392" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="735" y="364.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="96" x="700.5" y="375.6694">Requests to decline</text><!--MD5=[5aa819bfbe9153a51f50384093f7d92e]
link userDecline to userVoid--><path d="M685.1,472.3792 C676.02,480.6892 667.4,490.7992 662.5,502.1992 C656.35,516.4892 655.15,523.4892 662.5,537.1992 C673.45,557.6192 695.01,572.1292 714.05,581.5892 " fill="none" id="userDecline-to-userVoid" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="718.83,583.8892,712.4433,576.3918,714.3213,581.7279,708.9852,583.6058,718.83,583.8892" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="708.5" y="511.6694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="126" x="673.5" y="522.6694">Req:userDecline detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="146" x="663.5" y="533.6694">/Transmit chit Act:peerDecline</text><!--MD5=[3e8bd28b92e94ba3823104ef0b2e6db2]
link userVoid to peerInvoice--><path d="M782.01,575.6392 C794.6,565.7492 807.7,552.6292 814.5,537.1992 C849.49,457.8092 855.78,412.9092 805.5,342.1992 C789.21,319.2892 762.25,305.3292 736.17,296.8292 " fill="none" id="userVoid-to-peerInvoice" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="731.32,295.2992,738.7061,301.8142,736.0899,296.7987,741.1053,294.1824,731.32,295.2992" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="26" x="875.5" y="439.1694">Peer:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="92" x="842.5" y="450.1694">Requests payment</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="860.5" y="461.1694">/Notify user</text><!--MD5=[f600980a4cd0275f1867741004c6190f]
link peerInvoice to userAgree--><path d="M636.98,312.4392 C630.16,321.3692 623.59,331.6592 619.5,342.1992 C610.24,366.0492 608.15,395.1892 608.14,416.5492 " fill="none" id="peerInvoice-to-userAgree" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="608.18,421.7992,612.1027,412.7653,608.1371,416.7994,604.103,412.8338,608.18,421.7992" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="630.5" y="364.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="47" x="620.5" y="375.6694">Signs chit</text><!--MD5=[c0b1f4e99d73ad7cae8332c4da94c0be]
link userAgree to valid--><path d="M573.86,466.1392 C555.34,475.9792 532.64,488.8692 513.5,502.1992 C486.78,520.8092 458.85,544.6092 437.82,563.5392 " fill="none" id="userAgree-to-valid" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="433.98,567.0192,443.3331,563.9339,437.6829,563.6594,437.9574,558.0092,433.98,567.0192" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="553" y="511.6694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="119" x="521.5" y="522.6694">Req:userAgree detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="133" x="514.5" y="533.6694">/Transmit chit Act:peerValid</text><!--MD5=[4f5e7d5c0334881400bb03d542b6e1be]
link void to userDraft--><path d="M427.5,158.5892 C427.5,201.6092 427.5,290.7692 427.5,336.9892 " fill="none" id="void-to-userDraft" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="427.5,342.1392,431.5,333.1392,427.5,337.1392,423.5,333.1392,427.5,342.1392" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="27" x="462" y="197.6694">User:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="94" x="428.5" y="208.6694">Creates signed chit</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="81" x="435" y="219.6694">value --&gt; partner</text><!--MD5=[65f075d482b0317bbc00a4dcda4d8299]
link userDraft to valid--><path d="M424.77,392.3892 C423.73,401.7092 422.55,412.4492 421.5,422.1992 C416.27,470.8392 410.48,527.1892 406.91,562.1392 " fill="none" id="userDraft-to-valid" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="406.4,567.1392,411.2781,558.5833,406.8989,562.1642,403.318,557.785,406.4,567.1392" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#FF0000" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="56" x="461" y="439.1694">DB Trigger:</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="114" x="432" y="450.1694">Req:userDraft detected</text><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="133" x="422.5" y="461.1694">/Transmit chit Act:peerValid</text><!--MD5=[394a5e66f798fe086626b2793a3f2751]
link valid to linked--><path d="M403.5,626.4892 C403.5,646.7692 403.5,673.8292 403.5,694.1592 " fill="none" id="valid-to-linked" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="403.5,699.1792,407.5,690.1792,403.5,694.1792,399.5,690.1792,403.5,699.1792" style="stroke:#000000;stroke-width:1.0;"/><text fill="#333333" font-family="Helvetica" font-size="11" lengthAdjust="spacing" textLength="134" x="404.5" y="665.6694">[When consensus reached]</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="148" x="390.75" y="771.8672">Thu Feb 11 13:57:30 MST 2021</text><!--MD5=[fc7d7bcd6e455e265c6912112f5b781f]
@startuml
!include common.puml

$title(Direct Chit States)
[*] - -> void
state "void (or No Chit)" as void

'States are determined by a combination of values, as defined here:
userRequest: Stat: void, Req=>userRequest
peerInvoice: Stat: void, Req=null
peerInvoice : E: Store/update chit
userInvoice: Stat->pend, Req=null
peerDecline : Stat:->void, Req=null
peerDecline : E: Update chit
valid : Commence consensus algorithm
valid : E: Update chit
linked : Chit linked into hash chain

'State transition rules:
void -[$user]-> userRequest : $trans($user,Creates draft chit\nvalue - -> self)
void -[$peer]-> peerInvoice : $trans($peer,Receive Act:peerInvoice,'',Notify user)

userRequest -[$db]-> userInvoice : $trans($db,Req:userRequest detected,'',Transmit chit Act:peerInvoice)
userInvoice - -> userRequest : $trans(Timeout,No reply from peer)
userInvoice -[$peer]-> peerDecline : $trans($peer,Receive Act:peerDecline,'',Notify user)
peerDecline -[$user]-> userRequest : $trans($user,Modifies chit,'')
userInvoice -[$peer]-> valid : $trans($peer,Receive Act:peerValid,'',Notify user)

peerInvoice -[$user]-> userDecline : $trans($user, Requests to decline)
userDecline -[$db]-> userVoid : $trans($db, Req:userDecline detected, '', Transmit chit Act:peerDecline)
userVoid -[$peer]-> peerInvoice : $trans($peer,Requests payment,'',Notify user)

peerInvoice -[$user]-> userAgree : $trans($user, Signs chit)
userAgree -[$db]-> valid : $trans($db, Req:userAgree detected,'', Transmit chit Act:peerValid)

void -[$user]-> userDraft : $trans($user,Creates signed chit\nvalue - -> partner)
userDraft -[$db]-> valid : $trans($db, Req:userDraft detected,'', Transmit chit Act:peerValid)

valid - -> linked : [When consensus reached]

@enduml

@startuml



skinparam backgroundColor fff
skinparam stereotypeCBackgroundColor 27d






skinparam circledCharacter {
  radius 8
  fontSize 11
  fontName Helvetica
}

skinparam class {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  attributeFontColor 333
  attributeFontSize 11
  attributeIconSize 11
}

skinparam actor {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam participant {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam collections {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam SequenceBox{
    backgroundColor e0e0e0
  borderColor cccccc
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam interface {
    backgroundColor 4af
  borderColor 27d
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}

skinparam component {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}



skinparam queue {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}


skinparam usecase {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam activity {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
}

skinparam sequence {
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11

  lifeLineBorderColor 4af
  lifeLineBackgroundColor e0e0e0
}




skinparam state {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
    arrowColor 000
  arrowFontName Helvetica
  arrowFontColor 333
  arrowFontSize 11
  startColor 4af
  endColor 27d
}

skinparam note {
    backgroundColor e8e8ea
  borderColor 202024
    fontColor 003
  fontName Helvetica
  fontSize 11
  stereotypeFontColor 333
  stereotypeFontSize 11
}








  title Direct Chit States
  footer Thu Feb 11 13:57:30 MST 2021
[*] - -> void
state "void (or No Chit)" as void

userRequest: Stat: void, Req=>userRequest
peerInvoice: Stat: void, Req=null
peerInvoice : E: Store/update chit
userInvoice: Stat->pend, Req=null
peerDecline : Stat:->void, Req=null
peerDecline : E: Update chit
valid : Commence consensus algorithm
valid : E: Update chit
linked : Chit linked into hash chain

void -[#green]-> userRequest : <font color=green>User:\nCreates draft chit\nvalue - -> self
void -[#blue]-> peerInvoice : <font color=blue>Peer:\nReceive Act:peerInvoice\n/Notify user

userRequest -[#red]-> userInvoice : <font color=red>DB Trigger:\nReq:userRequest detected\n/Transmit chit Act:peerInvoice
userInvoice - -> userRequest : <font color=black>Timeout:\nNo reply from peer
userInvoice -[#blue]-> peerDecline : <font color=blue>Peer:\nReceive Act:peerDecline\n/Notify user
peerDecline -[#green]-> userRequest : <font color=green>User:\nModifies chit
userInvoice -[#blue]-> valid : <font color=blue>Peer:\nReceive Act:peerValid\n/Notify user

peerInvoice -[#green]-> userDecline : <font color=green>User:\nRequests to decline
userDecline -[#red]-> userVoid : <font color=red>DB Trigger:\nReq:userDecline detected\n/Transmit chit Act:peerDecline
userVoid -[#blue]-> peerInvoice : <font color=blue>Peer:\nRequests payment\n/Notify user

peerInvoice -[#green]-> userAgree : <font color=green>User:\nSigns chit
userAgree -[#red]-> valid : <font color=red>DB Trigger:\nReq:userAgree detected\n/Transmit chit Act:peerValid

void -[#green]-> userDraft : <font color=green>User:\nCreates signed chit\nvalue - -> partner
userDraft -[#red]-> valid : <font color=red>DB Trigger:\nReq:userDraft detected\n/Transmit chit Act:peerValid

valid - -> linked : [When consensus reached]

@enduml

PlantUML version 1.2021.00(Sun Jan 10 03:25:05 MST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>