#Copyright MyCHIPs.org; See license in root of this package
#----------------------------------------------------------------

tabdef mychips.tallies -fields [concat {
    {tally_ent		ent	6	{0 15}		-sort 1 -write 0 -hide 1}
    {tally_seq		ent	4	{1 15}		-hide 1}
    {tally_type		ent	6	{0 1}		}
    {version		ent	40	{1 1}		}
    {tally_guid		ent	40	{0 2}		}
    {tally_date		ent	20	{1 2}		}
    {partner		ent	8	{2 2}		}
    {status		ent	10	{0 3}		}
    {request		ent	10	{1 3}		}
    {user_sig		ent	20	{1 4 2}		}
    {part_sig		ent	20	{3 4 2}		}
    {comment		ent	40	{0 5 4}		}
    {contract		ent	20	{0 6 4}		}
    {stock_terms	mle	{80 2}	{0 7 2}		}
    {foil_terms		mle	{80 2}	{0 8 4}		}
    {bal_target		ent	8	{0 9}		}
    {lift_marg		ent	8	{1 9}		}
    {drop_marg		ent	8	{2 9}		}
    {dr_limit		ent	12	{0 10}		}
    {cr_limit		ent	12	{1 10}		}
    {units		ent	16	{2 10}		}
} $glob::stampd]

# A view with some additional pseudo fields
tabdef mychips.tallies_v -fields {
    {user_cid		ent	28	{3 14}		-opt 1 -sta readonly -wr 0}
    {user_sock		ent	28	{3 14}		-opt 1 -sta readonly -wr 0}
    {user_name		ent	28	{3 14}		-opt 1 -sta readonly -wr 0}
    {part_cid		ent	28	{3 16}		-opt 1 -sta readonly -wr 0}
    {part_sock		ent	28	{3 16}		-opt 1 -sta readonly -wr 0}
    {part_name		ent	28	{3 16}		-opt 1 -sta readonly -wr 0}
} -display {
  tally_ent tally_seq tally_type partner part_name dr_limit cr_limit contract
}

# User view
tabdef mychips.tallies_v_me -display {
  tally_ent tally_seq tally_type partner part_name dr_limit cr_limit total
} -json {
  actions {[
    {"name":"close","ask":"1"},
    {"name":"lock","ask":"1"},
    {"name":"unlock","ask":"1"},
    {"name":"summary"},
    {"name":"trade","format":"html","options":[
      {"tag":"start","type":"date","input":"ent","size":"11","subframe":"1 1","special":"cal","hint":"date","template":"date"},
      {"tag":"end","type":"date","input":"ent","size":"11","subframe":"1 2","special":"cal","hint":"date","template":"date"}
    ]}
  ]}
  where {{"and":true,"items":[{"left":"status","oper":"=","entry":"open"}]}}
  subviews {["mychips.chits_v_me"]}
  launch {{
    "initial": 1,
    "import": "json.import"
  }}
}

tabdef mychips.users_v_flat -display {id user_cid std_name bill_addr bill_city bill_state} -sort {std_name id}
